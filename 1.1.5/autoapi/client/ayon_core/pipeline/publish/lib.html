<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=constants.html><link rel=next href=publish_plugins.html><link rel=icon href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.8"><title>lib - ayon-core</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../css/custom.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_core.pipeline.publish.lib class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../index.html title=ayon-core class="md-header__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-core </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> lib </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../index.html title=ayon-core class="md-nav__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../../index.html class="md-nav__link "> <span class=md-ellipsis> client </span> </a> <label class="md-nav__link " for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> ayon_core </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../__main__.html class=md-nav__link> <span class=md-ellipsis> __main__ </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../addon/base.html class=md-nav__link> <span class=md-ellipsis> addon </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../cli.html class=md-nav__link> <span class=md-ellipsis> cli </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../hooks/pre_add_last_workfile_arg.html class=md-nav__link> <span class=md-ellipsis> hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../host/dirmap.html class=md-nav__link> <span class=md-ellipsis> host </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../lib/attribute_definitions.html class=md-nav__link> <span class=md-ellipsis> lib </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_7 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> pipeline </span> </a> <label class="md-nav__link " for=__nav_3_1_1_7 id=__nav_3_1_1_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_7_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_7> <span class="md-nav__icon md-icon"></span> pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../actions.html class=md-nav__link> <span class=md-ellipsis> actions </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../anatomy/anatomy.html class=md-nav__link> <span class=md-ellipsis> anatomy </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../colorspace.html class=md-nav__link> <span class=md-ellipsis> colorspace </span> </a> </li> <li class=md-nav__item> <a href=../constants.html class=md-nav__link> <span class=md-ellipsis> constants </span> </a> </li> <li class=md-nav__item> <a href=../context_tools.html class=md-nav__link> <span class=md-ellipsis> context_tools </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../create/changes.html class=md-nav__link> <span class=md-ellipsis> create </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../delivery.html class=md-nav__link> <span class=md-ellipsis> delivery </span> </a> </li> <li class=md-nav__item> <a href=../editorial.html class=md-nav__link> <span class=md-ellipsis> editorial </span> </a> </li> <li class=md-nav__item> <a href=../entity_uri.html class=md-nav__link> <span class=md-ellipsis> entity_uri </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../farm/patterning.html class=md-nav__link> <span class=md-ellipsis> farm </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../load/plugins.html class=md-nav__link> <span class=md-ellipsis> load </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../plugin_discover.html class=md-nav__link> <span class=md-ellipsis> plugin_discover </span> </a> </li> <li class=md-nav__item> <a href=../project_folders.html class=md-nav__link> <span class=md-ellipsis> project_folders </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_7_14 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> publish </span> </a> <label class="md-nav__link " for=__nav_3_1_1_7_14 id=__nav_3_1_1_7_14_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_1_1_7_14_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_7_14> <span class="md-nav__icon md-icon"></span> publish </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=abstract_collect_render.html class=md-nav__link> <span class=md-ellipsis> abstract_collect_render </span> </a> </li> <li class=md-nav__item> <a href=abstract_expected_files.html class=md-nav__link> <span class=md-ellipsis> abstract_expected_files </span> </a> </li> <li class=md-nav__item> <a href=constants.html class=md-nav__link> <span class=md-ellipsis> constants </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> lib </span> <span class="md-nav__icon md-icon"></span> </label> <a href=lib.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> lib </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.add_repre_files_for_cleanup class=md-nav__link> <span class=md-ellipsis> add_repre_files_for_cleanup </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.apply_plugin_settings_automatically class=md-nav__link> <span class=md-ellipsis> apply_plugin_settings_automatically </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.context_plugin_should_run class=md-nav__link> <span class=md-ellipsis> context_plugin_should_run </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.filter_instances_for_context_plugin class=md-nav__link> <span class=md-ellipsis> filter_instances_for_context_plugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.filter_pyblish_plugins class=md-nav__link> <span class=md-ellipsis> filter_pyblish_plugins </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_errored_instances_from_context class=md-nav__link> <span class=md-ellipsis> get_errored_instances_from_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_errored_plugins_from_context class=md-nav__link> <span class=md-ellipsis> get_errored_plugins_from_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_hero_template_name_profiles class=md-nav__link> <span class=md-ellipsis> get_hero_template_name_profiles </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_instance_expected_output_path class=md-nav__link> <span class=md-ellipsis> get_instance_expected_output_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_instance_staging_dir class=md-nav__link> <span class=md-ellipsis> get_instance_staging_dir </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_plugin_settings class=md-nav__link> <span class=md-ellipsis> get_plugin_settings </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_instance_families class=md-nav__link> <span class=md-ellipsis> get_publish_instance_families </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_instance_label class=md-nav__link> <span class=md-ellipsis> get_publish_instance_label </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_repre_path class=md-nav__link> <span class=md-ellipsis> get_publish_repre_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_template_name class=md-nav__link> <span class=md-ellipsis> get_publish_template_name </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_published_workfile_instance class=md-nav__link> <span class=md-ellipsis> get_published_workfile_instance </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_template_name_profiles class=md-nav__link> <span class=md-ellipsis> get_template_name_profiles </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.load_help_content_from_filepath class=md-nav__link> <span class=md-ellipsis> load_help_content_from_filepath </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.main_cli_publish class=md-nav__link> <span class=md-ellipsis> main_cli_publish </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.publish_plugins_discover class=md-nav__link> <span class=md-ellipsis> publish_plugins_discover </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.replace_with_published_scene_path class=md-nav__link> <span class=md-ellipsis> replace_with_published_scene_path </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=publish_plugins.html class=md-nav__link> <span class=md-ellipsis> publish_plugins </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../schema/index.html class=md-nav__link> <span class=md-ellipsis> schema </span> </a> </li> <li class=md-nav__item> <a href=../staging_dir.html class=md-nav__link> <span class=md-ellipsis> staging_dir </span> </a> </li> <li class=md-nav__item> <a href=../tempdir.html class=md-nav__link> <span class=md-ellipsis> tempdir </span> </a> </li> <li class=md-nav__item> <a href=../template_data.html class=md-nav__link> <span class=md-ellipsis> template_data </span> </a> </li> <li class=md-nav__item> <a href=../thumbnails.html class=md-nav__link> <span class=md-ellipsis> thumbnails </span> </a> </li> <li class=md-nav__item> <a href=../usdlib.html class=md-nav__link> <span class=md-ellipsis> usdlib </span> </a> </li> <li class=md-nav__item> <a href=../version_start.html class=md-nav__link> <span class=md-ellipsis> version_start </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../workfile/build_workfile.html class=md-nav__link> <span class=md-ellipsis> workfile </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../plugins/actions/open_file_explorer.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../resources/app_icons/index.html class=md-nav__link> <span class=md-ellipsis> resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../scripts/ocio_wrapper.html class=md-nav__link> <span class=md-ellipsis> scripts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../settings/lib.html class=md-nav__link> <span class=md-ellipsis> settings </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../style/color_defs.html class=md-nav__link> <span class=md-ellipsis> style </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tests/conftest.html class=md-nav__link> <span class=md-ellipsis> tests </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tools/attribute_defs/_constants.html class=md-nav__link> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../vendor/python/qargparse.html class=md-nav__link> <span class=md-ellipsis> vendor </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../server/settings/conversion.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.add_repre_files_for_cleanup class=md-nav__link> <span class=md-ellipsis> add_repre_files_for_cleanup </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.apply_plugin_settings_automatically class=md-nav__link> <span class=md-ellipsis> apply_plugin_settings_automatically </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.context_plugin_should_run class=md-nav__link> <span class=md-ellipsis> context_plugin_should_run </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.filter_instances_for_context_plugin class=md-nav__link> <span class=md-ellipsis> filter_instances_for_context_plugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.filter_pyblish_plugins class=md-nav__link> <span class=md-ellipsis> filter_pyblish_plugins </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_errored_instances_from_context class=md-nav__link> <span class=md-ellipsis> get_errored_instances_from_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_errored_plugins_from_context class=md-nav__link> <span class=md-ellipsis> get_errored_plugins_from_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_hero_template_name_profiles class=md-nav__link> <span class=md-ellipsis> get_hero_template_name_profiles </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_instance_expected_output_path class=md-nav__link> <span class=md-ellipsis> get_instance_expected_output_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_instance_staging_dir class=md-nav__link> <span class=md-ellipsis> get_instance_staging_dir </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_plugin_settings class=md-nav__link> <span class=md-ellipsis> get_plugin_settings </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_instance_families class=md-nav__link> <span class=md-ellipsis> get_publish_instance_families </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_instance_label class=md-nav__link> <span class=md-ellipsis> get_publish_instance_label </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_repre_path class=md-nav__link> <span class=md-ellipsis> get_publish_repre_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_publish_template_name class=md-nav__link> <span class=md-ellipsis> get_publish_template_name </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_published_workfile_instance class=md-nav__link> <span class=md-ellipsis> get_published_workfile_instance </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.get_template_name_profiles class=md-nav__link> <span class=md-ellipsis> get_template_name_profiles </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.load_help_content_from_filepath class=md-nav__link> <span class=md-ellipsis> load_help_content_from_filepath </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.main_cli_publish class=md-nav__link> <span class=md-ellipsis> main_cli_publish </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.publish_plugins_discover class=md-nav__link> <span class=md-ellipsis> publish_plugins_discover </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.pipeline.publish.lib.replace_with_published_scene_path class=md-nav__link> <span class=md-ellipsis> replace_with_published_scene_path </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>lib</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_core.pipeline.publish.lib></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.add_repre_files_for_cleanup class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_repre_files_for_cleanup</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Explicitly mark repre files to be deleted.</p> <p>Should be used on intermediate files (eg. review, thumbnails) to be explicitly deleted.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span>
<span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>add_repre_files_for_cleanup</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Explicitly mark repre files to be deleted.</span>

<span class=sd>    Should be used on intermediate files (eg. review, thumbnails) to be</span>
<span class=sd>    explicitly deleted.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
    <span class=n>staging_dir</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>)</span>

    <span class=c1># first make sure representation level is not persistent</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=ow>not</span> <span class=n>staging_dir</span>
        <span class=ow>or</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;stagingDir_persistent&quot;</span><span class=p>)</span>
    <span class=p>):</span>
        <span class=k>return</span>

    <span class=c1># then look into instance level if it&#39;s not persistent</span>
    <span class=k>if</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;stagingDir_persistent&quot;</span><span class=p>):</span>
        <span class=k>return</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>files</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
        <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>files</span><span class=p>]</span>

    <span class=k>for</span> <span class=n>file_name</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
        <span class=n>expected_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>file_name</span><span class=p>)</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;cleanupFullPaths&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>expected_file</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.apply_plugin_settings_automatically class="doc doc-heading"> <code class="highlight language-python"><span class=n>apply_plugin_settings_automatically</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>settings</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Automatically apply plugin settings to a plugin object.</p> <details class=note open> <summary>Note</summary> <p>This function was created to be able to use it in custom overrides of 'apply_settings' class method.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plugin</code> </td> <td> <code><span title=type>type</span>[<span title=pyblish.api.Plugin>Plugin</span>]</code> </td> <td> <div class=doc-md-description> <p>Class of a plugin.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>settings</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Plugin specific settings.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=logging.Logger>Logger</span>]</code> </td> <td> <div class=doc-md-description> <p>Logger to log debug messages about applied settings values.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>apply_plugin_settings_automatically</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>settings</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Automatically apply plugin settings to a plugin object.</span>

<span class=sd>    Note:</span>
<span class=sd>        This function was created to be able to use it in custom overrides of</span>
<span class=sd>            &#39;apply_settings&#39; class method.</span>

<span class=sd>    Args:</span>
<span class=sd>        plugin (type[pyblish.api.Plugin]): Class of a plugin.</span>
<span class=sd>        settings (dict[str, Any]): Plugin specific settings.</span>
<span class=sd>        logger (Optional[logging.Logger]): Logger to log debug messages about</span>
<span class=sd>            applied settings values.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>for</span> <span class=n>option</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>settings</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=k>if</span> <span class=n>logger</span><span class=p>:</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Plugin </span><span class=si>%s</span><span class=s2> - Attr: </span><span class=si>%s</span><span class=s2> -&gt; </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span>
                         <span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>option</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
        <span class=nb>setattr</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>option</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.context_plugin_should_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>context_plugin_should_run</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return whether the ContextPlugin should run on the given context.</p> <p>This is a helper function to work around a bug pyblish-base<a class="gh-link gh-issue" href=https://github.com///issues/250 title="GitHub Issue / #250">#250</a> Whenever a ContextPlugin sets specific families it will still trigger even when no instances are present that have those families.</p> <p>This actually checks it correctly and returns whether it should run.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plugin</code> </td> <td> <code><span title=pyblish.api.Plugin>Plugin</span></code> </td> <td> <div class=doc-md-description> <p>Plugin with filters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=pyblish.api.Context>Context</span></code> </td> <td> <div class=doc-md-description> <p>Pyblish context with instances.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> </td> <td> <div class=doc-md-description> <p>Context plugin should run based on valid instances.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>context_plugin_should_run</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return whether the ContextPlugin should run on the given context.</span>

<span class=sd>    This is a helper function to work around a bug pyblish-base#250</span>
<span class=sd>    Whenever a ContextPlugin sets specific families it will still trigger even</span>
<span class=sd>    when no instances are present that have those families.</span>

<span class=sd>    This actually checks it correctly and returns whether it should run.</span>

<span class=sd>    Args:</span>
<span class=sd>        plugin (pyblish.api.Plugin): Plugin with filters.</span>
<span class=sd>        context (pyblish.api.Context): Pyblish context with instances.</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: Context plugin should run based on valid instances.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>filter_instances_for_context_plugin</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.filter_instances_for_context_plugin class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_instances_for_context_plugin</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Filter instances on context by context plugin filters.</p> <p>This is for cases when context plugin need similar filtering like instance plugin have, but for some reason must run on context or should find out if there is at least one instance with a family.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plugin</code> </td> <td> <code><span title=pyblish.api.Plugin>Plugin</span></code> </td> <td> <div class=doc-md-description> <p>Plugin with filters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=pyblish.api.Context>Context</span></code> </td> <td> <div class=doc-md-description> <p>Pyblish context with insances.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Iterator[pyblish.lib.Instance]: Iteration of valid instances.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>filter_instances_for_context_plugin</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Filter instances on context by context plugin filters.</span>

<span class=sd>    This is for cases when context plugin need similar filtering like instance</span>
<span class=sd>    plugin have, but for some reason must run on context or should find out</span>
<span class=sd>    if there is at least one instance with a family.</span>

<span class=sd>    Args:</span>
<span class=sd>        plugin (pyblish.api.Plugin): Plugin with filters.</span>
<span class=sd>        context (pyblish.api.Context): Pyblish context with insances.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Iterator[pyblish.lib.Instance]: Iteration of valid instances.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>instances</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>plugin_families</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
    <span class=n>all_families</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=k>if</span> <span class=n>plugin</span><span class=o>.</span><span class=n>families</span><span class=p>:</span>
        <span class=n>instances</span> <span class=o>=</span> <span class=n>context</span>
        <span class=n>plugin_families</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>plugin</span><span class=o>.</span><span class=n>families</span><span class=p>)</span>
        <span class=n>all_families</span> <span class=o>=</span> <span class=s2>&quot;*&quot;</span> <span class=ow>in</span> <span class=n>plugin_families</span>

    <span class=k>for</span> <span class=n>instance</span> <span class=ow>in</span> <span class=n>instances</span><span class=p>:</span>
        <span class=c1># Ignore inactive instances</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publish&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
            <span class=ow>or</span> <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;active&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=k>continue</span>

        <span class=n>family</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
        <span class=n>families</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>all_families</span>
            <span class=ow>or</span> <span class=p>(</span><span class=n>family</span> <span class=ow>and</span> <span class=n>family</span> <span class=ow>in</span> <span class=n>plugin_families</span><span class=p>)</span>
            <span class=ow>or</span> <span class=nb>any</span><span class=p>(</span><span class=n>f</span> <span class=ow>in</span> <span class=n>plugin_families</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>families</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=k>yield</span> <span class=n>instance</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.filter_pyblish_plugins class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_pyblish_plugins</span><span class=p>(</span><span class=n>plugins</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Pyblish plugin filter which applies AYON settings.</p> <p>Apply settings on discovered plugins. On plugin with implemented class method 'def apply_settings(cls, project_settings)' is called the method. Default behavior looks for plugin name and current host name to look for</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plugins</code> </td> <td> <code><span title=typing.List>List</span>[<span title=pyblish.plugin.Plugin>Plugin</span>]</code> </td> <td> <div class=doc-md-description> <p>Discovered plugins on which are applied settings.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>filter_pyblish_plugins</span><span class=p>(</span><span class=n>plugins</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Pyblish plugin filter which applies AYON settings.</span>

<span class=sd>    Apply settings on discovered plugins. On plugin with implemented</span>
<span class=sd>    class method &#39;def apply_settings(cls, project_settings)&#39;</span>
<span class=sd>    is called the method. Default behavior looks for plugin name and current</span>
<span class=sd>    host name to look for</span>

<span class=sd>    Args:</span>
<span class=sd>        plugins (List[pyblish.plugin.Plugin]): Discovered plugins on which</span>
<span class=sd>            are applied settings.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>log</span> <span class=o>=</span> <span class=n>Logger</span><span class=o>.</span><span class=n>get_logger</span><span class=p>(</span><span class=s2>&quot;filter_pyblish_plugins&quot;</span><span class=p>)</span>

    <span class=c1># TODO: Don&#39;t use host from &#39;pyblish.api&#39; but from defined host by us.</span>
    <span class=c1>#   - kept becau on farm is probably used host &#39;shell&#39; which propably</span>
    <span class=c1>#       affect how settings are applied there</span>
    <span class=n>host_name</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>current_host</span><span class=p>()</span>
    <span class=n>project_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_PROJECT_NAME&quot;</span><span class=p>)</span>

    <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=c1># iterate over plugins</span>
    <span class=k>for</span> <span class=n>plugin</span> <span class=ow>in</span> <span class=n>plugins</span><span class=p>[:]:</span>
        <span class=c1># Apply settings to plugins</span>

        <span class=n>apply_settings_func</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=s2>&quot;apply_settings&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>apply_settings_func</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># Use classmethod &#39;apply_settings&#39;</span>
            <span class=c1># - can be used to target settings from custom settings place</span>
            <span class=c1># - skip default behavior when successful</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>plugin</span><span class=o>.</span><span class=n>apply_settings</span><span class=p>(</span><span class=n>project_settings</span><span class=p>)</span>

            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                    <span class=p>(</span>
                        <span class=s2>&quot;Failed to apply settings on plugin </span><span class=si>{}</span><span class=s2>&quot;</span>
                    <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>),</span>
                    <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Automated</span>
            <span class=n>plugin_settins</span> <span class=o>=</span> <span class=n>get_plugin_settings</span><span class=p>(</span>
                <span class=n>plugin</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>log</span><span class=p>,</span> <span class=n>host_name</span>
            <span class=p>)</span>
            <span class=n>apply_plugin_settings_automatically</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>plugin_settins</span><span class=p>,</span> <span class=n>log</span><span class=p>)</span>

        <span class=c1># Remove disabled plugins</span>
        <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=s2>&quot;enabled&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>:</span>
            <span class=n>plugins</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>plugin</span><span class=p>)</span>

        <span class=c1># Pyblish already operated a filter based on host.</span>
        <span class=c1># But applying settings might have changed &quot;hosts&quot;</span>
        <span class=c1># value in plugin so re-filter.</span>
        <span class=k>elif</span> <span class=ow>not</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>host_is_compatible</span><span class=p>(</span><span class=n>plugin</span><span class=p>):</span>
            <span class=n>plugins</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>plugin</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_errored_instances_from_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_errored_instances_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>plugin</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Collect failed instances from pyblish context.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=pyblish.api.Context>Context</span></code> </td> <td> <div class=doc-md-description> <p>Publish context where we're looking for failed instances.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>plugin</code> </td> <td> <code><span title=pyblish.api.Plugin>Plugin</span></code> </td> <td> <div class=doc-md-description> <p>If provided then only consider errors related to that plug-in.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>List[pyblish.lib.Instance]: Instances which failed during processing.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_errored_instances_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>plugin</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Collect failed instances from pyblish context.</span>

<span class=sd>    Args:</span>
<span class=sd>        context (pyblish.api.Context): Publish context where we&#39;re looking</span>
<span class=sd>            for failed instances.</span>
<span class=sd>        plugin (pyblish.api.Plugin): If provided then only consider errors</span>
<span class=sd>            related to that plug-in.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[pyblish.lib.Instance]: Instances which failed during processing.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>instances</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;results&quot;</span><span class=p>]:</span>
        <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;instance&quot;</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># When instance is None we are on the &quot;context&quot; result</span>
            <span class=k>continue</span>

        <span class=k>if</span> <span class=n>plugin</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;plugin&quot;</span><span class=p>)</span> <span class=o>!=</span> <span class=n>plugin</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]:</span>
            <span class=n>instances</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;instance&quot;</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>instances</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_errored_plugins_from_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_errored_plugins_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Collect failed plugins from pyblish context.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=pyblish.api.Context>Context</span></code> </td> <td> <div class=doc-md-description> <p>Publish context where we're looking for failed plugins.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>List[pyblish.api.Plugin]: Plugins which failed during processing.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_errored_plugins_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Collect failed plugins from pyblish context.</span>

<span class=sd>    Args:</span>
<span class=sd>        context (pyblish.api.Context): Publish context where we&#39;re looking</span>
<span class=sd>            for failed plugins.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[pyblish.api.Plugin]: Plugins which failed during processing.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>plugins</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
    <span class=n>results</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;results&quot;</span><span class=p>,</span> <span class=p>[])</span>
    <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;success&quot;</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=n>plugins</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;plugin&quot;</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>plugins</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_hero_template_name_profiles class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_hero_template_name_profiles</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Receive profiles for hero publish template keys.</p> <p>At least one of arguments must be passed.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project where to look for templates.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=Dict>Dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Prepared project settings.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=logging.Logger>Logger</span>]</code> </td> <td> <div class=doc-md-description> <p>Logger object to be used instead of default logger.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>List[Dict[str, Any]]: Publish template profiles.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_hero_template_name_profiles</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Receive profiles for hero publish template keys.</span>

<span class=sd>    At least one of arguments must be passed.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project where to look for templates.</span>
<span class=sd>        project_settings (Dict[str, Any]): Prepared project settings.</span>
<span class=sd>        logger (Optional[logging.Logger]): Logger object to be used instead</span>
<span class=sd>            of default logger.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[Dict[str, Any]]: Publish template profiles.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>project_settings</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>((</span>
            <span class=s2>&quot;Both project name and project settings are missing.&quot;</span>
            <span class=s2>&quot; At least one must be entered.&quot;</span>
        <span class=p>))</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_settings</span><span class=p>:</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span>
        <span class=n>project_settings</span>
        <span class=p>[</span><span class=s2>&quot;core&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;tools&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;publish&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;hero_template_name_profiles&quot;</span><span class=p>]</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_instance_expected_output_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_instance_expected_output_path</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>representation_name</span><span class=p>,</span> <span class=n>ext</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return expected publish filepath for representation in instance</p> <p>This does not validate whether the instance has any representation by the given name, extension and/or version.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>instance</code> </td> <td> <code><span title=pyblish.api.Instance>Instance</span></code> </td> <td> <div class=doc-md-description> <p>Publish instance</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>ext</code> </td> <td> <code><span title=typing.Union>Union</span>[<span title=str>str</span>, None]</code> </td> <td> <div class=doc-md-description> <p>Extension for the file. When None, the <code>ext</code> will be set to the representation name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>version</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>If provided, force it to format to this particular version.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Resolved path</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>913</span>
<span class=normal>914</span>
<span class=normal>915</span>
<span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span>
<span class=normal>929</span>
<span class=normal>930</span>
<span class=normal>931</span>
<span class=normal>932</span>
<span class=normal>933</span>
<span class=normal>934</span>
<span class=normal>935</span>
<span class=normal>936</span>
<span class=normal>937</span>
<span class=normal>938</span>
<span class=normal>939</span>
<span class=normal>940</span>
<span class=normal>941</span>
<span class=normal>942</span>
<span class=normal>943</span>
<span class=normal>944</span>
<span class=normal>945</span>
<span class=normal>946</span>
<span class=normal>947</span>
<span class=normal>948</span>
<span class=normal>949</span>
<span class=normal>950</span>
<span class=normal>951</span>
<span class=normal>952</span>
<span class=normal>953</span>
<span class=normal>954</span>
<span class=normal>955</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_instance_expected_output_path</span><span class=p>(</span>
        <span class=n>instance</span><span class=p>:</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>Instance</span><span class=p>,</span>
        <span class=n>representation_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>ext</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span>
        <span class=n>version</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return expected publish filepath for representation in instance</span>

<span class=sd>    This does not validate whether the instance has any representation by the</span>
<span class=sd>    given name, extension and/or version.</span>

<span class=sd>    Arguments:</span>
<span class=sd>        instance (pyblish.api.Instance): Publish instance</span>
<span class=sd>        representation_name (str): Representation name</span>
<span class=sd>        ext (Union[str, None]): Extension for the file.</span>
<span class=sd>            When None, the `ext` will be set to the representation name.</span>
<span class=sd>        version (Optional[int]): If provided, force it to format to this</span>
<span class=sd>            particular version.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Resolved path</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>ext</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>ext</span> <span class=o>=</span> <span class=n>representation_name</span>
    <span class=k>if</span> <span class=n>version</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>version</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span>

    <span class=n>context</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span>
    <span class=n>anatomy</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomy&quot;</span><span class=p>]</span>

    <span class=n>template_data</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomyData&quot;</span><span class=p>])</span>
    <span class=n>template_data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
        <span class=s2>&quot;ext&quot;</span><span class=p>:</span> <span class=n>ext</span><span class=p>,</span>
        <span class=s2>&quot;representation&quot;</span><span class=p>:</span> <span class=n>representation_name</span><span class=p>,</span>
        <span class=s2>&quot;variant&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;variant&quot;</span><span class=p>),</span>
        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span>
    <span class=p>})</span>

    <span class=n>path_template_obj</span> <span class=o>=</span> <span class=n>anatomy</span><span class=o>.</span><span class=n>get_template_item</span><span class=p>(</span><span class=s2>&quot;publish&quot;</span><span class=p>,</span> <span class=s2>&quot;default&quot;</span><span class=p>)[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>
    <span class=n>template_filled</span> <span class=o>=</span> <span class=n>path_template_obj</span><span class=o>.</span><span class=n>format_strict</span><span class=p>(</span><span class=n>template_data</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>template_filled</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_instance_staging_dir class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_instance_staging_dir</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Unified way how staging dir is stored and created on instances.</p> <p>First check if 'stagingDir' is already set in instance data. In case there already is new tempdir will not be created.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Path to staging dir</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_instance_staging_dir</span><span class=p>(</span><span class=n>instance</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Unified way how staging dir is stored and created on instances.</span>

<span class=sd>    First check if &#39;stagingDir&#39; is already set in instance data.</span>
<span class=sd>    In case there already is new tempdir will not be created.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Path to staging dir</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>staging_dir</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>staging_dir</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>staging_dir</span>

    <span class=n>anatomy_data</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomyData&quot;</span><span class=p>]</span>
    <span class=n>template_data</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>anatomy_data</span><span class=p>)</span>

    <span class=c1># context data based variables</span>
    <span class=n>context</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span>

    <span class=c1># add current file as workfile name into formatting data</span>
    <span class=n>current_file</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;currentFile&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>current_file</span><span class=p>:</span>
        <span class=n>workfile</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>current_file</span><span class=p>)</span>
        <span class=n>workfile_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>workfile</span><span class=p>)</span>
        <span class=n>template_data</span><span class=p>[</span><span class=s2>&quot;workfile_name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>workfile_name</span>

    <span class=n>staging_dir_info</span> <span class=o>=</span> <span class=n>get_staging_dir_info</span><span class=p>(</span>
        <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;projectEntity&quot;</span><span class=p>],</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;folderEntity&quot;</span><span class=p>),</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;taskEntity&quot;</span><span class=p>),</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;productType&quot;</span><span class=p>],</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;productName&quot;</span><span class=p>],</span>
        <span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;hostName&quot;</span><span class=p>],</span>
        <span class=n>anatomy</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomy&quot;</span><span class=p>],</span>
        <span class=n>project_settings</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;project_settings&quot;</span><span class=p>],</span>
        <span class=n>template_data</span><span class=o>=</span><span class=n>template_data</span><span class=p>,</span>
        <span class=n>always_return_path</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>username</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;user&quot;</span><span class=p>],</span>
    <span class=p>)</span>

    <span class=n>staging_dir_path</span> <span class=o>=</span> <span class=n>staging_dir_info</span><span class=o>.</span><span class=n>directory</span>

    <span class=c1># path might be already created by get_staging_dir_info</span>
    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>staging_dir_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
        <span class=s2>&quot;stagingDir&quot;</span><span class=p>:</span> <span class=n>staging_dir_path</span><span class=p>,</span>
        <span class=s2>&quot;stagingDir_persistent&quot;</span><span class=p>:</span> <span class=n>staging_dir_info</span><span class=o>.</span><span class=n>is_persistent</span><span class=p>,</span>
        <span class=s2>&quot;stagingDir_is_custom&quot;</span><span class=p>:</span> <span class=n>staging_dir_info</span><span class=o>.</span><span class=n>is_custom</span>
    <span class=p>})</span>

    <span class=k>return</span> <span class=n>staging_dir_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_plugin_settings class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_plugin_settings</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>log</span><span class=p>,</span> <span class=n>category</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get plugin settings based on host name and plugin name.</p> <details class=note open> <summary>Note</summary> <p>Default implementation of automated settings is passing host name into 'category'.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plugin</code> </td> <td> <code><span title=pyblish.Plugin>Plugin</span></code> </td> <td> <div class=doc-md-description> <p>Plugin where settings are applied.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Project settings.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>log</code> </td> <td> <code><span title=logging.Logger>Logger</span></code> </td> <td> <div class=doc-md-description> <p>Logger to log messages.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>category</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Settings category key where to look for plugin settings.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>dict[str, Any]: Plugin settings {'attribute': 'value'}.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_plugin_settings</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>log</span><span class=p>,</span> <span class=n>category</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get plugin settings based on host name and plugin name.</span>

<span class=sd>    Note:</span>
<span class=sd>        Default implementation of automated settings is passing host name</span>
<span class=sd>            into &#39;category&#39;.</span>

<span class=sd>    Args:</span>
<span class=sd>        plugin (pyblish.Plugin): Plugin where settings are applied.</span>
<span class=sd>        project_settings (dict[str, Any]): Project settings.</span>
<span class=sd>        log (logging.Logger): Logger to log messages.</span>
<span class=sd>        category (Optional[str]): Settings category key where to look</span>
<span class=sd>            for plugin settings.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict[str, Any]: Plugin settings {&#39;attribute&#39;: &#39;value&#39;}.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Plugin can define settings category by class attribute</span>
    <span class=c1># - it&#39;s impossible to set `settings_category` via settings because</span>
    <span class=c1>#     obviously settings are not applied before it.</span>
    <span class=c1># - if `settings_category` is set the fallback category method is ignored</span>
    <span class=n>settings_category</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>plugin</span><span class=p>,</span> <span class=s2>&quot;settings_category&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>settings_category</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>category_settings</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=n>settings_category</span><span class=p>]</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
                <span class=s2>&quot;Couldn&#39;t find settings category &#39;</span><span class=si>{}</span><span class=s2>&#39; in project settings&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>settings_category</span><span class=p>))</span>
            <span class=k>return</span> <span class=p>{}</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>category_settings</span><span class=p>[</span><span class=s2>&quot;publish&quot;</span><span class=p>][</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>{}</span>

    <span class=c1># Use project settings based on a category name</span>
    <span class=k>if</span> <span class=n>category</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>(</span>
                <span class=n>project_settings</span>
                <span class=p>[</span><span class=n>category</span><span class=p>]</span>
                <span class=p>[</span><span class=s2>&quot;publish&quot;</span><span class=p>]</span>
                <span class=p>[</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span>
            <span class=p>)</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=k>pass</span>

    <span class=c1># Settings category determined from path</span>
    <span class=c1># - usually path is &#39;./&lt;category&gt;/plugins/publish/&lt;plugin file&gt;&#39;</span>
    <span class=c1># - category can be host name of addon name (&#39;maya&#39;, &#39;deadline&#39;, ...)</span>
    <span class=n>filepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>inspect</span><span class=o>.</span><span class=n>getsourcefile</span><span class=p>(</span><span class=n>plugin</span><span class=p>))</span>

    <span class=n>split_path</span> <span class=o>=</span> <span class=n>filepath</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>sep</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>split_path</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>:</span>
        <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
            <span class=s2>&quot;Plugin path is too short to automatically&quot;</span>
            <span class=s2>&quot; extract settings category. </span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>filepath</span><span class=p>))</span>
        <span class=k>return</span> <span class=p>{}</span>

    <span class=n>category_from_file</span> <span class=o>=</span> <span class=n>split_path</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>]</span>
    <span class=n>plugin_kind</span> <span class=o>=</span> <span class=n>split_path</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>

    <span class=c1># TODO: change after all plugins are moved one level up</span>
    <span class=k>if</span> <span class=n>category_from_file</span> <span class=o>==</span> <span class=s2>&quot;ayon_core&quot;</span><span class=p>:</span>
        <span class=n>category_from_file</span> <span class=o>=</span> <span class=s2>&quot;core&quot;</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=n>project_settings</span>
            <span class=p>[</span><span class=n>category_from_file</span><span class=p>]</span>
            <span class=p>[</span><span class=n>plugin_kind</span><span class=p>]</span>
            <span class=p>[</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span>
        <span class=p>)</span>
    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
        <span class=k>pass</span>
    <span class=k>return</span> <span class=p>{}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_publish_instance_families class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_publish_instance_families</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get all families of the instance.</p> <p>Look for families under 'productType' and 'families' keys in instance data. Value of 'productType' is used as first family and then all other families in random order.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>pyblish.api.Instance</code> </td> <td> </td> <td> <div class=doc-md-description> <p>Instance to get families from.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>list[str]: List of families.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_publish_instance_families</span><span class=p>(</span><span class=n>instance</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get all families of the instance.</span>

<span class=sd>    Look for families under &#39;productType&#39; and &#39;families&#39; keys in instance data.</span>
<span class=sd>    Value of &#39;productType&#39; is used as first family and then all other families</span>
<span class=sd>    in random order.</span>

<span class=sd>    Args:</span>
<span class=sd>        pyblish.api.Instance: Instance to get families from.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[str]: List of families.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>family</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
    <span class=n>families</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[])</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>if</span> <span class=n>family</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>
        <span class=n>families</span><span class=o>.</span><span class=n>discard</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>
    <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>families</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_publish_instance_label class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_publish_instance_label</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Try to get label from pyblish instance.</p> <p>First are used values in instance data under 'label' and 'name' keys. Then is used string conversion of instance object -&gt; 'instance._name'.</p> <details class=todos open> <summary>Todos</summary> <p>Maybe 'productName' key could be used too.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>instance</code> </td> <td> <code><span title=pyblish.api.Instance>Instance</span></code> </td> <td> <div class=doc-md-description> <p>Pyblish instance.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Instance label.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_publish_instance_label</span><span class=p>(</span><span class=n>instance</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Try to get label from pyblish instance.</span>

<span class=sd>    First are used values in instance data under &#39;label&#39; and &#39;name&#39; keys. Then</span>
<span class=sd>    is used string conversion of instance object -&gt; &#39;instance._name&#39;.</span>

<span class=sd>    Todos:</span>
<span class=sd>        Maybe &#39;productName&#39; key could be used too.</span>

<span class=sd>    Args:</span>
<span class=sd>        instance (pyblish.api.Instance): Pyblish instance.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Instance label.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>return</span> <span class=p>(</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;label&quot;</span><span class=p>)</span>
        <span class=ow>or</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
        <span class=ow>or</span> <span class=nb>str</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_publish_repre_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_publish_repre_path</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>only_published</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get representation path that can be used for integration.</p> <p>When 'only_published' is set to true the validation of path is not relevant. In that case we just need what is set in 'published_path' as "reference". The reference is not used to get or upload the file but for reference where the file was published.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>instance</code> </td> <td> <code><span title=pyblish.Instance>Instance</span></code> </td> <td> <div class=doc-md-description> <p>Processed instance object. Used for source of staging dir if representation does not have filled it.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>repre</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Representation on instance which could be and could not be integrated with main integrator.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>only_published</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Care only about published paths and ignore if filepath is not existing anymore.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Path to representation file.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>None</code></td> <td> </td> <td> <div class=doc-md-description> <p>Path is not filled or does not exists.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_publish_repre_path</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>only_published</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get representation path that can be used for integration.</span>

<span class=sd>    When &#39;only_published&#39; is set to true the validation of path is not</span>
<span class=sd>    relevant. In that case we just need what is set in &#39;published_path&#39;</span>
<span class=sd>    as &quot;reference&quot;. The reference is not used to get or upload the file but</span>
<span class=sd>    for reference where the file was published.</span>

<span class=sd>    Args:</span>
<span class=sd>        instance (pyblish.Instance): Processed instance object. Used</span>
<span class=sd>            for source of staging dir if representation does not have</span>
<span class=sd>            filled it.</span>
<span class=sd>        repre (dict): Representation on instance which could be and</span>
<span class=sd>            could not be integrated with main integrator.</span>
<span class=sd>        only_published (bool): Care only about published paths and</span>
<span class=sd>            ignore if filepath is not existing anymore.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Path to representation file.</span>
<span class=sd>        None: Path is not filled or does not exists.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>published_path</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;published_path&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>published_path</span><span class=p>:</span>
        <span class=n>published_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>published_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>published_path</span><span class=p>):</span>
            <span class=k>return</span> <span class=n>published_path</span>

    <span class=k>if</span> <span class=n>only_published</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>published_path</span>

    <span class=n>comp_files</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>comp_files</span><span class=p>,</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>,</span> <span class=nb>set</span><span class=p>)):</span>
        <span class=n>filename</span> <span class=o>=</span> <span class=n>comp_files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>filename</span> <span class=o>=</span> <span class=n>comp_files</span>

    <span class=n>staging_dir</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>staging_dir</span><span class=p>:</span>
        <span class=n>staging_dir</span> <span class=o>=</span> <span class=n>get_instance_staging_dir</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

    <span class=c1># Expand the staging dir path in case it&#39;s been stored with the root</span>
    <span class=c1># template syntax</span>
    <span class=n>anatomy</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomy&quot;</span><span class=p>]</span>
    <span class=n>staging_dir</span> <span class=o>=</span> <span class=n>anatomy</span><span class=o>.</span><span class=n>fill_root</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>)</span>

    <span class=n>src_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>filename</span><span class=p>))</span>
    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>src_path</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>src_path</span>
    <span class=k>return</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_publish_template_name class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_publish_template_name</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>host_name</span><span class=p>,</span> <span class=n>product_type</span><span class=p>,</span> <span class=n>task_name</span><span class=p>,</span> <span class=n>task_type</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>hero</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get template name which should be used for passed context.</p> <p>Publish templates are filtered by host name, family, task name and task type.</p> <p>Default template which is used at if profiles are not available or profile has empty value is defined by 'DEFAULT_PUBLISH_TEMPLATE' constant.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project where to look for settings.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>host_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of host integration.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>product_type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Product type for which should be found template.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Task name on which is instance working.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Task type on which is instance working.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=Dict>Dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Prepared project settings.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>hero</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Template is for hero version publishing.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=logging.Logger>Logger</span></code> </td> <td> <div class=doc-md-description> <p>Custom logger used for 'filter_profiles' function.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Template name which should be used for integration.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_publish_template_name</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>host_name</span><span class=p>,</span>
    <span class=n>product_type</span><span class=p>,</span>
    <span class=n>task_name</span><span class=p>,</span>
    <span class=n>task_type</span><span class=p>,</span>
    <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>hero</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>logger</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get template name which should be used for passed context.</span>

<span class=sd>    Publish templates are filtered by host name, family, task name and</span>
<span class=sd>    task type.</span>

<span class=sd>    Default template which is used at if profiles are not available or profile</span>
<span class=sd>    has empty value is defined by &#39;DEFAULT_PUBLISH_TEMPLATE&#39; constant.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project where to look for settings.</span>
<span class=sd>        host_name (str): Name of host integration.</span>
<span class=sd>        product_type (str): Product type for which should be found template.</span>
<span class=sd>        task_name (str): Task name on which is instance working.</span>
<span class=sd>        task_type (str): Task type on which is instance working.</span>
<span class=sd>        project_settings (Dict[str, Any]): Prepared project settings.</span>
<span class=sd>        hero (bool): Template is for hero version publishing.</span>
<span class=sd>        logger (logging.Logger): Custom logger used for &#39;filter_profiles&#39;</span>
<span class=sd>            function.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Template name which should be used for integration.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>template</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>filter_criteria</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;hosts&quot;</span><span class=p>:</span> <span class=n>host_name</span><span class=p>,</span>
        <span class=s2>&quot;product_types&quot;</span><span class=p>:</span> <span class=n>product_type</span><span class=p>,</span>
        <span class=s2>&quot;task_names&quot;</span><span class=p>:</span> <span class=n>task_name</span><span class=p>,</span>
        <span class=s2>&quot;task_types&quot;</span><span class=p>:</span> <span class=n>task_type</span><span class=p>,</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=n>hero</span><span class=p>:</span>
        <span class=n>default_template</span> <span class=o>=</span> <span class=n>DEFAULT_HERO_PUBLISH_TEMPLATE</span>
        <span class=n>profiles</span> <span class=o>=</span> <span class=n>get_hero_template_name_profiles</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>logger</span>
        <span class=p>)</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>profiles</span> <span class=o>=</span> <span class=n>get_template_name_profiles</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>,</span> <span class=n>logger</span>
        <span class=p>)</span>
        <span class=n>default_template</span> <span class=o>=</span> <span class=n>DEFAULT_PUBLISH_TEMPLATE</span>

    <span class=n>profile</span> <span class=o>=</span> <span class=n>filter_profiles</span><span class=p>(</span><span class=n>profiles</span><span class=p>,</span> <span class=n>filter_criteria</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=n>logger</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>profile</span><span class=p>:</span>
        <span class=n>template</span> <span class=o>=</span> <span class=n>profile</span><span class=p>[</span><span class=s2>&quot;template_name&quot;</span><span class=p>]</span>
    <span class=k>return</span> <span class=n>template</span> <span class=ow>or</span> <span class=n>default_template</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_published_workfile_instance class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_published_workfile_instance</span><span class=p>(</span><span class=n>context</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find workfile instance in context</p> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_published_workfile_instance</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Find workfile instance in context&quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>context</span><span class=p>:</span>
        <span class=c1># test if there is instance of workfile waiting</span>
        <span class=c1># to be published.</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>i</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publish&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
            <span class=k>continue</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span>
            <span class=n>i</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;productType&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;workfile&quot;</span>
            <span class=c1># QUESTION Is check in &#39;families&#39; valid?</span>
            <span class=ow>or</span> <span class=s2>&quot;workfile&quot;</span> <span class=ow>in</span> <span class=n>i</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=p>):</span>
            <span class=k>continue</span>

        <span class=k>return</span> <span class=n>i</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.get_template_name_profiles class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_template_name_profiles</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Receive profiles for publish template keys.</p> <p>At least one of arguments must be passed.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project where to look for templates.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_settings</code> </td> <td> <code><span title=Dict>Dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Prepared project settings.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=logging.Logger>Logger</span>]</code> </td> <td> <div class=doc-md-description> <p>Logger object to be used instead of default logger.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>List[Dict[str, Any]]: Publish template profiles.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_template_name_profiles</span><span class=p>(</span>
    <span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Receive profiles for publish template keys.</span>

<span class=sd>    At least one of arguments must be passed.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project where to look for templates.</span>
<span class=sd>        project_settings (Dict[str, Any]): Prepared project settings.</span>
<span class=sd>        logger (Optional[logging.Logger]): Logger object to be used instead</span>
<span class=sd>            of default logger.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[Dict[str, Any]]: Publish template profiles.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>project_settings</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>((</span>
            <span class=s2>&quot;Both project name and project settings are missing.&quot;</span>
            <span class=s2>&quot; At least one must be entered.&quot;</span>
        <span class=p>))</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_settings</span><span class=p>:</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span>
        <span class=n>project_settings</span>
        <span class=p>[</span><span class=s2>&quot;core&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;tools&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;publish&quot;</span><span class=p>]</span>
        <span class=p>[</span><span class=s2>&quot;template_name_profiles&quot;</span><span class=p>]</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.load_help_content_from_filepath class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_help_content_from_filepath</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Load help content from xml file. Xml file may containt errors and warnings.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>load_help_content_from_filepath</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Load help content from xml file.</span>
<span class=sd>    Xml file may containt errors and warnings.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>errors</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>warnings</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;errors&quot;</span><span class=p>:</span> <span class=n>errors</span><span class=p>,</span>
        <span class=s2>&quot;warnings&quot;</span><span class=p>:</span> <span class=n>warnings</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>output</span>
    <span class=n>tree</span> <span class=o>=</span> <span class=n>xml</span><span class=o>.</span><span class=n>etree</span><span class=o>.</span><span class=n>ElementTree</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
    <span class=n>root</span> <span class=o>=</span> <span class=n>tree</span><span class=o>.</span><span class=n>getroot</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>child</span> <span class=ow>in</span> <span class=n>root</span><span class=p>:</span>
        <span class=n>child_id</span> <span class=o>=</span> <span class=n>child</span><span class=o>.</span><span class=n>attrib</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>child_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=c1># Make sure ID is string</span>
        <span class=n>child_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>child_id</span><span class=p>)</span>

        <span class=n>title</span> <span class=o>=</span> <span class=n>child</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;title&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>description</span> <span class=o>=</span> <span class=n>child</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;description&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>detail_node</span> <span class=o>=</span> <span class=n>child</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;detail&quot;</span><span class=p>)</span>
        <span class=n>detail</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>detail_node</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>detail</span> <span class=o>=</span> <span class=n>detail_node</span><span class=o>.</span><span class=n>text</span>
        <span class=k>if</span> <span class=n>child</span><span class=o>.</span><span class=n>tag</span> <span class=o>==</span> <span class=s2>&quot;error&quot;</span><span class=p>:</span>
            <span class=n>errors</span><span class=p>[</span><span class=n>child_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>HelpContent</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>detail</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>child</span><span class=o>.</span><span class=n>tag</span> <span class=o>==</span> <span class=s2>&quot;warning&quot;</span><span class=p>:</span>
            <span class=n>warnings</span><span class=p>[</span><span class=n>child_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>HelpContent</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>detail</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.main_cli_publish class="doc doc-heading"> <code class="highlight language-python"><span class=n>main_cli_publish</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>targets</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>addons_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Start headless publishing.</p> <p>Publish use json from passed path argument.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>path</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to JSON.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>targets</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.List>List</span>[<span title=str>str</span>]]</code> </td> <td> <div class=doc-md-description> <p>List of pyblish targets.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>addons_manager</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=ayon_core.addon.AddonsManager>AddonsManager</span>]</code> </td> <td> <div class=doc-md-description> <p>Addons manager instance.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=RuntimeError>RuntimeError</span></code> </td> <td> <div class=doc-md-description> <p>When there is no path to process or when executed with list of JSON paths.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>main_cli_publish</span><span class=p>(</span>
    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>targets</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>addons_manager</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AddonsManager</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Start headless publishing.</span>

<span class=sd>    Publish use json from passed path argument.</span>

<span class=sd>    Args:</span>
<span class=sd>        path (str): Path to JSON.</span>
<span class=sd>        targets (Optional[List[str]]): List of pyblish targets.</span>
<span class=sd>        addons_manager (Optional[AddonsManager]): Addons manager instance.</span>

<span class=sd>    Raises:</span>
<span class=sd>        RuntimeError: When there is no path to process or when executed with</span>
<span class=sd>            list of JSON paths.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
        <span class=n>install_ayon_plugins</span><span class=p>,</span>
        <span class=n>get_global_context</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=c1># Register target and host</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Path to JSON must be a string.&quot;</span><span class=p>)</span>

    <span class=c1># Fix older jobs</span>
    <span class=k>for</span> <span class=n>src_key</span><span class=p>,</span> <span class=n>dst_key</span> <span class=ow>in</span> <span class=p>(</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_PROJECT&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_PROJECT_NAME&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_ASSET&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_FOLDER_PATH&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_TASK&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_TASK_NAME&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_WORKDIR&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_WORKDIR&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_APP_NAME&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_APP_NAME&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;AVALON_APP&quot;</span><span class=p>,</span> <span class=s2>&quot;AYON_HOST_NAME&quot;</span><span class=p>),</span>
    <span class=p>):</span>
        <span class=k>if</span> <span class=n>src_key</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=ow>and</span> <span class=n>dst_key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>:</span>
            <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=n>dst_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=n>src_key</span><span class=p>]</span>
        <span class=c1># Remove old keys, so we&#39;re sure they&#39;re not used</span>
        <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>src_key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

    <span class=n>log</span> <span class=o>=</span> <span class=n>Logger</span><span class=o>.</span><span class=n>get_logger</span><span class=p>(</span><span class=s2>&quot;CLI-publish&quot;</span><span class=p>)</span>

    <span class=c1># Make public ayon api behave as other user</span>
    <span class=c1># - this works only if public ayon api is using service user</span>
    <span class=n>username</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_USERNAME&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>username</span><span class=p>:</span>
        <span class=c1># NOTE: ayon-python-api does not have public api function to find</span>
        <span class=c1>#   out if is used service user. So we need to have try &gt; except</span>
        <span class=c1>#   block.</span>
        <span class=n>con</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_server_api_connection</span><span class=p>()</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>con</span><span class=o>.</span><span class=n>set_default_service_username</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
            <span class=k>pass</span>

    <span class=n>install_ayon_plugins</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>addons_manager</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>addons_manager</span> <span class=o>=</span> <span class=n>AddonsManager</span><span class=p>()</span>

    <span class=c1># TODO validate if this has to happen</span>
    <span class=c1># - it should happen during &#39;install_ayon_plugins&#39;</span>
    <span class=n>publish_paths</span> <span class=o>=</span> <span class=n>addons_manager</span><span class=o>.</span><span class=n>collect_plugin_paths</span><span class=p>()[</span><span class=s2>&quot;publish&quot;</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>plugin_path</span> <span class=ow>in</span> <span class=n>publish_paths</span><span class=p>:</span>
        <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>register_plugin_path</span><span class=p>(</span><span class=n>plugin_path</span><span class=p>)</span>

    <span class=n>applications_addon</span> <span class=o>=</span> <span class=n>addons_manager</span><span class=o>.</span><span class=n>get_enabled_addon</span><span class=p>(</span><span class=s2>&quot;applications&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>applications_addon</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>context</span> <span class=o>=</span> <span class=n>get_global_context</span><span class=p>()</span>
        <span class=n>env</span> <span class=o>=</span> <span class=n>applications_addon</span><span class=o>.</span><span class=n>get_farm_publish_environment_variables</span><span class=p>(</span>
            <span class=n>context</span><span class=p>[</span><span class=s2>&quot;project_name&quot;</span><span class=p>],</span>
            <span class=n>context</span><span class=p>[</span><span class=s2>&quot;folder_path&quot;</span><span class=p>],</span>
            <span class=n>context</span><span class=p>[</span><span class=s2>&quot;task_name&quot;</span><span class=p>],</span>
        <span class=p>)</span>
        <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>env</span><span class=p>)</span>

    <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>register_host</span><span class=p>(</span><span class=s2>&quot;shell&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>targets</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>target</span> <span class=ow>in</span> <span class=n>targets</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;setting target: </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>register_target</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>register_target</span><span class=p>(</span><span class=s2>&quot;farm&quot;</span><span class=p>)</span>

    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;AYON_PUBLISH_DATA&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>path</span>
    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;HEADLESS_PUBLISH&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;true&#39;</span>  <span class=c1># to use in app lib</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Running publish ...&quot;</span><span class=p>)</span>

    <span class=n>plugins</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>discover</span><span class=p>()</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Using plugins:&quot;</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>plugin</span> <span class=ow>in</span> <span class=n>plugins</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>plugin</span><span class=p>)</span>

    <span class=c1># Error exit as soon as any error occurs.</span>
    <span class=n>error_format</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&quot;Failed </span><span class=si>{plugin.__name__}</span><span class=s2>: &quot;</span>
                    <span class=s2>&quot;</span><span class=si>{error}</span><span class=s2> -- </span><span class=si>{error.traceback}</span><span class=s2>&quot;</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=n>publish_iter</span><span class=p>():</span>
        <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]:</span>
            <span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>error_format</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>result</span><span class=p>))</span>
            <span class=c1># uninstall()</span>
            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Publish finished.&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.publish_plugins_discover class="doc doc-heading"> <code class="highlight language-python"><span class=n>publish_plugins_discover</span><span class=p>(</span><span class=n>paths</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find and return available pyblish plug-ins</p> <p>Overridden function from <code>pyblish</code> module to be able to collect crashed files and reason of their crash.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>paths</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>Paths to discover plug-ins from. If no paths are provided, all paths are searched.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>publish_plugins_discover</span><span class=p>(</span><span class=n>paths</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Find and return available pyblish plug-ins</span>

<span class=sd>    Overridden function from `pyblish` module to be able to collect</span>
<span class=sd>        crashed files and reason of their crash.</span>

<span class=sd>    Arguments:</span>
<span class=sd>        paths (list, optional): Paths to discover plug-ins from.</span>
<span class=sd>            If no paths are provided, all paths are searched.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># The only difference with `pyblish.api.discover`</span>
    <span class=n>result</span> <span class=o>=</span> <span class=n>DiscoverResult</span><span class=p>(</span><span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>Plugin</span><span class=p>)</span>

    <span class=n>plugins</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>plugin_names</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=n>allow_duplicates</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>ALLOW_DUPLICATES</span>
    <span class=n>log</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>log</span>

    <span class=c1># Include plug-ins from registered paths</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>paths</span><span class=p>:</span>
        <span class=n>paths</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>plugin_paths</span><span class=p>()</span>

    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
            <span class=k>continue</span>

        <span class=k>for</span> <span class=n>fname</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>fname</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;_&quot;</span><span class=p>):</span>
                <span class=k>continue</span>

            <span class=n>abspath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>fname</span><span class=p>)</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>abspath</span><span class=p>):</span>
                <span class=k>continue</span>

            <span class=n>mod_name</span><span class=p>,</span> <span class=n>mod_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>fname</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>mod_ext</span> <span class=o>!=</span> <span class=s2>&quot;.py&quot;</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=n>module</span> <span class=o>=</span> <span class=n>import_filepath</span><span class=p>(</span><span class=n>abspath</span><span class=p>,</span> <span class=n>mod_name</span><span class=p>)</span>

                <span class=c1># Store reference to original module, to avoid</span>
                <span class=c1># garbage collection from collecting it&#39;s global</span>
                <span class=c1># imports, such as `import os`.</span>
                <span class=n>sys</span><span class=o>.</span><span class=n>modules</span><span class=p>[</span><span class=n>abspath</span><span class=p>]</span> <span class=o>=</span> <span class=n>module</span>

            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
                <span class=n>result</span><span class=o>.</span><span class=n>crashed_file_paths</span><span class=p>[</span><span class=n>abspath</span><span class=p>]</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>()</span>

                <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Skipped: </span><span class=se>\&quot;</span><span class=si>%s</span><span class=se>\&quot;</span><span class=s2> (</span><span class=si>%s</span><span class=s2>)&quot;</span><span class=p>,</span> <span class=n>mod_name</span><span class=p>,</span> <span class=n>err</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>for</span> <span class=n>plugin</span> <span class=ow>in</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>plugins_from_module</span><span class=p>(</span><span class=n>module</span><span class=p>):</span>
                <span class=c1># Ignore base plugin classes</span>
                <span class=c1># NOTE &#39;pyblish.api.discover&#39; does not ignore them!</span>
                <span class=k>if</span> <span class=p>(</span>
                    <span class=n>plugin</span> <span class=ow>is</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>Plugin</span>
                    <span class=ow>or</span> <span class=n>plugin</span> <span class=ow>is</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>ContextPlugin</span>
                    <span class=ow>or</span> <span class=n>plugin</span> <span class=ow>is</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>InstancePlugin</span>
                <span class=p>):</span>
                    <span class=k>continue</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>allow_duplicates</span> <span class=ow>and</span> <span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span> <span class=ow>in</span> <span class=n>plugin_names</span><span class=p>:</span>
                    <span class=n>result</span><span class=o>.</span><span class=n>duplicated_plugins</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>plugin</span><span class=p>)</span>
                    <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Duplicate plug-in found: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>plugin</span><span class=p>)</span>
                    <span class=k>continue</span>

                <span class=n>plugin_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>

                <span class=n>plugin</span><span class=o>.</span><span class=vm>__module__</span> <span class=o>=</span> <span class=n>module</span><span class=o>.</span><span class=vm>__file__</span>
                <span class=n>key</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{0}</span><span class=s2>.</span><span class=si>{1}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__module__</span><span class=p>,</span> <span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
                <span class=n>plugins</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>plugin</span>

    <span class=c1># Include plug-ins from registration.</span>
    <span class=c1># Directly registered plug-ins take precedence.</span>
    <span class=k>for</span> <span class=n>plugin</span> <span class=ow>in</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>registered_plugins</span><span class=p>():</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>allow_duplicates</span> <span class=ow>and</span> <span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span> <span class=ow>in</span> <span class=n>plugin_names</span><span class=p>:</span>
            <span class=n>result</span><span class=o>.</span><span class=n>duplicated_plugins</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>plugin</span><span class=p>)</span>
            <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Duplicate plug-in found: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>plugin</span><span class=p>)</span>
            <span class=k>continue</span>

        <span class=n>plugin_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>

        <span class=n>plugins</span><span class=p>[</span><span class=n>plugin</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span> <span class=o>=</span> <span class=n>plugin</span>

    <span class=n>plugins</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>plugins</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
    <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>plugins</span><span class=p>)</span>  <span class=c1># In-place</span>

    <span class=c1># In-place user-defined filter</span>
    <span class=k>for</span> <span class=n>filter_</span> <span class=ow>in</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>plugin</span><span class=o>.</span><span class=n>_registered_plugin_filters</span><span class=p>:</span>
        <span class=n>filter_</span><span class=p>(</span><span class=n>plugins</span><span class=p>)</span>

    <span class=n>result</span><span class=o>.</span><span class=n>plugins</span> <span class=o>=</span> <span class=n>plugins</span>

    <span class=k>return</span> <span class=n>result</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.pipeline.publish.lib.replace_with_published_scene_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>replace_with_published_scene_path</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>replace_in_path</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Switch work scene path for published scene. If rendering/exporting from published scenes is enabled, this will replace paths from working scene to published scene. This only works if publish contains workfile instance! Args: instance (pyblish.api.Instance): Pyblish instance. replace_in_path (bool): if True, it will try to find old scene name in path of expected files and replace it with name of published scene. Returns: str: Published scene path. None: if no published scene is found. Note: Published scene path is actually determined from project Anatomy as at the time this plugin is running scene can still not be published.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/pipeline/publish/lib.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>replace_with_published_scene_path</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>replace_in_path</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Switch work scene path for published scene.</span>
<span class=sd>    If rendering/exporting from published scenes is enabled, this will</span>
<span class=sd>    replace paths from working scene to published scene.</span>
<span class=sd>    This only works if publish contains workfile instance!</span>
<span class=sd>    Args:</span>
<span class=sd>        instance (pyblish.api.Instance): Pyblish instance.</span>
<span class=sd>        replace_in_path (bool): if True, it will try to find</span>
<span class=sd>            old scene name in path of expected files and replace it</span>
<span class=sd>            with name of published scene.</span>
<span class=sd>    Returns:</span>
<span class=sd>        str: Published scene path.</span>
<span class=sd>        None: if no published scene is found.</span>
<span class=sd>    Note:</span>
<span class=sd>        Published scene path is actually determined from project Anatomy</span>
<span class=sd>        as at the time this plugin is running scene can still not be</span>
<span class=sd>        published.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>log</span> <span class=o>=</span> <span class=n>Logger</span><span class=o>.</span><span class=n>get_logger</span><span class=p>(</span><span class=s2>&quot;published_workfile&quot;</span><span class=p>)</span>
    <span class=n>workfile_instance</span> <span class=o>=</span> <span class=n>get_published_workfile_instance</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>workfile_instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=c1># determine published path from Anatomy.</span>
    <span class=n>template_data</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>workfile_instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomyData&quot;</span><span class=p>])</span>
    <span class=n>rep</span> <span class=o>=</span> <span class=n>workfile_instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>template_data</span><span class=p>[</span><span class=s2>&quot;representation&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>rep</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
    <span class=n>template_data</span><span class=p>[</span><span class=s2>&quot;ext&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>rep</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;ext&quot;</span><span class=p>)</span>
    <span class=n>template_data</span><span class=p>[</span><span class=s2>&quot;comment&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=n>anatomy</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomy&quot;</span><span class=p>]</span>
    <span class=n>template</span> <span class=o>=</span> <span class=n>anatomy</span><span class=o>.</span><span class=n>get_template_item</span><span class=p>(</span><span class=s2>&quot;publish&quot;</span><span class=p>,</span> <span class=s2>&quot;default&quot;</span><span class=p>,</span> <span class=s2>&quot;path&quot;</span><span class=p>)</span>
    <span class=n>template_filled</span> <span class=o>=</span> <span class=n>template</span><span class=o>.</span><span class=n>format_strict</span><span class=p>(</span><span class=n>template_data</span><span class=p>)</span>
    <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>template_filled</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Using published scene for render </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file_path</span><span class=p>))</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
        <span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;published scene does not exist!&quot;</span><span class=p>)</span>
        <span class=k>raise</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>replace_in_path</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>file_path</span>

    <span class=c1># now we need to switch scene in expected files</span>
    <span class=c1># because &lt;scene&gt; token will now point to published</span>
    <span class=c1># scene file and that might differ from current one</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_clean_name</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>path</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span>

    <span class=n>new_scene</span> <span class=o>=</span> <span class=n>_clean_name</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
    <span class=n>orig_scene</span> <span class=o>=</span> <span class=n>_clean_name</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;currentFile&quot;</span><span class=p>])</span>
    <span class=n>expected_files</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;expectedFiles&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>expected_files</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nb>dict</span><span class=p>):</span>
        <span class=c1># we have aovs and we need to iterate over them</span>
        <span class=n>new_exp</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>aov</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>expected_files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>replaced_files</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
                <span class=n>replaced_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                    <span class=nb>str</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>orig_scene</span><span class=p>,</span> <span class=n>new_scene</span><span class=p>)</span>
                <span class=p>)</span>
            <span class=n>new_exp</span><span class=p>[</span><span class=n>aov</span><span class=p>]</span> <span class=o>=</span> <span class=n>replaced_files</span>
        <span class=c1># [] might be too much here, TODO</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;expectedFiles&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>new_exp</span><span class=p>]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>new_exp</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>expected_files</span><span class=p>:</span>
            <span class=n>new_exp</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=nb>str</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>orig_scene</span><span class=p>,</span> <span class=n>new_scene</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;expectedFiles&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_exp</span>

    <span class=n>metadata_folder</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publishRenderMetadataFolder&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>metadata_folder</span><span class=p>:</span>
        <span class=n>metadata_folder</span> <span class=o>=</span> <span class=n>metadata_folder</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>orig_scene</span><span class=p>,</span>
                                                  <span class=n>new_scene</span><span class=p>)</span>
        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;publishRenderMetadataFolder&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>metadata_folder</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Scene name was switched </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>orig_scene</span><span class=p>,</span> <span class=n>new_scene</span>
    <span class=p>))</span>

    <span class=k>return</span> <span class=n>file_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>