<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=extract_otio_file.html><link rel=next href=extract_otio_trimming_video.html><link rel=icon href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.8"><title>extract_otio_review - ayon-core</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../css/custom.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_core.plugins.publish.extract_otio_review class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../index.html title=ayon-core class="md-header__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-core </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> extract_otio_review </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../index.html title=ayon-core class="md-nav__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../../index.html class="md-nav__link "> <span class=md-ellipsis> client </span> </a> <label class="md-nav__link " for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> ayon_core </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../__main__.html class=md-nav__link> <span class=md-ellipsis> __main__ </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../addon/base.html class=md-nav__link> <span class=md-ellipsis> addon </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../cli.html class=md-nav__link> <span class=md-ellipsis> cli </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../hooks/pre_add_last_workfile_arg.html class=md-nav__link> <span class=md-ellipsis> hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../host/dirmap.html class=md-nav__link> <span class=md-ellipsis> host </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../lib/attribute_definitions.html class=md-nav__link> <span class=md-ellipsis> lib </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../pipeline/actions.html class=md-nav__link> <span class=md-ellipsis> pipeline </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_8 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> plugins </span> </a> <label class="md-nav__link " for=__nav_3_1_1_8 id=__nav_3_1_1_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_8_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_8> <span class="md-nav__icon md-icon"></span> plugins </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../actions/open_file_explorer.html class=md-nav__link> <span class=md-ellipsis> actions </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../inventory/remove_and_load.html class=md-nav__link> <span class=md-ellipsis> inventory </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../load/copy_file.html class=md-nav__link> <span class=md-ellipsis> load </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_8_4 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> publish </span> </a> <label class="md-nav__link " for=__nav_3_1_1_8_4 id=__nav_3_1_1_8_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_1_1_8_4_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_8_4> <span class="md-nav__icon md-icon"></span> publish </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=cleanup.html class=md-nav__link> <span class=md-ellipsis> cleanup </span> </a> </li> <li class=md-nav__item> <a href=cleanup_explicit.html class=md-nav__link> <span class=md-ellipsis> cleanup_explicit </span> </a> </li> <li class=md-nav__item> <a href=cleanup_farm.html class=md-nav__link> <span class=md-ellipsis> cleanup_farm </span> </a> </li> <li class=md-nav__item> <a href=collect_addons.html class=md-nav__link> <span class=md-ellipsis> collect_addons </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_context_data.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_context_data </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_instance_data.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_instance_data </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_object.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_object </span> </a> </li> <li class=md-nav__item> <a href=collect_audio.html class=md-nav__link> <span class=md-ellipsis> collect_audio </span> </a> </li> <li class=md-nav__item> <a href=collect_cleanup_keys.html class=md-nav__link> <span class=md-ellipsis> collect_cleanup_keys </span> </a> </li> <li class=md-nav__item> <a href=collect_comment.html class=md-nav__link> <span class=md-ellipsis> collect_comment </span> </a> </li> <li class=md-nav__item> <a href=collect_context_entities.html class=md-nav__link> <span class=md-ellipsis> collect_context_entities </span> </a> </li> <li class=md-nav__item> <a href=collect_context_label.html class=md-nav__link> <span class=md-ellipsis> collect_context_label </span> </a> </li> <li class=md-nav__item> <a href=collect_current_ayon_user.html class=md-nav__link> <span class=md-ellipsis> collect_current_ayon_user </span> </a> </li> <li class=md-nav__item> <a href=collect_current_context.html class=md-nav__link> <span class=md-ellipsis> collect_current_context </span> </a> </li> <li class=md-nav__item> <a href=collect_current_shell_file.html class=md-nav__link> <span class=md-ellipsis> collect_current_shell_file </span> </a> </li> <li class=md-nav__item> <a href=collect_datetime_data.html class=md-nav__link> <span class=md-ellipsis> collect_datetime_data </span> </a> </li> <li class=md-nav__item> <a href=collect_farm_env_variables.html class=md-nav__link> <span class=md-ellipsis> collect_farm_env_variables </span> </a> </li> <li class=md-nav__item> <a href=collect_farm_target.html class=md-nav__link> <span class=md-ellipsis> collect_farm_target </span> </a> </li> <li class=md-nav__item> <a href=collect_frames_fix.html class=md-nav__link> <span class=md-ellipsis> collect_frames_fix </span> </a> </li> <li class=md-nav__item> <a href=collect_from_create_context.html class=md-nav__link> <span class=md-ellipsis> collect_from_create_context </span> </a> </li> <li class=md-nav__item> <a href=collect_hierarchy.html class=md-nav__link> <span class=md-ellipsis> collect_hierarchy </span> </a> </li> <li class=md-nav__item> <a href=collect_host_name.html class=md-nav__link> <span class=md-ellipsis> collect_host_name </span> </a> </li> <li class=md-nav__item> <a href=collect_input_representations_to_versions.html class=md-nav__link> <span class=md-ellipsis> collect_input_representations_to_versions </span> </a> </li> <li class=md-nav__item> <a href=collect_machine_name.html class=md-nav__link> <span class=md-ellipsis> collect_machine_name </span> </a> </li> <li class=md-nav__item> <a href=collect_managed_staging_dir.html class=md-nav__link> <span class=md-ellipsis> collect_managed_staging_dir </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_frame_ranges.html class=md-nav__link> <span class=md-ellipsis> collect_otio_frame_ranges </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_review.html class=md-nav__link> <span class=md-ellipsis> collect_otio_review </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_subset_resources.html class=md-nav__link> <span class=md-ellipsis> collect_otio_subset_resources </span> </a> </li> <li class=md-nav__item> <a href=collect_rendered_files.html class=md-nav__link> <span class=md-ellipsis> collect_rendered_files </span> </a> </li> <li class=md-nav__item> <a href=collect_resources_path.html class=md-nav__link> <span class=md-ellipsis> collect_resources_path </span> </a> </li> <li class=md-nav__item> <a href=collect_scene_loaded_versions.html class=md-nav__link> <span class=md-ellipsis> collect_scene_loaded_versions </span> </a> </li> <li class=md-nav__item> <a href=collect_scene_version.html class=md-nav__link> <span class=md-ellipsis> collect_scene_version </span> </a> </li> <li class=md-nav__item> <a href=collect_settings.html class=md-nav__link> <span class=md-ellipsis> collect_settings </span> </a> </li> <li class=md-nav__item> <a href=collect_shell_workspace.html class=md-nav__link> <span class=md-ellipsis> collect_shell_workspace </span> </a> </li> <li class=md-nav__item> <a href=collect_source_for_source.html class=md-nav__link> <span class=md-ellipsis> collect_source_for_source </span> </a> </li> <li class=md-nav__item> <a href=collect_time.html class=md-nav__link> <span class=md-ellipsis> collect_time </span> </a> </li> <li class=md-nav__item> <a href=extract_burnin.html class=md-nav__link> <span class=md-ellipsis> extract_burnin </span> </a> </li> <li class=md-nav__item> <a href=extract_color_transcode.html class=md-nav__link> <span class=md-ellipsis> extract_color_transcode </span> </a> </li> <li class=md-nav__item> <a href=extract_colorspace_data.html class=md-nav__link> <span class=md-ellipsis> extract_colorspace_data </span> </a> </li> <li class=md-nav__item> <a href=extract_hierarchy_to_ayon.html class=md-nav__link> <span class=md-ellipsis> extract_hierarchy_to_ayon </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_audio_tracks.html class=md-nav__link> <span class=md-ellipsis> extract_otio_audio_tracks </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_file.html class=md-nav__link> <span class=md-ellipsis> extract_otio_file </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> extract_otio_review </span> <span class="md-nav__icon md-icon"></span> </label> <a href=extract_otio_review.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> extract_otio_review </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review class=md-nav__link> <span class=md-ellipsis> extract_otio_review </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview class=md-nav__link> <span class=md-ellipsis> ExtractOTIOReview </span> </a> <nav class=md-nav aria-label=ExtractOTIOReview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._create_representation class=md-nav__link> <span class=md-ellipsis> _create_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._generate_used_frames class=md-nav__link> <span class=md-ellipsis> _generate_used_frames </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_ffmpeg_output class=md-nav__link> <span class=md-ellipsis> _get_ffmpeg_output </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_folder_name_based_prefix class=md-nav__link> <span class=md-ellipsis> _get_folder_name_based_prefix </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._render_segment class=md-nav__link> <span class=md-ellipsis> _render_segment </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._trim_available_range class=md-nav__link> <span class=md-ellipsis> _trim_available_range </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=extract_otio_trimming_video.html class=md-nav__link> <span class=md-ellipsis> extract_otio_trimming_video </span> </a> </li> <li class=md-nav__item> <a href=extract_review.html class=md-nav__link> <span class=md-ellipsis> extract_review </span> </a> </li> <li class=md-nav__item> <a href=extract_review_slate.html class=md-nav__link> <span class=md-ellipsis> extract_review_slate </span> </a> </li> <li class=md-nav__item> <a href=extract_scanline_exr.html class=md-nav__link> <span class=md-ellipsis> extract_scanline_exr </span> </a> </li> <li class=md-nav__item> <a href=extract_slate_data.html class=md-nav__link> <span class=md-ellipsis> extract_slate_data </span> </a> </li> <li class=md-nav__item> <a href=extract_thumbnail.html class=md-nav__link> <span class=md-ellipsis> extract_thumbnail </span> </a> </li> <li class=md-nav__item> <a href=extract_thumbnail_from_source.html class=md-nav__link> <span class=md-ellipsis> extract_thumbnail_from_source </span> </a> </li> <li class=md-nav__item> <a href=extract_usd_layer_contributions.html class=md-nav__link> <span class=md-ellipsis> extract_usd_layer_contributions </span> </a> </li> <li class=md-nav__item> <a href=help/index.html class=md-nav__link> <span class=md-ellipsis> help </span> </a> </li> <li class=md-nav__item> <a href=integrate.html class=md-nav__link> <span class=md-ellipsis> integrate </span> </a> </li> <li class=md-nav__item> <a href=integrate_hero_version.html class=md-nav__link> <span class=md-ellipsis> integrate_hero_version </span> </a> </li> <li class=md-nav__item> <a href=integrate_inputlinks.html class=md-nav__link> <span class=md-ellipsis> integrate_inputlinks </span> </a> </li> <li class=md-nav__item> <a href=integrate_product_group.html class=md-nav__link> <span class=md-ellipsis> integrate_product_group </span> </a> </li> <li class=md-nav__item> <a href=integrate_resources_path.html class=md-nav__link> <span class=md-ellipsis> integrate_resources_path </span> </a> </li> <li class=md-nav__item> <a href=integrate_review.html class=md-nav__link> <span class=md-ellipsis> integrate_review </span> </a> </li> <li class=md-nav__item> <a href=integrate_thumbnail.html class=md-nav__link> <span class=md-ellipsis> integrate_thumbnail </span> </a> </li> <li class=md-nav__item> <a href=integrate_version_attrs.html class=md-nav__link> <span class=md-ellipsis> integrate_version_attrs </span> </a> </li> <li class=md-nav__item> <a href=preintegrate_thumbnail_representation.html class=md-nav__link> <span class=md-ellipsis> preintegrate_thumbnail_representation </span> </a> </li> <li class=md-nav__item> <a href=repair_unicode_strings.html class=md-nav__link> <span class=md-ellipsis> repair_unicode_strings </span> </a> </li> <li class=md-nav__item> <a href=validate_asset_docs.html class=md-nav__link> <span class=md-ellipsis> validate_asset_docs </span> </a> </li> <li class=md-nav__item> <a href=validate_containers.html class=md-nav__link> <span class=md-ellipsis> validate_containers </span> </a> </li> <li class=md-nav__item> <a href=validate_file_saved.html class=md-nav__link> <span class=md-ellipsis> validate_file_saved </span> </a> </li> <li class=md-nav__item> <a href=validate_filesequences.html class=md-nav__link> <span class=md-ellipsis> validate_filesequences </span> </a> </li> <li class=md-nav__item> <a href=validate_intent.html class=md-nav__link> <span class=md-ellipsis> validate_intent </span> </a> </li> <li class=md-nav__item> <a href=validate_publish_dir.html class=md-nav__link> <span class=md-ellipsis> validate_publish_dir </span> </a> </li> <li class=md-nav__item> <a href=validate_resources.html class=md-nav__link> <span class=md-ellipsis> validate_resources </span> </a> </li> <li class=md-nav__item> <a href=validate_unique_subsets.html class=md-nav__link> <span class=md-ellipsis> validate_unique_subsets </span> </a> </li> <li class=md-nav__item> <a href=validate_version.html class=md-nav__link> <span class=md-ellipsis> validate_version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../resources/app_icons/index.html class=md-nav__link> <span class=md-ellipsis> resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../scripts/ocio_wrapper.html class=md-nav__link> <span class=md-ellipsis> scripts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../settings/lib.html class=md-nav__link> <span class=md-ellipsis> settings </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../style/color_defs.html class=md-nav__link> <span class=md-ellipsis> style </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tests/conftest.html class=md-nav__link> <span class=md-ellipsis> tests </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tools/attribute_defs/_constants.html class=md-nav__link> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../vendor/python/qargparse.html class=md-nav__link> <span class=md-ellipsis> vendor </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../server/settings/conversion.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review class=md-nav__link> <span class=md-ellipsis> extract_otio_review </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview class=md-nav__link> <span class=md-ellipsis> ExtractOTIOReview </span> </a> <nav class=md-nav aria-label=ExtractOTIOReview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._create_representation class=md-nav__link> <span class=md-ellipsis> _create_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._generate_used_frames class=md-nav__link> <span class=md-ellipsis> _generate_used_frames </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_ffmpeg_output class=md-nav__link> <span class=md-ellipsis> _get_ffmpeg_output </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_folder_name_based_prefix class=md-nav__link> <span class=md-ellipsis> _get_folder_name_based_prefix </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._render_segment class=md-nav__link> <span class=md-ellipsis> _render_segment </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._trim_available_range class=md-nav__link> <span class=md-ellipsis> _trim_available_range </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>extract_otio_review</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_core.plugins.publish.extract_otio_review></a> <div class="doc doc-contents first"> <details class=requires open> <summary>Requires</summary> <p>instance -&gt; handleStart instance -&gt; handleEnd instance -&gt; otioClip instance -&gt; otioReviewClips</p> </details> <details class=optional open> <summary>Optional</summary> <p>instance -&gt; workfileFrameStart instance -&gt; resolutionWidth instance -&gt; resolutionHeight</p> </details> <details class=provides open> <summary>Provides</summary> <p>instance -&gt; otioReviewClips</p> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview class="doc doc-heading"> <code>ExtractOTIOReview</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.publish.Extractor>Extractor</span></code>, <code><span title=ayon_core.pipeline.publish.ColormanagedPyblishPluginMixin>ColormanagedPyblishPluginMixin</span></code></p> <p>Extract OTIO timeline into one concuted image sequence file.</p> <p>The <code>otioReviewClip</code> is holding trimmed range of clips relative to the <code>otioClip</code>. Handles are added during looping by available list of Gap and clips in the track. Handle start (head) is added before first Gap or Clip and Handle end (tail) is added at the end of last Clip or Gap. In case there is missing source material after the handles addition Gap will be added. At the end all Gaps are converted to black frames and available material is converted to image sequence frames. At the end representation is created and added to the instance.</p> <p>At the moment only image sequence output is supported</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ExtractOTIOReview</span><span class=p>(</span>
    <span class=n>publish</span><span class=o>.</span><span class=n>Extractor</span><span class=p>,</span>
    <span class=n>publish</span><span class=o>.</span><span class=n>ColormanagedPyblishPluginMixin</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Extract OTIO timeline into one concuted image sequence file.</span>

<span class=sd>    The `otioReviewClip` is holding trimmed range of clips relative to</span>
<span class=sd>    the `otioClip`. Handles are added during looping by available list</span>
<span class=sd>    of Gap and clips in the track. Handle start (head) is added before</span>
<span class=sd>    first Gap or Clip and Handle end (tail) is added at the end of last</span>
<span class=sd>    Clip or Gap. In case there is missing source material after the</span>
<span class=sd>    handles addition Gap will be added. At the end all Gaps are converted</span>
<span class=sd>    to black frames and available material is converted to image sequence</span>
<span class=sd>    frames. At the end representation is created and added to the instance.</span>

<span class=sd>    At the moment only image sequence output is supported</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>order</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>ExtractorOrder</span> <span class=o>-</span> <span class=mf>0.45</span>
    <span class=n>label</span> <span class=o>=</span> <span class=s2>&quot;Extract OTIO review&quot;</span>
    <span class=n>families</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;review&quot;</span><span class=p>]</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;resolve&quot;</span><span class=p>,</span> <span class=s2>&quot;hiero&quot;</span><span class=p>,</span> <span class=s2>&quot;flame&quot;</span><span class=p>]</span>

    <span class=c1># plugin default attributes</span>
    <span class=n>to_width</span> <span class=o>=</span> <span class=mi>1280</span>
    <span class=n>to_height</span> <span class=o>=</span> <span class=mi>720</span>
    <span class=n>output_ext</span> <span class=o>=</span> <span class=s2>&quot;.jpg&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
        <span class=c1># Not all hosts can import these modules.</span>
        <span class=kn>import</span><span class=w> </span><span class=nn>opentimelineio</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>otio</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline.editorial</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
            <span class=n>make_sequence_collection</span><span class=p>,</span>
            <span class=n>remap_range_on_file_sequence</span><span class=p>,</span>
            <span class=n>is_clip_from_media_sequence</span>
        <span class=p>)</span>

        <span class=c1># TODO refactor from using instance variable</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>temp_file_head</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_folder_name_based_prefix</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

        <span class=c1># TODO: convert resulting image sequence to mp4</span>

        <span class=c1># get otio clip and other time info from instance clip</span>
        <span class=n>otio_review_clips</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;otioReviewClips&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>otio_review_clips</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Instance `</span><span class=si>{</span><span class=n>instance</span><span class=si>}</span><span class=s2>` has no otioReviewClips&quot;</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=c1># TODO: what if handles are different in `versionData`?</span>
        <span class=n>handle_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleStart&quot;</span><span class=p>]</span>
        <span class=n>handle_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleEnd&quot;</span><span class=p>]</span>

        <span class=c1># add plugin wide attributes</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>representation_files</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=s2>&quot;workfileFrameStart&quot;</span><span class=p>,</span> <span class=mi>1001</span><span class=p>))</span> <span class=o>-</span> <span class=n>handle_start</span>
        <span class=c1># NOTE: padding has to be converted from</span>
        <span class=c1>#       end frame since start could be lower then 1000</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>padding</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;frameEnd&quot;</span><span class=p>,</span> <span class=mi>1001</span><span class=p>)))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=s2>&quot;resolutionWidth&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=s2>&quot;resolutionHeight&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span>

        <span class=c1># skip instance if no reviewable data available</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>otio</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Clip</span><span class=p>)</span>
            <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
        <span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Instance `</span><span class=si>{}</span><span class=s2>` has nothing to process&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>instance</span><span class=p>))</span>
            <span class=k>return</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;representations&quot;</span><span class=p>):</span>
                <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>

        <span class=c1># loop available clips in otio track</span>
        <span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>r_otio_cl</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>):</span>
            <span class=c1># QUESTION: what if transition on clip?</span>

            <span class=c1># Clip: compute process range from available media range.</span>
            <span class=n>src_range</span> <span class=o>=</span> <span class=n>r_otio_cl</span><span class=o>.</span><span class=n>source_range</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>r_otio_cl</span><span class=p>,</span> <span class=n>otio</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Clip</span><span class=p>):</span>
                <span class=c1># check if resolution is the same as source</span>
                <span class=n>media_ref</span> <span class=o>=</span> <span class=n>r_otio_cl</span><span class=o>.</span><span class=n>media_reference</span>
                <span class=n>media_metadata</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>metadata</span>

                <span class=c1># get from media reference metadata source</span>
                <span class=c1># TODO &#39;openpype&#39; prefix should be removed (added 24/09/03)</span>
                <span class=c1># NOTE it looks like it is set only in hiero integration</span>
                <span class=n>res_data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;width&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span><span class=p>,</span> <span class=s2>&quot;height&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span><span class=p>}</span>
                <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>res_data</span><span class=p>:</span>
                    <span class=k>for</span> <span class=n>meta_prefix</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;ayon.source.&quot;</span><span class=p>,</span> <span class=s2>&quot;openpype.source.&quot;</span><span class=p>):</span>
                        <span class=n>meta_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>meta_prefix</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span>
                        <span class=n>value</span> <span class=o>=</span> <span class=n>media_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>meta_key</span><span class=p>)</span>
                        <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                            <span class=n>res_data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
                            <span class=k>break</span>

                <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>res_data</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>],</span> <span class=n>res_data</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                    <span class=s2>&quot;&gt; self.to_width x self.to_height:&quot;</span>
                    <span class=sa>f</span><span class=s2>&quot; </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>to_width</span><span class=si>}</span><span class=s2> x </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>to_height</span><span class=si>}</span><span class=s2>&quot;</span>
                <span class=p>)</span>

                <span class=n>available_range</span> <span class=o>=</span> <span class=n>r_otio_cl</span><span class=o>.</span><span class=n>available_range</span><span class=p>()</span>
                <span class=n>available_range_start_frame</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>available_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>
                <span class=p>)</span>
                <span class=n>processing_range</span> <span class=o>=</span> <span class=kc>None</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span> <span class=o>=</span> <span class=n>available_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>rate</span>
                <span class=n>start</span> <span class=o>=</span> <span class=n>src_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>rescaled_to</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>)</span>
                <span class=n>duration</span> <span class=o>=</span> <span class=n>src_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>rescaled_to</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>)</span>

                <span class=c1># Temporary.</span>
                <span class=c1># Some AYON custom OTIO exporter were implemented with</span>
                <span class=c1># relative source range for image sequence. Following code</span>
                <span class=c1># maintain backward-compatibility by adjusting available range</span>
                <span class=c1># while we are updating those.</span>
                <span class=k>if</span> <span class=p>(</span>
                    <span class=n>is_clip_from_media_sequence</span><span class=p>(</span><span class=n>r_otio_cl</span><span class=p>)</span>
                    <span class=ow>and</span> <span class=n>available_range_start_frame</span> <span class=o>==</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>start_frame</span>
                    <span class=ow>and</span> <span class=n>start</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>start_frame</span>
                <span class=p>):</span>
                    <span class=n>available_range</span> <span class=o>=</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>TimeRange</span><span class=p>(</span>
                        <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>rate</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>),</span>
                        <span class=n>available_range</span><span class=o>.</span><span class=n>duration</span><span class=p>,</span>
                    <span class=p>)</span>

            <span class=c1># Gap: no media, generate range based on source range</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>available_range</span> <span class=o>=</span> <span class=n>processing_range</span> <span class=o>=</span> <span class=kc>None</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span> <span class=o>=</span> <span class=n>src_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>rate</span>
                <span class=n>start</span> <span class=o>=</span> <span class=n>src_range</span><span class=o>.</span><span class=n>start_time</span>
                <span class=n>duration</span> <span class=o>=</span> <span class=n>src_range</span><span class=o>.</span><span class=n>duration</span>

            <span class=c1># Create handle offsets.</span>
            <span class=n>clip_handle_start</span> <span class=o>=</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span>
                <span class=n>handle_start</span><span class=p>,</span>
                <span class=n>rate</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=n>clip_handle_end</span> <span class=o>=</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span>
                <span class=n>handle_end</span><span class=p>,</span>
                <span class=n>rate</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>,</span>
            <span class=p>)</span>

            <span class=c1># reframing handles conditions</span>
            <span class=k>if</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>index</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
                <span class=c1># more clips | first clip reframing with handle</span>
                <span class=n>start</span> <span class=o>-=</span> <span class=n>clip_handle_start</span>
                <span class=n>duration</span> <span class=o>+=</span> <span class=n>clip_handle_start</span>
            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> \
                        <span class=ow>and</span> <span class=p>(</span><span class=n>index</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
                <span class=c1># more clips | last clip reframing with handle</span>
                <span class=n>duration</span> <span class=o>+=</span> <span class=n>clip_handle_end</span>
            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>otio_review_clips</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=c1># one clip | add both handles</span>
                <span class=n>start</span> <span class=o>-=</span> <span class=n>clip_handle_start</span>
                <span class=n>duration</span> <span class=o>+=</span> <span class=p>(</span><span class=n>clip_handle_start</span> <span class=o>+</span> <span class=n>clip_handle_end</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>available_range</span><span class=p>:</span>
                <span class=n>processing_range</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_trim_available_range</span><span class=p>(</span>
                    <span class=n>available_range</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span>

            <span class=c1># process all track items of the track</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>r_otio_cl</span><span class=p>,</span> <span class=n>otio</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Clip</span><span class=p>):</span>
                <span class=c1># process Clip</span>
                <span class=n>media_ref</span> <span class=o>=</span> <span class=n>r_otio_cl</span><span class=o>.</span><span class=n>media_reference</span>
                <span class=n>metadata</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>metadata</span>
                <span class=n>is_sequence</span> <span class=o>=</span> <span class=n>is_clip_from_media_sequence</span><span class=p>(</span><span class=n>r_otio_cl</span><span class=p>)</span>

                <span class=c1># File sequence way</span>
                <span class=k>if</span> <span class=n>is_sequence</span><span class=p>:</span>
                    <span class=c1># Remap processing range to input file sequence.</span>
                    <span class=n>first</span><span class=p>,</span> <span class=n>last</span> <span class=o>=</span> <span class=n>remap_range_on_file_sequence</span><span class=p>(</span>
                        <span class=n>r_otio_cl</span><span class=p>,</span>
                        <span class=n>processing_range</span><span class=p>,</span>
                    <span class=p>)</span>
                    <span class=n>input_fps</span> <span class=o>=</span> <span class=n>processing_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>rate</span>

                    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>media_ref</span><span class=p>,</span> <span class=s2>&quot;target_url_base&quot;</span><span class=p>):</span>
                        <span class=n>dirname</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>target_url_base</span>
                        <span class=n>head</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>name_prefix</span>
                        <span class=n>tail</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>name_suffix</span>
                        <span class=n>collection</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>Collection</span><span class=p>(</span>
                            <span class=n>head</span><span class=o>=</span><span class=n>head</span><span class=p>,</span>
                            <span class=n>tail</span><span class=o>=</span><span class=n>tail</span><span class=p>,</span>
                            <span class=n>padding</span><span class=o>=</span><span class=n>media_ref</span><span class=o>.</span><span class=n>frame_zero_padding</span>
                        <span class=p>)</span>
                        <span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
                            <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>first</span><span class=p>,</span> <span class=p>(</span><span class=n>last</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))])</span>
                        <span class=c1># render segment</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span>
                            <span class=n>sequence</span><span class=o>=</span><span class=p>[</span><span class=n>dirname</span><span class=p>,</span> <span class=n>collection</span><span class=p>,</span> <span class=n>input_fps</span><span class=p>])</span>
                        <span class=c1># generate used frames</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span>
                            <span class=nb>len</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=c1># in case it is file sequence but not new OTIO schema</span>
                        <span class=c1># `ImageSequenceReference`</span>
                        <span class=n>path</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>target_url</span>
                        <span class=n>collection_data</span> <span class=o>=</span> <span class=n>make_sequence_collection</span><span class=p>(</span>
                            <span class=n>path</span><span class=p>,</span> <span class=n>processing_range</span><span class=p>,</span> <span class=n>metadata</span><span class=p>)</span>
                        <span class=n>dir_path</span><span class=p>,</span> <span class=n>collection</span> <span class=o>=</span> <span class=n>collection_data</span>

                        <span class=c1># render segment</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span>
                            <span class=n>sequence</span><span class=o>=</span><span class=p>[</span><span class=n>dir_path</span><span class=p>,</span> <span class=n>collection</span><span class=p>,</span> <span class=n>input_fps</span><span class=p>])</span>
                        <span class=c1># generate used frames</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span>
                            <span class=nb>len</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>

                <span class=c1># Single video way.</span>
                <span class=c1># Extraction via FFmpeg.</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>path</span> <span class=o>=</span> <span class=n>media_ref</span><span class=o>.</span><span class=n>target_url</span>
                    <span class=c1># Set extract range from 0 (FFmpeg ignores</span>
                    <span class=c1>#   embedded timecode).</span>
                    <span class=n>extract_range</span> <span class=o>=</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>TimeRange</span><span class=p>(</span>
                        <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span>
                            <span class=p>(</span>
                                <span class=n>processing_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>value</span>
                                <span class=o>-</span> <span class=n>available_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>value</span>
                            <span class=p>),</span>
                            <span class=n>rate</span><span class=o>=</span><span class=n>available_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>rate</span><span class=p>,</span>
                        <span class=p>),</span>
                        <span class=n>duration</span><span class=o>=</span><span class=n>processing_range</span><span class=o>.</span><span class=n>duration</span><span class=p>,</span>
                    <span class=p>)</span>
                    <span class=c1># render video file to sequence</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span>
                        <span class=n>video</span><span class=o>=</span><span class=p>[</span><span class=n>path</span><span class=p>,</span> <span class=n>extract_range</span><span class=p>])</span>
                    <span class=c1># generate used frames</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span>
                        <span class=n>processing_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>

            <span class=c1># QUESTION: what if nested track composition is in place?</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># at last process a Gap</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span><span class=n>gap</span><span class=o>=</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>())</span>
                <span class=c1># generate used frames</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>())</span>

        <span class=c1># creating and registering representation</span>
        <span class=n>representation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_representation</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span>

        <span class=c1># add colorspace data to representation</span>
        <span class=k>if</span> <span class=n>colorspace</span> <span class=o>:=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reviewColorspace&quot;</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>set_representation_colorspace</span><span class=p>(</span>
                <span class=n>representation</span><span class=p>,</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=p>,</span> <span class=n>colorspace</span>
            <span class=p>)</span>

        <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>representation</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Adding representation: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_create_representation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Creating representation data.</span>

<span class=sd>        Args:</span>
<span class=sd>            start (int): start frame</span>
<span class=sd>            duration (int): duration frames</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict: representation data</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>end</span> <span class=o>=</span> <span class=n>start</span> <span class=o>+</span> <span class=n>duration</span>

        <span class=c1># create default representation data</span>
        <span class=n>representation_data</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;frameStart&quot;</span><span class=p>:</span> <span class=n>start</span><span class=p>,</span>
            <span class=s2>&quot;frameEnd&quot;</span><span class=p>:</span> <span class=n>end</span><span class=p>,</span>
            <span class=s2>&quot;stagingDir&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span><span class=p>,</span>
            <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;review&quot;</span><span class=p>,</span> <span class=s2>&quot;delete&quot;</span><span class=p>]</span>
        <span class=p>}</span>

        <span class=n>collection</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>Collection</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>temp_file_head</span><span class=p>,</span>
            <span class=n>tail</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span><span class=p>,</span>
            <span class=n>padding</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>,</span>
            <span class=n>indexes</span><span class=o>=</span><span class=nb>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=n>start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>
        <span class=n>end</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>

        <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>collection</span><span class=p>]</span>
        <span class=c1># single frame sequence</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>files</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>files</span> <span class=o>=</span> <span class=n>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>ext</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=n>representation_data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
            <span class=s2>&quot;ext&quot;</span><span class=p>:</span> <span class=n>ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
            <span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>files</span><span class=p>,</span>
            <span class=s2>&quot;frameStart&quot;</span><span class=p>:</span> <span class=n>start</span><span class=p>,</span>
            <span class=s2>&quot;frameEnd&quot;</span><span class=p>:</span> <span class=n>end</span><span class=p>,</span>
        <span class=p>})</span>
        <span class=k>return</span> <span class=n>representation_data</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_trim_available_range</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>avl_range</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Trim available media range to source range.</span>

<span class=sd>        If missing media range is detected it will convert it into</span>
<span class=sd>        black frames gaps.</span>

<span class=sd>        Args:</span>
<span class=sd>            avl_range (otio.time.TimeRange): media available time range</span>
<span class=sd>            start (otio.time.RationalTime): start</span>
<span class=sd>            duration (otio.time.RationalTime): duration</span>

<span class=sd>        Returns:</span>
<span class=sd>            otio.time.TimeRange: trimmed available range</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Not all hosts can import these modules.</span>
        <span class=kn>import</span><span class=w> </span><span class=nn>opentimelineio</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>otio</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline.editorial</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
            <span class=n>trim_media_range</span><span class=p>,</span>
        <span class=p>)</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_round_to_frame</span><span class=p>(</span><span class=n>rational_time</span><span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot; Handle rounding duration to frame.</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=c1># OpentimelineIO &gt;= 0.16.0</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>rational_time</span><span class=o>.</span><span class=n>round</span><span class=p>()</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>

            <span class=c1># OpentimelineIO &lt; 0.16.0</span>
            <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span>
                    <span class=nb>round</span><span class=p>(</span><span class=n>rational_time</span><span class=o>.</span><span class=n>value</span><span class=p>),</span>
                    <span class=n>rate</span><span class=o>=</span><span class=n>rational_time</span><span class=o>.</span><span class=n>rate</span><span class=p>,</span>
                <span class=p>)</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>

        <span class=n>avl_start</span> <span class=o>=</span> <span class=n>avl_range</span><span class=o>.</span><span class=n>start_time</span>

        <span class=c1># An additional gap is required before the available</span>
        <span class=c1># range to conform source start point and head handles.</span>
        <span class=k>if</span> <span class=n>start</span> <span class=o>&lt;</span> <span class=n>avl_start</span><span class=p>:</span>
            <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>avl_start</span> <span class=o>-</span> <span class=n>start</span>
            <span class=n>start</span> <span class=o>=</span> <span class=n>avl_start</span>
            <span class=n>duration</span> <span class=o>-=</span> <span class=n>gap_duration</span>
            <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>_round_to_frame</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

            <span class=c1># create gap data to disk</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span><span class=n>gap</span><span class=o>=</span><span class=n>gap_duration</span><span class=p>)</span>
            <span class=c1># generate used frames</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

        <span class=c1># An additional gap is required after the available</span>
        <span class=c1># range to conform to source end point + tail handles</span>
        <span class=c1># (media duration is shorter then clip requirement).</span>
        <span class=n>end_point</span> <span class=o>=</span> <span class=n>start</span> <span class=o>+</span> <span class=n>duration</span>
        <span class=n>avl_end_point</span> <span class=o>=</span> <span class=n>avl_range</span><span class=o>.</span><span class=n>end_time_exclusive</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>end_point</span> <span class=o>&gt;</span> <span class=n>avl_end_point</span><span class=p>:</span>
            <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>end_point</span> <span class=o>-</span> <span class=n>avl_end_point</span>
            <span class=n>duration</span> <span class=o>-=</span> <span class=n>gap_duration</span>
            <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>_round_to_frame</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

            <span class=c1># create gap data to disk</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span>
                <span class=n>gap</span><span class=o>=</span><span class=n>gap_duration</span><span class=p>,</span>
                <span class=n>end_offset</span><span class=o>=</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>
            <span class=p>)</span>
            <span class=c1># generate used frames</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span>
                <span class=n>gap_duration</span><span class=p>,</span>
                <span class=n>end_offset</span><span class=o>=</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>
            <span class=p>)</span>

        <span class=c1># return correct trimmed range</span>
        <span class=k>return</span> <span class=n>trim_media_range</span><span class=p>(</span>
            <span class=n>avl_range</span><span class=p>,</span>
            <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>TimeRange</span><span class=p>(</span>
                <span class=n>start</span><span class=p>,</span>
                <span class=n>duration</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_render_segment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>sequence</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                        <span class=n>video</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Render segment into image sequence frames.</span>

<span class=sd>        Using ffmpeg to convert compatible video and image source</span>
<span class=sd>        to defined image sequence format.</span>

<span class=sd>        Args:</span>
<span class=sd>            sequence (list): input dir path string, collection object,</span>
<span class=sd>                fps in list.</span>
<span class=sd>            video (list)[optional]: video_path string, otio_range in list</span>
<span class=sd>            gap (int)[optional]: gap duration</span>
<span class=sd>            end_offset (int)[optional]: offset gap frame start in frames</span>

<span class=sd>        Returns:</span>
<span class=sd>            otio.time.TimeRange: trimmed available range</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Not all hosts can import this module.</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline.editorial</span><span class=w> </span><span class=kn>import</span> <span class=n>frames_to_seconds</span>

        <span class=c1># create path  and frame start to destination</span>
        <span class=n>output_path</span><span class=p>,</span> <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_ffmpeg_output</span><span class=p>()</span>

        <span class=k>if</span> <span class=n>end_offset</span><span class=p>:</span>
            <span class=n>out_frame_start</span> <span class=o>+=</span> <span class=n>end_offset</span>

        <span class=c1># start command list</span>
        <span class=n>command</span> <span class=o>=</span> <span class=n>get_ffmpeg_tool_args</span><span class=p>(</span><span class=s2>&quot;ffmpeg&quot;</span><span class=p>)</span>

        <span class=n>input_extension</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>sequence</span><span class=p>:</span>
            <span class=n>input_dir</span><span class=p>,</span> <span class=n>collection</span><span class=p>,</span> <span class=n>sequence_fps</span> <span class=o>=</span> <span class=n>sequence</span>
            <span class=n>in_frame_start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>

            <span class=c1># converting image sequence to image sequence</span>
            <span class=n>input_file</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=n>input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>input_dir</span><span class=p>,</span> <span class=n>input_file</span><span class=p>)</span>
            <span class=n>input_extension</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>input_path</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Form Command for Rendering Sequence Files</span>

<span class=sd>            To explicitly set the input frame range and preserve the frame</span>
<span class=sd>            range, avoid silent dropped frames caused by input mismatch</span>
<span class=sd>            with FFmpeg&#39;s default rate of 25.0 fps. For more info,</span>
<span class=sd>            refer to the FFmpeg image2 demuxer.</span>

<span class=sd>            Implicit:</span>
<span class=sd>                - Input: 100 frames (24fps from metadata)</span>
<span class=sd>                - Demuxer: video 25fps</span>
<span class=sd>                - Output: 98 frames, dropped 2</span>

<span class=sd>            Explicit with &quot;-framerate&quot;:</span>
<span class=sd>                - Input: 100 frames (24fps from metadata)</span>
<span class=sd>                - Demuxer: video 24fps</span>
<span class=sd>                - Output: 100 frames, no dropped frames</span>
<span class=sd>            &quot;&quot;&quot;</span>

            <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>in_frame_start</span><span class=p>),</span>
                <span class=s2>&quot;-framerate&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sequence_fps</span><span class=p>),</span>
                <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>input_path</span>
            <span class=p>])</span>

        <span class=k>elif</span> <span class=n>video</span><span class=p>:</span>
            <span class=n>video_path</span><span class=p>,</span> <span class=n>otio_range</span> <span class=o>=</span> <span class=n>video</span>
            <span class=n>frame_start</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>value</span>
            <span class=n>input_fps</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>rate</span>
            <span class=n>frame_duration</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>value</span>
            <span class=n>sec_start</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span><span class=n>frame_start</span><span class=p>,</span> <span class=n>input_fps</span><span class=p>)</span>
            <span class=n>sec_duration</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span>
                <span class=n>frame_duration</span><span class=p>,</span> <span class=n>input_fps</span>
            <span class=p>)</span>
            <span class=n>input_extension</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>video_path</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

            <span class=c1># form command for rendering gap files</span>
            <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-ss&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_start</span><span class=p>),</span>
                <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_duration</span><span class=p>),</span>
                <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>video_path</span>
            <span class=p>])</span>

        <span class=k>elif</span> <span class=n>gap</span><span class=p>:</span>
            <span class=n>sec_duration</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span><span class=n>gap</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>)</span>

            <span class=c1># form command for rendering gap files</span>
            <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_duration</span><span class=p>),</span>
                <span class=s2>&quot;-r&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>),</span>
                <span class=s2>&quot;-f&quot;</span><span class=p>,</span> <span class=s2>&quot;lavfi&quot;</span><span class=p>,</span>
                <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=s2>&quot;color=c=black:s=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span>
                <span class=p>),</span>
                <span class=s2>&quot;-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;stillimage&quot;</span>
            <span class=p>])</span>

        <span class=c1># add output attributes</span>
        <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>out_frame_start</span><span class=p>)</span>
        <span class=p>])</span>

        <span class=c1># add copying if extensions are matching</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>input_extension</span>
            <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span> <span class=o>==</span> <span class=n>input_extension</span>
        <span class=p>):</span>
            <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;copy&quot;</span>
            <span class=p>])</span>

        <span class=c1># add output path at the end</span>
        <span class=n>command</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output_path</span><span class=p>)</span>

        <span class=c1># execute</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Executing: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>command</span><span class=p>)))</span>
        <span class=n>output</span> <span class=o>=</span> <span class=n>run_subprocess</span><span class=p>(</span>
            <span class=n>command</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Output: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_generate_used_frames</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>duration</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Generating used frames into plugin argument `used_frames`.</span>

<span class=sd>        The argument `used_frames` is used for checking next available</span>
<span class=sd>        frame to start with during rendering sequence segments.</span>

<span class=sd>        Args:</span>
<span class=sd>            duration (int): duration of frames needed to be generated</span>
<span class=sd>            end_offset (int)[optional]: in case frames need to be offseted</span>

<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>padding</span> <span class=o>=</span> <span class=s2>&quot;{{:0</span><span class=si>{}</span><span class=s2>d}}&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>end_offset</span><span class=p>:</span>
            <span class=n>new_frames</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
            <span class=n>start_frame</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
            <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>end_offset</span><span class=p>,</span>
                               <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>end_offset</span> <span class=o>+</span> <span class=n>duration</span><span class=p>))):</span>
                <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>start_frame</span> <span class=o>+</span> <span class=n>index</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                    <span class=s2>&quot;index: `</span><span class=si>{}</span><span class=s2>` | seq_number: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>seq_number</span><span class=p>))</span>
                <span class=n>new_frames</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>seq_number</span><span class=p>))</span>
            <span class=n>new_frames</span> <span class=o>+=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span> <span class=o>=</span> <span class=n>new_frames</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>duration</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)):</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span><span class=p>:</span>
                    <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span> <span class=o>-=</span> <span class=mi>1</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>seq_number</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_ffmpeg_output</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Returning ffmpeg output command arguments.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: output_path is path for image sequence output</span>
<span class=sd>            int: out_frame_start is starting sequence frame</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>output_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}{}{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>temp_file_head</span><span class=p>,</span>
            <span class=s2>&quot;%0</span><span class=si>{}</span><span class=s2>d&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>),</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span>
        <span class=p>)</span>
        <span class=c1># create path to destination</span>
        <span class=n>output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>output_file</span><span class=p>)</span>

        <span class=c1># generate frame start</span>
        <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span><span class=p>:</span>
            <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>output_path</span><span class=p>,</span> <span class=n>out_frame_start</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_folder_name_based_prefix</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates &#39;unique&#39; human readable file prefix to differentiate.</span>

<span class=sd>        Multiple instances might share same temp folder, but each instance</span>
<span class=sd>        would be differentiated by asset, eg. folder name.</span>

<span class=sd>        It ix expected that there won&#39;t be multiple instances for same asset.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>folder_path</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;folderPath&quot;</span><span class=p>]</span>
        <span class=n>folder_name</span> <span class=o>=</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>folder_path</span> <span class=o>=</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>lstrip</span><span class=p>(</span><span class=s2>&quot;_&quot;</span><span class=p>)</span>

        <span class=n>file_prefix</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>folder_path</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>folder_name</span><span class=si>}</span><span class=s2>.&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;file_prefix::</span><span class=si>{</span><span class=n>file_prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>file_prefix</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._create_representation class="doc doc-heading"> <code class="highlight language-python"><span class=n>_create_representation</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Creating representation data.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>start</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>start frame</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>duration</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>duration frames</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dict</code></td> <td> </td> <td> <div class=doc-md-description> <p>representation data</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_create_representation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Creating representation data.</span>

<span class=sd>    Args:</span>
<span class=sd>        start (int): start frame</span>
<span class=sd>        duration (int): duration frames</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict: representation data</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>end</span> <span class=o>=</span> <span class=n>start</span> <span class=o>+</span> <span class=n>duration</span>

    <span class=c1># create default representation data</span>
    <span class=n>representation_data</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;frameStart&quot;</span><span class=p>:</span> <span class=n>start</span><span class=p>,</span>
        <span class=s2>&quot;frameEnd&quot;</span><span class=p>:</span> <span class=n>end</span><span class=p>,</span>
        <span class=s2>&quot;stagingDir&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span><span class=p>,</span>
        <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;review&quot;</span><span class=p>,</span> <span class=s2>&quot;delete&quot;</span><span class=p>]</span>
    <span class=p>}</span>

    <span class=n>collection</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>Collection</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>temp_file_head</span><span class=p>,</span>
        <span class=n>tail</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span><span class=p>,</span>
        <span class=n>padding</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>,</span>
        <span class=n>indexes</span><span class=o>=</span><span class=nb>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>
    <span class=n>end</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>

    <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>collection</span><span class=p>]</span>
    <span class=c1># single frame sequence</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>files</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>files</span> <span class=o>=</span> <span class=n>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>ext</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=n>representation_data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
        <span class=s2>&quot;ext&quot;</span><span class=p>:</span> <span class=n>ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span>
        <span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>files</span><span class=p>,</span>
        <span class=s2>&quot;frameStart&quot;</span><span class=p>:</span> <span class=n>start</span><span class=p>,</span>
        <span class=s2>&quot;frameEnd&quot;</span><span class=p>:</span> <span class=n>end</span><span class=p>,</span>
    <span class=p>})</span>
    <span class=k>return</span> <span class=n>representation_data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._generate_used_frames class="doc doc-heading"> <code class="highlight language-python"><span class=n>_generate_used_frames</span><span class=p>(</span><span class=n>duration</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Generating used frames into plugin argument <code>used_frames</code>.</p> <p>The argument <code>used_frames</code> is used for checking next available frame to start with during rendering sequence segments.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>duration</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>duration of frames needed to be generated</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>end_offset</code> </td> <td> <code>int)[optional]</code> </td> <td> <div class=doc-md-description> <p>in case frames need to be offseted</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_generate_used_frames</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>duration</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Generating used frames into plugin argument `used_frames`.</span>

<span class=sd>    The argument `used_frames` is used for checking next available</span>
<span class=sd>    frame to start with during rendering sequence segments.</span>

<span class=sd>    Args:</span>
<span class=sd>        duration (int): duration of frames needed to be generated</span>
<span class=sd>        end_offset (int)[optional]: in case frames need to be offseted</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>padding</span> <span class=o>=</span> <span class=s2>&quot;{{:0</span><span class=si>{}</span><span class=s2>d}}&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>end_offset</span><span class=p>:</span>
        <span class=n>new_frames</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
        <span class=n>start_frame</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>end_offset</span><span class=p>,</span>
                           <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>end_offset</span> <span class=o>+</span> <span class=n>duration</span><span class=p>))):</span>
            <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>start_frame</span> <span class=o>+</span> <span class=n>index</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;index: `</span><span class=si>{}</span><span class=s2>` | seq_number: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>seq_number</span><span class=p>))</span>
            <span class=n>new_frames</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>seq_number</span><span class=p>))</span>
        <span class=n>new_frames</span> <span class=o>+=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span> <span class=o>=</span> <span class=n>new_frames</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>duration</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)):</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span><span class=p>:</span>
                <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span> <span class=o>-=</span> <span class=mi>1</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>seq_number</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>seq_number</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_ffmpeg_output class="doc doc-heading"> <code class="highlight language-python"><span class=n>_get_ffmpeg_output</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Returning ffmpeg output command arguments.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>output_path is path for image sequence output</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>int</code></td> <td> </td> <td> <div class=doc-md-description> <p>out_frame_start is starting sequence frame</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_get_ffmpeg_output</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Returning ffmpeg output command arguments.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: output_path is path for image sequence output</span>
<span class=sd>        int: out_frame_start is starting sequence frame</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}{}{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>temp_file_head</span><span class=p>,</span>
        <span class=s2>&quot;%0</span><span class=si>{}</span><span class=s2>d&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>padding</span><span class=p>),</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span>
    <span class=p>)</span>
    <span class=c1># create path to destination</span>
    <span class=n>output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>output_file</span><span class=p>)</span>

    <span class=c1># generate frame start</span>
    <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>workfile_start</span><span class=p>:</span>
        <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>used_frames</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>output_path</span><span class=p>,</span> <span class=n>out_frame_start</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._get_folder_name_based_prefix class="doc doc-heading"> <code class="highlight language-python"><span class=n>_get_folder_name_based_prefix</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Creates 'unique' human readable file prefix to differentiate.</p> <p>Multiple instances might share same temp folder, but each instance would be differentiated by asset, eg. folder name.</p> <p>It ix expected that there won't be multiple instances for same asset.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_get_folder_name_based_prefix</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates &#39;unique&#39; human readable file prefix to differentiate.</span>

<span class=sd>    Multiple instances might share same temp folder, but each instance</span>
<span class=sd>    would be differentiated by asset, eg. folder name.</span>

<span class=sd>    It ix expected that there won&#39;t be multiple instances for same asset.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>folder_path</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;folderPath&quot;</span><span class=p>]</span>
    <span class=n>folder_name</span> <span class=o>=</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>folder_path</span> <span class=o>=</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>lstrip</span><span class=p>(</span><span class=s2>&quot;_&quot;</span><span class=p>)</span>

    <span class=n>file_prefix</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>folder_path</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>folder_name</span><span class=si>}</span><span class=s2>.&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;file_prefix::</span><span class=si>{</span><span class=n>file_prefix</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>file_prefix</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._render_segment class="doc doc-heading"> <code class="highlight language-python"><span class=n>_render_segment</span><span class=p>(</span><span class=n>sequence</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>video</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Render segment into image sequence frames.</p> <p>Using ffmpeg to convert compatible video and image source to defined image sequence format.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>sequence</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>input dir path string, collection object, fps in list.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>video</code> </td> <td> <code>list)[optional]</code> </td> <td> <div class=doc-md-description> <p>video_path string, otio_range in list</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>gap</code> </td> <td> <code>int)[optional]</code> </td> <td> <div class=doc-md-description> <p>gap duration</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>end_offset</code> </td> <td> <code>int)[optional]</code> </td> <td> <div class=doc-md-description> <p>offset gap frame start in frames</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>otio.time.TimeRange: trimmed available range</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_render_segment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>sequence</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                    <span class=n>video</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>end_offset</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Render segment into image sequence frames.</span>

<span class=sd>    Using ffmpeg to convert compatible video and image source</span>
<span class=sd>    to defined image sequence format.</span>

<span class=sd>    Args:</span>
<span class=sd>        sequence (list): input dir path string, collection object,</span>
<span class=sd>            fps in list.</span>
<span class=sd>        video (list)[optional]: video_path string, otio_range in list</span>
<span class=sd>        gap (int)[optional]: gap duration</span>
<span class=sd>        end_offset (int)[optional]: offset gap frame start in frames</span>

<span class=sd>    Returns:</span>
<span class=sd>        otio.time.TimeRange: trimmed available range</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Not all hosts can import this module.</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline.editorial</span><span class=w> </span><span class=kn>import</span> <span class=n>frames_to_seconds</span>

    <span class=c1># create path  and frame start to destination</span>
    <span class=n>output_path</span><span class=p>,</span> <span class=n>out_frame_start</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_ffmpeg_output</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>end_offset</span><span class=p>:</span>
        <span class=n>out_frame_start</span> <span class=o>+=</span> <span class=n>end_offset</span>

    <span class=c1># start command list</span>
    <span class=n>command</span> <span class=o>=</span> <span class=n>get_ffmpeg_tool_args</span><span class=p>(</span><span class=s2>&quot;ffmpeg&quot;</span><span class=p>)</span>

    <span class=n>input_extension</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>sequence</span><span class=p>:</span>
        <span class=n>input_dir</span><span class=p>,</span> <span class=n>collection</span><span class=p>,</span> <span class=n>sequence_fps</span> <span class=o>=</span> <span class=n>sequence</span>
        <span class=n>in_frame_start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>collection</span><span class=o>.</span><span class=n>indexes</span><span class=p>)</span>

        <span class=c1># converting image sequence to image sequence</span>
        <span class=n>input_file</span> <span class=o>=</span> <span class=n>collection</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=n>input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>input_dir</span><span class=p>,</span> <span class=n>input_file</span><span class=p>)</span>
        <span class=n>input_extension</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>input_path</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Form Command for Rendering Sequence Files</span>

<span class=sd>        To explicitly set the input frame range and preserve the frame</span>
<span class=sd>        range, avoid silent dropped frames caused by input mismatch</span>
<span class=sd>        with FFmpeg&#39;s default rate of 25.0 fps. For more info,</span>
<span class=sd>        refer to the FFmpeg image2 demuxer.</span>

<span class=sd>        Implicit:</span>
<span class=sd>            - Input: 100 frames (24fps from metadata)</span>
<span class=sd>            - Demuxer: video 25fps</span>
<span class=sd>            - Output: 98 frames, dropped 2</span>

<span class=sd>        Explicit with &quot;-framerate&quot;:</span>
<span class=sd>            - Input: 100 frames (24fps from metadata)</span>
<span class=sd>            - Demuxer: video 24fps</span>
<span class=sd>            - Output: 100 frames, no dropped frames</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>in_frame_start</span><span class=p>),</span>
            <span class=s2>&quot;-framerate&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sequence_fps</span><span class=p>),</span>
            <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>input_path</span>
        <span class=p>])</span>

    <span class=k>elif</span> <span class=n>video</span><span class=p>:</span>
        <span class=n>video_path</span><span class=p>,</span> <span class=n>otio_range</span> <span class=o>=</span> <span class=n>video</span>
        <span class=n>frame_start</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>value</span>
        <span class=n>input_fps</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>start_time</span><span class=o>.</span><span class=n>rate</span>
        <span class=n>frame_duration</span> <span class=o>=</span> <span class=n>otio_range</span><span class=o>.</span><span class=n>duration</span><span class=o>.</span><span class=n>value</span>
        <span class=n>sec_start</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span><span class=n>frame_start</span><span class=p>,</span> <span class=n>input_fps</span><span class=p>)</span>
        <span class=n>sec_duration</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span>
            <span class=n>frame_duration</span><span class=p>,</span> <span class=n>input_fps</span>
        <span class=p>)</span>
        <span class=n>input_extension</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>video_path</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

        <span class=c1># form command for rendering gap files</span>
        <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-ss&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_start</span><span class=p>),</span>
            <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_duration</span><span class=p>),</span>
            <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>video_path</span>
        <span class=p>])</span>

    <span class=k>elif</span> <span class=n>gap</span><span class=p>:</span>
        <span class=n>sec_duration</span> <span class=o>=</span> <span class=n>frames_to_seconds</span><span class=p>(</span><span class=n>gap</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>)</span>

        <span class=c1># form command for rendering gap files</span>
        <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sec_duration</span><span class=p>),</span>
            <span class=s2>&quot;-r&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>actual_fps</span><span class=p>),</span>
            <span class=s2>&quot;-f&quot;</span><span class=p>,</span> <span class=s2>&quot;lavfi&quot;</span><span class=p>,</span>
            <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=s2>&quot;color=c=black:s=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>to_width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_height</span>
            <span class=p>),</span>
            <span class=s2>&quot;-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;stillimage&quot;</span>
        <span class=p>])</span>

    <span class=c1># add output attributes</span>
    <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
        <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>out_frame_start</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=c1># add copying if extensions are matching</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>input_extension</span>
        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_ext</span> <span class=o>==</span> <span class=n>input_extension</span>
    <span class=p>):</span>
        <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;copy&quot;</span>
        <span class=p>])</span>

    <span class=c1># add output path at the end</span>
    <span class=n>command</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output_path</span><span class=p>)</span>

    <span class=c1># execute</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Executing: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>command</span><span class=p>)))</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>run_subprocess</span><span class=p>(</span>
        <span class=n>command</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Output: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_otio_review.ExtractOTIOReview._trim_available_range class="doc doc-heading"> <code class="highlight language-python"><span class=n>_trim_available_range</span><span class=p>(</span><span class=n>avl_range</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Trim available media range to source range.</p> <p>If missing media range is detected it will convert it into black frames gaps.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>avl_range</code> </td> <td> <code><span title=otio.time.TimeRange>TimeRange</span></code> </td> <td> <div class=doc-md-description> <p>media available time range</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>start</code> </td> <td> <code><span title=otio.time.RationalTime>RationalTime</span></code> </td> <td> <div class=doc-md-description> <p>start</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>duration</code> </td> <td> <code><span title=otio.time.RationalTime>RationalTime</span></code> </td> <td> <div class=doc-md-description> <p>duration</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>otio.time.TimeRange: trimmed available range</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_otio_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_trim_available_range</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>avl_range</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>duration</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Trim available media range to source range.</span>

<span class=sd>    If missing media range is detected it will convert it into</span>
<span class=sd>    black frames gaps.</span>

<span class=sd>    Args:</span>
<span class=sd>        avl_range (otio.time.TimeRange): media available time range</span>
<span class=sd>        start (otio.time.RationalTime): start</span>
<span class=sd>        duration (otio.time.RationalTime): duration</span>

<span class=sd>    Returns:</span>
<span class=sd>        otio.time.TimeRange: trimmed available range</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Not all hosts can import these modules.</span>
    <span class=kn>import</span><span class=w> </span><span class=nn>opentimelineio</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>otio</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline.editorial</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
        <span class=n>trim_media_range</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_round_to_frame</span><span class=p>(</span><span class=n>rational_time</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Handle rounding duration to frame.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># OpentimelineIO &gt;= 0.16.0</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>rational_time</span><span class=o>.</span><span class=n>round</span><span class=p>()</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>

        <span class=c1># OpentimelineIO &lt; 0.16.0</span>
        <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>RationalTime</span><span class=p>(</span>
                <span class=nb>round</span><span class=p>(</span><span class=n>rational_time</span><span class=o>.</span><span class=n>value</span><span class=p>),</span>
                <span class=n>rate</span><span class=o>=</span><span class=n>rational_time</span><span class=o>.</span><span class=n>rate</span><span class=p>,</span>
            <span class=p>)</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>

    <span class=n>avl_start</span> <span class=o>=</span> <span class=n>avl_range</span><span class=o>.</span><span class=n>start_time</span>

    <span class=c1># An additional gap is required before the available</span>
    <span class=c1># range to conform source start point and head handles.</span>
    <span class=k>if</span> <span class=n>start</span> <span class=o>&lt;</span> <span class=n>avl_start</span><span class=p>:</span>
        <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>avl_start</span> <span class=o>-</span> <span class=n>start</span>
        <span class=n>start</span> <span class=o>=</span> <span class=n>avl_start</span>
        <span class=n>duration</span> <span class=o>-=</span> <span class=n>gap_duration</span>
        <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>_round_to_frame</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

        <span class=c1># create gap data to disk</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span><span class=n>gap</span><span class=o>=</span><span class=n>gap_duration</span><span class=p>)</span>
        <span class=c1># generate used frames</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

    <span class=c1># An additional gap is required after the available</span>
    <span class=c1># range to conform to source end point + tail handles</span>
    <span class=c1># (media duration is shorter then clip requirement).</span>
    <span class=n>end_point</span> <span class=o>=</span> <span class=n>start</span> <span class=o>+</span> <span class=n>duration</span>
    <span class=n>avl_end_point</span> <span class=o>=</span> <span class=n>avl_range</span><span class=o>.</span><span class=n>end_time_exclusive</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>end_point</span> <span class=o>&gt;</span> <span class=n>avl_end_point</span><span class=p>:</span>
        <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>end_point</span> <span class=o>-</span> <span class=n>avl_end_point</span>
        <span class=n>duration</span> <span class=o>-=</span> <span class=n>gap_duration</span>
        <span class=n>gap_duration</span> <span class=o>=</span> <span class=n>_round_to_frame</span><span class=p>(</span><span class=n>gap_duration</span><span class=p>)</span>

        <span class=c1># create gap data to disk</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_render_segment</span><span class=p>(</span>
            <span class=n>gap</span><span class=o>=</span><span class=n>gap_duration</span><span class=p>,</span>
            <span class=n>end_offset</span><span class=o>=</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>
        <span class=p>)</span>
        <span class=c1># generate used frames</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_generate_used_frames</span><span class=p>(</span>
            <span class=n>gap_duration</span><span class=p>,</span>
            <span class=n>end_offset</span><span class=o>=</span><span class=n>duration</span><span class=o>.</span><span class=n>to_frames</span><span class=p>()</span>
        <span class=p>)</span>

    <span class=c1># return correct trimmed range</span>
    <span class=k>return</span> <span class=n>trim_media_range</span><span class=p>(</span>
        <span class=n>avl_range</span><span class=p>,</span>
        <span class=n>otio</span><span class=o>.</span><span class=n>opentime</span><span class=o>.</span><span class=n>TimeRange</span><span class=p>(</span>
            <span class=n>start</span><span class=p>,</span>
            <span class=n>duration</span>
        <span class=p>)</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>