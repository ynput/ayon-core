<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=extract_otio_trimming_video.html><link rel=next href=extract_review_slate.html><link rel=icon href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.8"><title>extract_review - ayon-core</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../css/custom.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_core.plugins.publish.extract_review class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../index.html title=ayon-core class="md-header__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-core </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> extract_review </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../index.html title=ayon-core class="md-nav__button md-logo" aria-label=ayon-core data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../../index.html class="md-nav__link "> <span class=md-ellipsis> client </span> </a> <label class="md-nav__link " for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> ayon_core </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../__main__.html class=md-nav__link> <span class=md-ellipsis> __main__ </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../addon/base.html class=md-nav__link> <span class=md-ellipsis> addon </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../cli.html class=md-nav__link> <span class=md-ellipsis> cli </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../hooks/pre_add_last_workfile_arg.html class=md-nav__link> <span class=md-ellipsis> hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../host/dirmap.html class=md-nav__link> <span class=md-ellipsis> host </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../lib/attribute_definitions.html class=md-nav__link> <span class=md-ellipsis> lib </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../pipeline/actions.html class=md-nav__link> <span class=md-ellipsis> pipeline </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_8 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> plugins </span> </a> <label class="md-nav__link " for=__nav_3_1_1_8 id=__nav_3_1_1_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_8_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_8> <span class="md-nav__icon md-icon"></span> plugins </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../actions/open_file_explorer.html class=md-nav__link> <span class=md-ellipsis> actions </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../inventory/remove_and_load.html class=md-nav__link> <span class=md-ellipsis> inventory </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../load/copy_file.html class=md-nav__link> <span class=md-ellipsis> load </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_8_4 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> publish </span> </a> <label class="md-nav__link " for=__nav_3_1_1_8_4 id=__nav_3_1_1_8_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_1_1_8_4_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_8_4> <span class="md-nav__icon md-icon"></span> publish </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=cleanup.html class=md-nav__link> <span class=md-ellipsis> cleanup </span> </a> </li> <li class=md-nav__item> <a href=cleanup_explicit.html class=md-nav__link> <span class=md-ellipsis> cleanup_explicit </span> </a> </li> <li class=md-nav__item> <a href=cleanup_farm.html class=md-nav__link> <span class=md-ellipsis> cleanup_farm </span> </a> </li> <li class=md-nav__item> <a href=collect_addons.html class=md-nav__link> <span class=md-ellipsis> collect_addons </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_context_data.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_context_data </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_instance_data.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_instance_data </span> </a> </li> <li class=md-nav__item> <a href=collect_anatomy_object.html class=md-nav__link> <span class=md-ellipsis> collect_anatomy_object </span> </a> </li> <li class=md-nav__item> <a href=collect_audio.html class=md-nav__link> <span class=md-ellipsis> collect_audio </span> </a> </li> <li class=md-nav__item> <a href=collect_cleanup_keys.html class=md-nav__link> <span class=md-ellipsis> collect_cleanup_keys </span> </a> </li> <li class=md-nav__item> <a href=collect_comment.html class=md-nav__link> <span class=md-ellipsis> collect_comment </span> </a> </li> <li class=md-nav__item> <a href=collect_context_entities.html class=md-nav__link> <span class=md-ellipsis> collect_context_entities </span> </a> </li> <li class=md-nav__item> <a href=collect_context_label.html class=md-nav__link> <span class=md-ellipsis> collect_context_label </span> </a> </li> <li class=md-nav__item> <a href=collect_current_ayon_user.html class=md-nav__link> <span class=md-ellipsis> collect_current_ayon_user </span> </a> </li> <li class=md-nav__item> <a href=collect_current_context.html class=md-nav__link> <span class=md-ellipsis> collect_current_context </span> </a> </li> <li class=md-nav__item> <a href=collect_current_shell_file.html class=md-nav__link> <span class=md-ellipsis> collect_current_shell_file </span> </a> </li> <li class=md-nav__item> <a href=collect_datetime_data.html class=md-nav__link> <span class=md-ellipsis> collect_datetime_data </span> </a> </li> <li class=md-nav__item> <a href=collect_farm_env_variables.html class=md-nav__link> <span class=md-ellipsis> collect_farm_env_variables </span> </a> </li> <li class=md-nav__item> <a href=collect_farm_target.html class=md-nav__link> <span class=md-ellipsis> collect_farm_target </span> </a> </li> <li class=md-nav__item> <a href=collect_frames_fix.html class=md-nav__link> <span class=md-ellipsis> collect_frames_fix </span> </a> </li> <li class=md-nav__item> <a href=collect_from_create_context.html class=md-nav__link> <span class=md-ellipsis> collect_from_create_context </span> </a> </li> <li class=md-nav__item> <a href=collect_hierarchy.html class=md-nav__link> <span class=md-ellipsis> collect_hierarchy </span> </a> </li> <li class=md-nav__item> <a href=collect_host_name.html class=md-nav__link> <span class=md-ellipsis> collect_host_name </span> </a> </li> <li class=md-nav__item> <a href=collect_input_representations_to_versions.html class=md-nav__link> <span class=md-ellipsis> collect_input_representations_to_versions </span> </a> </li> <li class=md-nav__item> <a href=collect_machine_name.html class=md-nav__link> <span class=md-ellipsis> collect_machine_name </span> </a> </li> <li class=md-nav__item> <a href=collect_managed_staging_dir.html class=md-nav__link> <span class=md-ellipsis> collect_managed_staging_dir </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_frame_ranges.html class=md-nav__link> <span class=md-ellipsis> collect_otio_frame_ranges </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_review.html class=md-nav__link> <span class=md-ellipsis> collect_otio_review </span> </a> </li> <li class=md-nav__item> <a href=collect_otio_subset_resources.html class=md-nav__link> <span class=md-ellipsis> collect_otio_subset_resources </span> </a> </li> <li class=md-nav__item> <a href=collect_rendered_files.html class=md-nav__link> <span class=md-ellipsis> collect_rendered_files </span> </a> </li> <li class=md-nav__item> <a href=collect_resources_path.html class=md-nav__link> <span class=md-ellipsis> collect_resources_path </span> </a> </li> <li class=md-nav__item> <a href=collect_scene_loaded_versions.html class=md-nav__link> <span class=md-ellipsis> collect_scene_loaded_versions </span> </a> </li> <li class=md-nav__item> <a href=collect_scene_version.html class=md-nav__link> <span class=md-ellipsis> collect_scene_version </span> </a> </li> <li class=md-nav__item> <a href=collect_settings.html class=md-nav__link> <span class=md-ellipsis> collect_settings </span> </a> </li> <li class=md-nav__item> <a href=collect_shell_workspace.html class=md-nav__link> <span class=md-ellipsis> collect_shell_workspace </span> </a> </li> <li class=md-nav__item> <a href=collect_source_for_source.html class=md-nav__link> <span class=md-ellipsis> collect_source_for_source </span> </a> </li> <li class=md-nav__item> <a href=collect_time.html class=md-nav__link> <span class=md-ellipsis> collect_time </span> </a> </li> <li class=md-nav__item> <a href=extract_burnin.html class=md-nav__link> <span class=md-ellipsis> extract_burnin </span> </a> </li> <li class=md-nav__item> <a href=extract_color_transcode.html class=md-nav__link> <span class=md-ellipsis> extract_color_transcode </span> </a> </li> <li class=md-nav__item> <a href=extract_colorspace_data.html class=md-nav__link> <span class=md-ellipsis> extract_colorspace_data </span> </a> </li> <li class=md-nav__item> <a href=extract_hierarchy_to_ayon.html class=md-nav__link> <span class=md-ellipsis> extract_hierarchy_to_ayon </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_audio_tracks.html class=md-nav__link> <span class=md-ellipsis> extract_otio_audio_tracks </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_file.html class=md-nav__link> <span class=md-ellipsis> extract_otio_file </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_review.html class=md-nav__link> <span class=md-ellipsis> extract_otio_review </span> </a> </li> <li class=md-nav__item> <a href=extract_otio_trimming_video.html class=md-nav__link> <span class=md-ellipsis> extract_otio_trimming_video </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> extract_review </span> <span class="md-nav__icon md-icon"></span> </label> <a href=extract_review.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> extract_review </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review class=md-nav__link> <span class=md-ellipsis> extract_review </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview class=md-nav__link> <span class=md-ellipsis> ExtractReview </span> </a> <nav class=md-nav aria-label=ExtractReview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview._ffmpeg_arguments class=md-nav__link> <span class=md-ellipsis> _ffmpeg_arguments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.add_video_filter_args class=md-nav__link> <span class=md-ellipsis> add_video_filter_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.audio_args class=md-nav__link> <span class=md-ellipsis> audio_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.families_filter_validation class=md-nav__link> <span class=md-ellipsis> families_filter_validation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.families_from_instance class=md-nav__link> <span class=md-ellipsis> families_from_instance </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.ffmpeg_full_args class=md-nav__link> <span class=md-ellipsis> ffmpeg_full_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.fill_sequence_gaps class=md-nav__link> <span class=md-ellipsis> fill_sequence_gaps </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_output_defs class=md-nav__link> <span class=md-ellipsis> filter_output_defs </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_outputs_by_custom_tags class=md-nav__link> <span class=md-ellipsis> filter_outputs_by_custom_tags </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.input_is_sequence class=md-nav__link> <span class=md-ellipsis> input_is_sequence </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.input_output_paths class=md-nav__link> <span class=md-ellipsis> input_output_paths </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.lut_filters class=md-nav__link> <span class=md-ellipsis> lut_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.prepare_temp_data class=md-nav__link> <span class=md-ellipsis> prepare_temp_data </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.rescaling_filters class=md-nav__link> <span class=md-ellipsis> rescaling_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.split_ffmpeg_args class=md-nav__link> <span class=md-ellipsis> split_ffmpeg_args </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop class=md-nav__link> <span class=md-ellipsis> OverscanCrop </span> </a> <nav class=md-nav aria-label=OverscanCrop> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop--example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.height class=md-nav__link> <span class=md-ellipsis> height </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.video_filters class=md-nav__link> <span class=md-ellipsis> video_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.width class=md-nav__link> <span class=md-ellipsis> width </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue class=md-nav__link> <span class=md-ellipsis> _OverscanValue </span> </a> <nav class=md-nav aria-label=_OverscanValue> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue.copy class=md-nav__link> <span class=md-ellipsis> copy </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue.size_for class=md-nav__link> <span class=md-ellipsis> size_for </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.frame_to_timecode class=md-nav__link> <span class=md-ellipsis> frame_to_timecode </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=extract_review_slate.html class=md-nav__link> <span class=md-ellipsis> extract_review_slate </span> </a> </li> <li class=md-nav__item> <a href=extract_scanline_exr.html class=md-nav__link> <span class=md-ellipsis> extract_scanline_exr </span> </a> </li> <li class=md-nav__item> <a href=extract_slate_data.html class=md-nav__link> <span class=md-ellipsis> extract_slate_data </span> </a> </li> <li class=md-nav__item> <a href=extract_thumbnail.html class=md-nav__link> <span class=md-ellipsis> extract_thumbnail </span> </a> </li> <li class=md-nav__item> <a href=extract_thumbnail_from_source.html class=md-nav__link> <span class=md-ellipsis> extract_thumbnail_from_source </span> </a> </li> <li class=md-nav__item> <a href=extract_usd_layer_contributions.html class=md-nav__link> <span class=md-ellipsis> extract_usd_layer_contributions </span> </a> </li> <li class=md-nav__item> <a href=help/index.html class=md-nav__link> <span class=md-ellipsis> help </span> </a> </li> <li class=md-nav__item> <a href=integrate.html class=md-nav__link> <span class=md-ellipsis> integrate </span> </a> </li> <li class=md-nav__item> <a href=integrate_hero_version.html class=md-nav__link> <span class=md-ellipsis> integrate_hero_version </span> </a> </li> <li class=md-nav__item> <a href=integrate_inputlinks.html class=md-nav__link> <span class=md-ellipsis> integrate_inputlinks </span> </a> </li> <li class=md-nav__item> <a href=integrate_product_group.html class=md-nav__link> <span class=md-ellipsis> integrate_product_group </span> </a> </li> <li class=md-nav__item> <a href=integrate_resources_path.html class=md-nav__link> <span class=md-ellipsis> integrate_resources_path </span> </a> </li> <li class=md-nav__item> <a href=integrate_review.html class=md-nav__link> <span class=md-ellipsis> integrate_review </span> </a> </li> <li class=md-nav__item> <a href=integrate_thumbnail.html class=md-nav__link> <span class=md-ellipsis> integrate_thumbnail </span> </a> </li> <li class=md-nav__item> <a href=integrate_version_attrs.html class=md-nav__link> <span class=md-ellipsis> integrate_version_attrs </span> </a> </li> <li class=md-nav__item> <a href=preintegrate_thumbnail_representation.html class=md-nav__link> <span class=md-ellipsis> preintegrate_thumbnail_representation </span> </a> </li> <li class=md-nav__item> <a href=repair_unicode_strings.html class=md-nav__link> <span class=md-ellipsis> repair_unicode_strings </span> </a> </li> <li class=md-nav__item> <a href=validate_asset_docs.html class=md-nav__link> <span class=md-ellipsis> validate_asset_docs </span> </a> </li> <li class=md-nav__item> <a href=validate_containers.html class=md-nav__link> <span class=md-ellipsis> validate_containers </span> </a> </li> <li class=md-nav__item> <a href=validate_file_saved.html class=md-nav__link> <span class=md-ellipsis> validate_file_saved </span> </a> </li> <li class=md-nav__item> <a href=validate_filesequences.html class=md-nav__link> <span class=md-ellipsis> validate_filesequences </span> </a> </li> <li class=md-nav__item> <a href=validate_intent.html class=md-nav__link> <span class=md-ellipsis> validate_intent </span> </a> </li> <li class=md-nav__item> <a href=validate_publish_dir.html class=md-nav__link> <span class=md-ellipsis> validate_publish_dir </span> </a> </li> <li class=md-nav__item> <a href=validate_resources.html class=md-nav__link> <span class=md-ellipsis> validate_resources </span> </a> </li> <li class=md-nav__item> <a href=validate_unique_subsets.html class=md-nav__link> <span class=md-ellipsis> validate_unique_subsets </span> </a> </li> <li class=md-nav__item> <a href=validate_version.html class=md-nav__link> <span class=md-ellipsis> validate_version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../resources/app_icons/index.html class=md-nav__link> <span class=md-ellipsis> resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../scripts/ocio_wrapper.html class=md-nav__link> <span class=md-ellipsis> scripts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../settings/lib.html class=md-nav__link> <span class=md-ellipsis> settings </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../style/color_defs.html class=md-nav__link> <span class=md-ellipsis> style </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tests/conftest.html class=md-nav__link> <span class=md-ellipsis> tests </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tools/attribute_defs/_constants.html class=md-nav__link> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../vendor/python/qargparse.html class=md-nav__link> <span class=md-ellipsis> vendor </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../server/settings/conversion.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review class=md-nav__link> <span class=md-ellipsis> extract_review </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview class=md-nav__link> <span class=md-ellipsis> ExtractReview </span> </a> <nav class=md-nav aria-label=ExtractReview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview._ffmpeg_arguments class=md-nav__link> <span class=md-ellipsis> _ffmpeg_arguments </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.add_video_filter_args class=md-nav__link> <span class=md-ellipsis> add_video_filter_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.audio_args class=md-nav__link> <span class=md-ellipsis> audio_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.families_filter_validation class=md-nav__link> <span class=md-ellipsis> families_filter_validation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.families_from_instance class=md-nav__link> <span class=md-ellipsis> families_from_instance </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.ffmpeg_full_args class=md-nav__link> <span class=md-ellipsis> ffmpeg_full_args </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.fill_sequence_gaps class=md-nav__link> <span class=md-ellipsis> fill_sequence_gaps </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_output_defs class=md-nav__link> <span class=md-ellipsis> filter_output_defs </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_outputs_by_custom_tags class=md-nav__link> <span class=md-ellipsis> filter_outputs_by_custom_tags </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.input_is_sequence class=md-nav__link> <span class=md-ellipsis> input_is_sequence </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.input_output_paths class=md-nav__link> <span class=md-ellipsis> input_output_paths </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.lut_filters class=md-nav__link> <span class=md-ellipsis> lut_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.prepare_temp_data class=md-nav__link> <span class=md-ellipsis> prepare_temp_data </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.rescaling_filters class=md-nav__link> <span class=md-ellipsis> rescaling_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.ExtractReview.split_ffmpeg_args class=md-nav__link> <span class=md-ellipsis> split_ffmpeg_args </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop class=md-nav__link> <span class=md-ellipsis> OverscanCrop </span> </a> <nav class=md-nav aria-label=OverscanCrop> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop--example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.height class=md-nav__link> <span class=md-ellipsis> height </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.video_filters class=md-nav__link> <span class=md-ellipsis> video_filters </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.OverscanCrop.width class=md-nav__link> <span class=md-ellipsis> width </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue class=md-nav__link> <span class=md-ellipsis> _OverscanValue </span> </a> <nav class=md-nav aria-label=_OverscanValue> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue.copy class=md-nav__link> <span class=md-ellipsis> copy </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review._OverscanValue.size_for class=md-nav__link> <span class=md-ellipsis> size_for </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_core.plugins.publish.extract_review.frame_to_timecode class=md-nav__link> <span class=md-ellipsis> frame_to_timecode </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>extract_review</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_core.plugins.publish.extract_review></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_core.plugins.publish.extract_review.ExtractReview class="doc doc-heading"> <code>ExtractReview</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pyblish.api.InstancePlugin>InstancePlugin</span></code></p> <p>Extracting Review mov file for Ftrack</p> <p>Compulsory attribute of representation is tags list with "review", otherwise the representation is ignored.</p> <p>All new representations are created and encoded by ffmpeg following presets found in AYON Settings interface at <code>project_settings/global/publish/ExtractReview/profiles:outputs</code>.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  63</span>
<span class=normal>  64</span>
<span class=normal>  65</span>
<span class=normal>  66</span>
<span class=normal>  67</span>
<span class=normal>  68</span>
<span class=normal>  69</span>
<span class=normal>  70</span>
<span class=normal>  71</span>
<span class=normal>  72</span>
<span class=normal>  73</span>
<span class=normal>  74</span>
<span class=normal>  75</span>
<span class=normal>  76</span>
<span class=normal>  77</span>
<span class=normal>  78</span>
<span class=normal>  79</span>
<span class=normal>  80</span>
<span class=normal>  81</span>
<span class=normal>  82</span>
<span class=normal>  83</span>
<span class=normal>  84</span>
<span class=normal>  85</span>
<span class=normal>  86</span>
<span class=normal>  87</span>
<span class=normal>  88</span>
<span class=normal>  89</span>
<span class=normal>  90</span>
<span class=normal>  91</span>
<span class=normal>  92</span>
<span class=normal>  93</span>
<span class=normal>  94</span>
<span class=normal>  95</span>
<span class=normal>  96</span>
<span class=normal>  97</span>
<span class=normal>  98</span>
<span class=normal>  99</span>
<span class=normal> 100</span>
<span class=normal> 101</span>
<span class=normal> 102</span>
<span class=normal> 103</span>
<span class=normal> 104</span>
<span class=normal> 105</span>
<span class=normal> 106</span>
<span class=normal> 107</span>
<span class=normal> 108</span>
<span class=normal> 109</span>
<span class=normal> 110</span>
<span class=normal> 111</span>
<span class=normal> 112</span>
<span class=normal> 113</span>
<span class=normal> 114</span>
<span class=normal> 115</span>
<span class=normal> 116</span>
<span class=normal> 117</span>
<span class=normal> 118</span>
<span class=normal> 119</span>
<span class=normal> 120</span>
<span class=normal> 121</span>
<span class=normal> 122</span>
<span class=normal> 123</span>
<span class=normal> 124</span>
<span class=normal> 125</span>
<span class=normal> 126</span>
<span class=normal> 127</span>
<span class=normal> 128</span>
<span class=normal> 129</span>
<span class=normal> 130</span>
<span class=normal> 131</span>
<span class=normal> 132</span>
<span class=normal> 133</span>
<span class=normal> 134</span>
<span class=normal> 135</span>
<span class=normal> 136</span>
<span class=normal> 137</span>
<span class=normal> 138</span>
<span class=normal> 139</span>
<span class=normal> 140</span>
<span class=normal> 141</span>
<span class=normal> 142</span>
<span class=normal> 143</span>
<span class=normal> 144</span>
<span class=normal> 145</span>
<span class=normal> 146</span>
<span class=normal> 147</span>
<span class=normal> 148</span>
<span class=normal> 149</span>
<span class=normal> 150</span>
<span class=normal> 151</span>
<span class=normal> 152</span>
<span class=normal> 153</span>
<span class=normal> 154</span>
<span class=normal> 155</span>
<span class=normal> 156</span>
<span class=normal> 157</span>
<span class=normal> 158</span>
<span class=normal> 159</span>
<span class=normal> 160</span>
<span class=normal> 161</span>
<span class=normal> 162</span>
<span class=normal> 163</span>
<span class=normal> 164</span>
<span class=normal> 165</span>
<span class=normal> 166</span>
<span class=normal> 167</span>
<span class=normal> 168</span>
<span class=normal> 169</span>
<span class=normal> 170</span>
<span class=normal> 171</span>
<span class=normal> 172</span>
<span class=normal> 173</span>
<span class=normal> 174</span>
<span class=normal> 175</span>
<span class=normal> 176</span>
<span class=normal> 177</span>
<span class=normal> 178</span>
<span class=normal> 179</span>
<span class=normal> 180</span>
<span class=normal> 181</span>
<span class=normal> 182</span>
<span class=normal> 183</span>
<span class=normal> 184</span>
<span class=normal> 185</span>
<span class=normal> 186</span>
<span class=normal> 187</span>
<span class=normal> 188</span>
<span class=normal> 189</span>
<span class=normal> 190</span>
<span class=normal> 191</span>
<span class=normal> 192</span>
<span class=normal> 193</span>
<span class=normal> 194</span>
<span class=normal> 195</span>
<span class=normal> 196</span>
<span class=normal> 197</span>
<span class=normal> 198</span>
<span class=normal> 199</span>
<span class=normal> 200</span>
<span class=normal> 201</span>
<span class=normal> 202</span>
<span class=normal> 203</span>
<span class=normal> 204</span>
<span class=normal> 205</span>
<span class=normal> 206</span>
<span class=normal> 207</span>
<span class=normal> 208</span>
<span class=normal> 209</span>
<span class=normal> 210</span>
<span class=normal> 211</span>
<span class=normal> 212</span>
<span class=normal> 213</span>
<span class=normal> 214</span>
<span class=normal> 215</span>
<span class=normal> 216</span>
<span class=normal> 217</span>
<span class=normal> 218</span>
<span class=normal> 219</span>
<span class=normal> 220</span>
<span class=normal> 221</span>
<span class=normal> 222</span>
<span class=normal> 223</span>
<span class=normal> 224</span>
<span class=normal> 225</span>
<span class=normal> 226</span>
<span class=normal> 227</span>
<span class=normal> 228</span>
<span class=normal> 229</span>
<span class=normal> 230</span>
<span class=normal> 231</span>
<span class=normal> 232</span>
<span class=normal> 233</span>
<span class=normal> 234</span>
<span class=normal> 235</span>
<span class=normal> 236</span>
<span class=normal> 237</span>
<span class=normal> 238</span>
<span class=normal> 239</span>
<span class=normal> 240</span>
<span class=normal> 241</span>
<span class=normal> 242</span>
<span class=normal> 243</span>
<span class=normal> 244</span>
<span class=normal> 245</span>
<span class=normal> 246</span>
<span class=normal> 247</span>
<span class=normal> 248</span>
<span class=normal> 249</span>
<span class=normal> 250</span>
<span class=normal> 251</span>
<span class=normal> 252</span>
<span class=normal> 253</span>
<span class=normal> 254</span>
<span class=normal> 255</span>
<span class=normal> 256</span>
<span class=normal> 257</span>
<span class=normal> 258</span>
<span class=normal> 259</span>
<span class=normal> 260</span>
<span class=normal> 261</span>
<span class=normal> 262</span>
<span class=normal> 263</span>
<span class=normal> 264</span>
<span class=normal> 265</span>
<span class=normal> 266</span>
<span class=normal> 267</span>
<span class=normal> 268</span>
<span class=normal> 269</span>
<span class=normal> 270</span>
<span class=normal> 271</span>
<span class=normal> 272</span>
<span class=normal> 273</span>
<span class=normal> 274</span>
<span class=normal> 275</span>
<span class=normal> 276</span>
<span class=normal> 277</span>
<span class=normal> 278</span>
<span class=normal> 279</span>
<span class=normal> 280</span>
<span class=normal> 281</span>
<span class=normal> 282</span>
<span class=normal> 283</span>
<span class=normal> 284</span>
<span class=normal> 285</span>
<span class=normal> 286</span>
<span class=normal> 287</span>
<span class=normal> 288</span>
<span class=normal> 289</span>
<span class=normal> 290</span>
<span class=normal> 291</span>
<span class=normal> 292</span>
<span class=normal> 293</span>
<span class=normal> 294</span>
<span class=normal> 295</span>
<span class=normal> 296</span>
<span class=normal> 297</span>
<span class=normal> 298</span>
<span class=normal> 299</span>
<span class=normal> 300</span>
<span class=normal> 301</span>
<span class=normal> 302</span>
<span class=normal> 303</span>
<span class=normal> 304</span>
<span class=normal> 305</span>
<span class=normal> 306</span>
<span class=normal> 307</span>
<span class=normal> 308</span>
<span class=normal> 309</span>
<span class=normal> 310</span>
<span class=normal> 311</span>
<span class=normal> 312</span>
<span class=normal> 313</span>
<span class=normal> 314</span>
<span class=normal> 315</span>
<span class=normal> 316</span>
<span class=normal> 317</span>
<span class=normal> 318</span>
<span class=normal> 319</span>
<span class=normal> 320</span>
<span class=normal> 321</span>
<span class=normal> 322</span>
<span class=normal> 323</span>
<span class=normal> 324</span>
<span class=normal> 325</span>
<span class=normal> 326</span>
<span class=normal> 327</span>
<span class=normal> 328</span>
<span class=normal> 329</span>
<span class=normal> 330</span>
<span class=normal> 331</span>
<span class=normal> 332</span>
<span class=normal> 333</span>
<span class=normal> 334</span>
<span class=normal> 335</span>
<span class=normal> 336</span>
<span class=normal> 337</span>
<span class=normal> 338</span>
<span class=normal> 339</span>
<span class=normal> 340</span>
<span class=normal> 341</span>
<span class=normal> 342</span>
<span class=normal> 343</span>
<span class=normal> 344</span>
<span class=normal> 345</span>
<span class=normal> 346</span>
<span class=normal> 347</span>
<span class=normal> 348</span>
<span class=normal> 349</span>
<span class=normal> 350</span>
<span class=normal> 351</span>
<span class=normal> 352</span>
<span class=normal> 353</span>
<span class=normal> 354</span>
<span class=normal> 355</span>
<span class=normal> 356</span>
<span class=normal> 357</span>
<span class=normal> 358</span>
<span class=normal> 359</span>
<span class=normal> 360</span>
<span class=normal> 361</span>
<span class=normal> 362</span>
<span class=normal> 363</span>
<span class=normal> 364</span>
<span class=normal> 365</span>
<span class=normal> 366</span>
<span class=normal> 367</span>
<span class=normal> 368</span>
<span class=normal> 369</span>
<span class=normal> 370</span>
<span class=normal> 371</span>
<span class=normal> 372</span>
<span class=normal> 373</span>
<span class=normal> 374</span>
<span class=normal> 375</span>
<span class=normal> 376</span>
<span class=normal> 377</span>
<span class=normal> 378</span>
<span class=normal> 379</span>
<span class=normal> 380</span>
<span class=normal> 381</span>
<span class=normal> 382</span>
<span class=normal> 383</span>
<span class=normal> 384</span>
<span class=normal> 385</span>
<span class=normal> 386</span>
<span class=normal> 387</span>
<span class=normal> 388</span>
<span class=normal> 389</span>
<span class=normal> 390</span>
<span class=normal> 391</span>
<span class=normal> 392</span>
<span class=normal> 393</span>
<span class=normal> 394</span>
<span class=normal> 395</span>
<span class=normal> 396</span>
<span class=normal> 397</span>
<span class=normal> 398</span>
<span class=normal> 399</span>
<span class=normal> 400</span>
<span class=normal> 401</span>
<span class=normal> 402</span>
<span class=normal> 403</span>
<span class=normal> 404</span>
<span class=normal> 405</span>
<span class=normal> 406</span>
<span class=normal> 407</span>
<span class=normal> 408</span>
<span class=normal> 409</span>
<span class=normal> 410</span>
<span class=normal> 411</span>
<span class=normal> 412</span>
<span class=normal> 413</span>
<span class=normal> 414</span>
<span class=normal> 415</span>
<span class=normal> 416</span>
<span class=normal> 417</span>
<span class=normal> 418</span>
<span class=normal> 419</span>
<span class=normal> 420</span>
<span class=normal> 421</span>
<span class=normal> 422</span>
<span class=normal> 423</span>
<span class=normal> 424</span>
<span class=normal> 425</span>
<span class=normal> 426</span>
<span class=normal> 427</span>
<span class=normal> 428</span>
<span class=normal> 429</span>
<span class=normal> 430</span>
<span class=normal> 431</span>
<span class=normal> 432</span>
<span class=normal> 433</span>
<span class=normal> 434</span>
<span class=normal> 435</span>
<span class=normal> 436</span>
<span class=normal> 437</span>
<span class=normal> 438</span>
<span class=normal> 439</span>
<span class=normal> 440</span>
<span class=normal> 441</span>
<span class=normal> 442</span>
<span class=normal> 443</span>
<span class=normal> 444</span>
<span class=normal> 445</span>
<span class=normal> 446</span>
<span class=normal> 447</span>
<span class=normal> 448</span>
<span class=normal> 449</span>
<span class=normal> 450</span>
<span class=normal> 451</span>
<span class=normal> 452</span>
<span class=normal> 453</span>
<span class=normal> 454</span>
<span class=normal> 455</span>
<span class=normal> 456</span>
<span class=normal> 457</span>
<span class=normal> 458</span>
<span class=normal> 459</span>
<span class=normal> 460</span>
<span class=normal> 461</span>
<span class=normal> 462</span>
<span class=normal> 463</span>
<span class=normal> 464</span>
<span class=normal> 465</span>
<span class=normal> 466</span>
<span class=normal> 467</span>
<span class=normal> 468</span>
<span class=normal> 469</span>
<span class=normal> 470</span>
<span class=normal> 471</span>
<span class=normal> 472</span>
<span class=normal> 473</span>
<span class=normal> 474</span>
<span class=normal> 475</span>
<span class=normal> 476</span>
<span class=normal> 477</span>
<span class=normal> 478</span>
<span class=normal> 479</span>
<span class=normal> 480</span>
<span class=normal> 481</span>
<span class=normal> 482</span>
<span class=normal> 483</span>
<span class=normal> 484</span>
<span class=normal> 485</span>
<span class=normal> 486</span>
<span class=normal> 487</span>
<span class=normal> 488</span>
<span class=normal> 489</span>
<span class=normal> 490</span>
<span class=normal> 491</span>
<span class=normal> 492</span>
<span class=normal> 493</span>
<span class=normal> 494</span>
<span class=normal> 495</span>
<span class=normal> 496</span>
<span class=normal> 497</span>
<span class=normal> 498</span>
<span class=normal> 499</span>
<span class=normal> 500</span>
<span class=normal> 501</span>
<span class=normal> 502</span>
<span class=normal> 503</span>
<span class=normal> 504</span>
<span class=normal> 505</span>
<span class=normal> 506</span>
<span class=normal> 507</span>
<span class=normal> 508</span>
<span class=normal> 509</span>
<span class=normal> 510</span>
<span class=normal> 511</span>
<span class=normal> 512</span>
<span class=normal> 513</span>
<span class=normal> 514</span>
<span class=normal> 515</span>
<span class=normal> 516</span>
<span class=normal> 517</span>
<span class=normal> 518</span>
<span class=normal> 519</span>
<span class=normal> 520</span>
<span class=normal> 521</span>
<span class=normal> 522</span>
<span class=normal> 523</span>
<span class=normal> 524</span>
<span class=normal> 525</span>
<span class=normal> 526</span>
<span class=normal> 527</span>
<span class=normal> 528</span>
<span class=normal> 529</span>
<span class=normal> 530</span>
<span class=normal> 531</span>
<span class=normal> 532</span>
<span class=normal> 533</span>
<span class=normal> 534</span>
<span class=normal> 535</span>
<span class=normal> 536</span>
<span class=normal> 537</span>
<span class=normal> 538</span>
<span class=normal> 539</span>
<span class=normal> 540</span>
<span class=normal> 541</span>
<span class=normal> 542</span>
<span class=normal> 543</span>
<span class=normal> 544</span>
<span class=normal> 545</span>
<span class=normal> 546</span>
<span class=normal> 547</span>
<span class=normal> 548</span>
<span class=normal> 549</span>
<span class=normal> 550</span>
<span class=normal> 551</span>
<span class=normal> 552</span>
<span class=normal> 553</span>
<span class=normal> 554</span>
<span class=normal> 555</span>
<span class=normal> 556</span>
<span class=normal> 557</span>
<span class=normal> 558</span>
<span class=normal> 559</span>
<span class=normal> 560</span>
<span class=normal> 561</span>
<span class=normal> 562</span>
<span class=normal> 563</span>
<span class=normal> 564</span>
<span class=normal> 565</span>
<span class=normal> 566</span>
<span class=normal> 567</span>
<span class=normal> 568</span>
<span class=normal> 569</span>
<span class=normal> 570</span>
<span class=normal> 571</span>
<span class=normal> 572</span>
<span class=normal> 573</span>
<span class=normal> 574</span>
<span class=normal> 575</span>
<span class=normal> 576</span>
<span class=normal> 577</span>
<span class=normal> 578</span>
<span class=normal> 579</span>
<span class=normal> 580</span>
<span class=normal> 581</span>
<span class=normal> 582</span>
<span class=normal> 583</span>
<span class=normal> 584</span>
<span class=normal> 585</span>
<span class=normal> 586</span>
<span class=normal> 587</span>
<span class=normal> 588</span>
<span class=normal> 589</span>
<span class=normal> 590</span>
<span class=normal> 591</span>
<span class=normal> 592</span>
<span class=normal> 593</span>
<span class=normal> 594</span>
<span class=normal> 595</span>
<span class=normal> 596</span>
<span class=normal> 597</span>
<span class=normal> 598</span>
<span class=normal> 599</span>
<span class=normal> 600</span>
<span class=normal> 601</span>
<span class=normal> 602</span>
<span class=normal> 603</span>
<span class=normal> 604</span>
<span class=normal> 605</span>
<span class=normal> 606</span>
<span class=normal> 607</span>
<span class=normal> 608</span>
<span class=normal> 609</span>
<span class=normal> 610</span>
<span class=normal> 611</span>
<span class=normal> 612</span>
<span class=normal> 613</span>
<span class=normal> 614</span>
<span class=normal> 615</span>
<span class=normal> 616</span>
<span class=normal> 617</span>
<span class=normal> 618</span>
<span class=normal> 619</span>
<span class=normal> 620</span>
<span class=normal> 621</span>
<span class=normal> 622</span>
<span class=normal> 623</span>
<span class=normal> 624</span>
<span class=normal> 625</span>
<span class=normal> 626</span>
<span class=normal> 627</span>
<span class=normal> 628</span>
<span class=normal> 629</span>
<span class=normal> 630</span>
<span class=normal> 631</span>
<span class=normal> 632</span>
<span class=normal> 633</span>
<span class=normal> 634</span>
<span class=normal> 635</span>
<span class=normal> 636</span>
<span class=normal> 637</span>
<span class=normal> 638</span>
<span class=normal> 639</span>
<span class=normal> 640</span>
<span class=normal> 641</span>
<span class=normal> 642</span>
<span class=normal> 643</span>
<span class=normal> 644</span>
<span class=normal> 645</span>
<span class=normal> 646</span>
<span class=normal> 647</span>
<span class=normal> 648</span>
<span class=normal> 649</span>
<span class=normal> 650</span>
<span class=normal> 651</span>
<span class=normal> 652</span>
<span class=normal> 653</span>
<span class=normal> 654</span>
<span class=normal> 655</span>
<span class=normal> 656</span>
<span class=normal> 657</span>
<span class=normal> 658</span>
<span class=normal> 659</span>
<span class=normal> 660</span>
<span class=normal> 661</span>
<span class=normal> 662</span>
<span class=normal> 663</span>
<span class=normal> 664</span>
<span class=normal> 665</span>
<span class=normal> 666</span>
<span class=normal> 667</span>
<span class=normal> 668</span>
<span class=normal> 669</span>
<span class=normal> 670</span>
<span class=normal> 671</span>
<span class=normal> 672</span>
<span class=normal> 673</span>
<span class=normal> 674</span>
<span class=normal> 675</span>
<span class=normal> 676</span>
<span class=normal> 677</span>
<span class=normal> 678</span>
<span class=normal> 679</span>
<span class=normal> 680</span>
<span class=normal> 681</span>
<span class=normal> 682</span>
<span class=normal> 683</span>
<span class=normal> 684</span>
<span class=normal> 685</span>
<span class=normal> 686</span>
<span class=normal> 687</span>
<span class=normal> 688</span>
<span class=normal> 689</span>
<span class=normal> 690</span>
<span class=normal> 691</span>
<span class=normal> 692</span>
<span class=normal> 693</span>
<span class=normal> 694</span>
<span class=normal> 695</span>
<span class=normal> 696</span>
<span class=normal> 697</span>
<span class=normal> 698</span>
<span class=normal> 699</span>
<span class=normal> 700</span>
<span class=normal> 701</span>
<span class=normal> 702</span>
<span class=normal> 703</span>
<span class=normal> 704</span>
<span class=normal> 705</span>
<span class=normal> 706</span>
<span class=normal> 707</span>
<span class=normal> 708</span>
<span class=normal> 709</span>
<span class=normal> 710</span>
<span class=normal> 711</span>
<span class=normal> 712</span>
<span class=normal> 713</span>
<span class=normal> 714</span>
<span class=normal> 715</span>
<span class=normal> 716</span>
<span class=normal> 717</span>
<span class=normal> 718</span>
<span class=normal> 719</span>
<span class=normal> 720</span>
<span class=normal> 721</span>
<span class=normal> 722</span>
<span class=normal> 723</span>
<span class=normal> 724</span>
<span class=normal> 725</span>
<span class=normal> 726</span>
<span class=normal> 727</span>
<span class=normal> 728</span>
<span class=normal> 729</span>
<span class=normal> 730</span>
<span class=normal> 731</span>
<span class=normal> 732</span>
<span class=normal> 733</span>
<span class=normal> 734</span>
<span class=normal> 735</span>
<span class=normal> 736</span>
<span class=normal> 737</span>
<span class=normal> 738</span>
<span class=normal> 739</span>
<span class=normal> 740</span>
<span class=normal> 741</span>
<span class=normal> 742</span>
<span class=normal> 743</span>
<span class=normal> 744</span>
<span class=normal> 745</span>
<span class=normal> 746</span>
<span class=normal> 747</span>
<span class=normal> 748</span>
<span class=normal> 749</span>
<span class=normal> 750</span>
<span class=normal> 751</span>
<span class=normal> 752</span>
<span class=normal> 753</span>
<span class=normal> 754</span>
<span class=normal> 755</span>
<span class=normal> 756</span>
<span class=normal> 757</span>
<span class=normal> 758</span>
<span class=normal> 759</span>
<span class=normal> 760</span>
<span class=normal> 761</span>
<span class=normal> 762</span>
<span class=normal> 763</span>
<span class=normal> 764</span>
<span class=normal> 765</span>
<span class=normal> 766</span>
<span class=normal> 767</span>
<span class=normal> 768</span>
<span class=normal> 769</span>
<span class=normal> 770</span>
<span class=normal> 771</span>
<span class=normal> 772</span>
<span class=normal> 773</span>
<span class=normal> 774</span>
<span class=normal> 775</span>
<span class=normal> 776</span>
<span class=normal> 777</span>
<span class=normal> 778</span>
<span class=normal> 779</span>
<span class=normal> 780</span>
<span class=normal> 781</span>
<span class=normal> 782</span>
<span class=normal> 783</span>
<span class=normal> 784</span>
<span class=normal> 785</span>
<span class=normal> 786</span>
<span class=normal> 787</span>
<span class=normal> 788</span>
<span class=normal> 789</span>
<span class=normal> 790</span>
<span class=normal> 791</span>
<span class=normal> 792</span>
<span class=normal> 793</span>
<span class=normal> 794</span>
<span class=normal> 795</span>
<span class=normal> 796</span>
<span class=normal> 797</span>
<span class=normal> 798</span>
<span class=normal> 799</span>
<span class=normal> 800</span>
<span class=normal> 801</span>
<span class=normal> 802</span>
<span class=normal> 803</span>
<span class=normal> 804</span>
<span class=normal> 805</span>
<span class=normal> 806</span>
<span class=normal> 807</span>
<span class=normal> 808</span>
<span class=normal> 809</span>
<span class=normal> 810</span>
<span class=normal> 811</span>
<span class=normal> 812</span>
<span class=normal> 813</span>
<span class=normal> 814</span>
<span class=normal> 815</span>
<span class=normal> 816</span>
<span class=normal> 817</span>
<span class=normal> 818</span>
<span class=normal> 819</span>
<span class=normal> 820</span>
<span class=normal> 821</span>
<span class=normal> 822</span>
<span class=normal> 823</span>
<span class=normal> 824</span>
<span class=normal> 825</span>
<span class=normal> 826</span>
<span class=normal> 827</span>
<span class=normal> 828</span>
<span class=normal> 829</span>
<span class=normal> 830</span>
<span class=normal> 831</span>
<span class=normal> 832</span>
<span class=normal> 833</span>
<span class=normal> 834</span>
<span class=normal> 835</span>
<span class=normal> 836</span>
<span class=normal> 837</span>
<span class=normal> 838</span>
<span class=normal> 839</span>
<span class=normal> 840</span>
<span class=normal> 841</span>
<span class=normal> 842</span>
<span class=normal> 843</span>
<span class=normal> 844</span>
<span class=normal> 845</span>
<span class=normal> 846</span>
<span class=normal> 847</span>
<span class=normal> 848</span>
<span class=normal> 849</span>
<span class=normal> 850</span>
<span class=normal> 851</span>
<span class=normal> 852</span>
<span class=normal> 853</span>
<span class=normal> 854</span>
<span class=normal> 855</span>
<span class=normal> 856</span>
<span class=normal> 857</span>
<span class=normal> 858</span>
<span class=normal> 859</span>
<span class=normal> 860</span>
<span class=normal> 861</span>
<span class=normal> 862</span>
<span class=normal> 863</span>
<span class=normal> 864</span>
<span class=normal> 865</span>
<span class=normal> 866</span>
<span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ExtractReview</span><span class=p>(</span><span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>InstancePlugin</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Extracting Review mov file for Ftrack</span>

<span class=sd>    Compulsory attribute of representation is tags list with &quot;review&quot;,</span>
<span class=sd>    otherwise the representation is ignored.</span>

<span class=sd>    All new representations are created and encoded by ffmpeg following</span>
<span class=sd>    presets found in AYON Settings interface at</span>
<span class=sd>    `project_settings/global/publish/ExtractReview/profiles:outputs`.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>label</span> <span class=o>=</span> <span class=s2>&quot;Extract Review&quot;</span>
    <span class=n>order</span> <span class=o>=</span> <span class=n>pyblish</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>ExtractorOrder</span> <span class=o>+</span> <span class=mf>0.02</span>
    <span class=n>families</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;review&quot;</span><span class=p>]</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s2>&quot;nuke&quot;</span><span class=p>,</span>
        <span class=s2>&quot;maya&quot;</span><span class=p>,</span>
        <span class=s2>&quot;blender&quot;</span><span class=p>,</span>
        <span class=s2>&quot;houdini&quot;</span><span class=p>,</span>
        <span class=s2>&quot;max&quot;</span><span class=p>,</span>
        <span class=s2>&quot;shell&quot;</span><span class=p>,</span>
        <span class=s2>&quot;hiero&quot;</span><span class=p>,</span>
        <span class=s2>&quot;premiere&quot;</span><span class=p>,</span>
        <span class=s2>&quot;harmony&quot;</span><span class=p>,</span>
        <span class=s2>&quot;traypublisher&quot;</span><span class=p>,</span>
        <span class=s2>&quot;fusion&quot;</span><span class=p>,</span>
        <span class=s2>&quot;tvpaint&quot;</span><span class=p>,</span>
        <span class=s2>&quot;resolve&quot;</span><span class=p>,</span>
        <span class=s2>&quot;webpublisher&quot;</span><span class=p>,</span>
        <span class=s2>&quot;aftereffects&quot;</span><span class=p>,</span>
        <span class=s2>&quot;flame&quot;</span><span class=p>,</span>
        <span class=s2>&quot;unreal&quot;</span>
    <span class=p>]</span>

    <span class=c1># Supported extensions</span>
    <span class=n>image_exts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;exr&quot;</span><span class=p>,</span> <span class=s2>&quot;jpg&quot;</span><span class=p>,</span> <span class=s2>&quot;jpeg&quot;</span><span class=p>,</span> <span class=s2>&quot;png&quot;</span><span class=p>,</span> <span class=s2>&quot;dpx&quot;</span><span class=p>,</span> <span class=s2>&quot;tga&quot;</span><span class=p>,</span> <span class=s2>&quot;tiff&quot;</span><span class=p>,</span> <span class=s2>&quot;tif&quot;</span><span class=p>]</span>
    <span class=n>video_exts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;mov&quot;</span><span class=p>,</span> <span class=s2>&quot;mp4&quot;</span><span class=p>]</span>
    <span class=n>supported_exts</span> <span class=o>=</span> <span class=n>image_exts</span> <span class=o>+</span> <span class=n>video_exts</span>

    <span class=n>alpha_exts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;exr&quot;</span><span class=p>,</span> <span class=s2>&quot;png&quot;</span><span class=p>,</span> <span class=s2>&quot;dpx&quot;</span><span class=p>]</span>

    <span class=c1># Preset attributes</span>
    <span class=n>profiles</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]))</span>
        <span class=c1># Skip review when requested.</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;review&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
            <span class=k>return</span>

        <span class=c1># Run processing</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>main_process</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

        <span class=c1># Make sure cleanup happens and pop representations with &quot;delete&quot; tag.</span>
        <span class=k>for</span> <span class=n>repre</span> <span class=ow>in</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]):</span>
            <span class=n>tags</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
            <span class=c1># Representation is not marked to be deleted</span>
            <span class=k>if</span> <span class=s2>&quot;delete&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>tags</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=c1># The representation can be used as thumbnail source</span>
            <span class=k>if</span> <span class=s2>&quot;thumbnail&quot;</span> <span class=ow>in</span> <span class=n>tags</span> <span class=ow>or</span> <span class=s2>&quot;need_thumbnail&quot;</span> <span class=ow>in</span> <span class=n>tags</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Removing representation: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_outputs_for_instance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
        <span class=n>host_name</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;hostName&quot;</span><span class=p>]</span>
        <span class=n>product_type</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;productType&quot;</span><span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Host: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>host_name</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Product type: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>product_type</span><span class=p>))</span>

        <span class=n>profile</span> <span class=o>=</span> <span class=n>filter_profiles</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>profiles</span><span class=p>,</span>
            <span class=p>{</span>
                <span class=s2>&quot;hosts&quot;</span><span class=p>:</span> <span class=n>host_name</span><span class=p>,</span>
                <span class=s2>&quot;product_types&quot;</span><span class=p>:</span> <span class=n>product_type</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Skipped instance. None of profiles in presets are for&quot;</span>
                <span class=s2>&quot; Host: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2> | Product type: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>host_name</span><span class=p>,</span> <span class=n>product_type</span><span class=p>))</span>
            <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Matching profile: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>profile</span><span class=p>)))</span>

        <span class=n>product_name</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;productName&quot;</span><span class=p>)</span>
        <span class=n>instance_families</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>families_from_instance</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
        <span class=n>filtered_outputs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>filter_output_defs</span><span class=p>(</span>
            <span class=n>profile</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>instance_families</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>filtered_outputs</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Skipped instance. All output definitions from selected&quot;</span>
                <span class=s2>&quot; profile do not match instance families </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2> or&quot;</span>
                <span class=s2>&quot; product name </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>.&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>instance_families</span><span class=p>),</span> <span class=n>product_name</span><span class=p>))</span>

        <span class=c1># Store `filename_suffix` to save arguments</span>
        <span class=n>profile_outputs</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>filename_suffix</span><span class=p>,</span> <span class=n>definition</span> <span class=ow>in</span> <span class=n>filtered_outputs</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>definition</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>filename_suffix</span>
            <span class=n>profile_outputs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>definition</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>profile_outputs</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_outputs_per_representations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>profile_outputs</span><span class=p>):</span>
        <span class=n>outputs_per_representations</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>repre</span> <span class=ow>in</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]:</span>
            <span class=n>repre_name</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>))</span>
            <span class=n>tags</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
            <span class=n>custom_tags</span> <span class=o>=</span> <span class=n>repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;custom_tags&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=s2>&quot;review&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>tags</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
                    <span class=s2>&quot;Repre: </span><span class=si>{}</span><span class=s2> - Didn&#39;t find </span><span class=se>\&quot;</span><span class=s2>review</span><span class=se>\&quot;</span><span class=s2> in tags. Skipping&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre_name</span><span class=p>))</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=s2>&quot;thumbnail&quot;</span> <span class=ow>in</span> <span class=n>tags</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
                    <span class=s2>&quot;Repre: </span><span class=si>{}</span><span class=s2> - Found </span><span class=se>\&quot;</span><span class=s2>thumbnail</span><span class=se>\&quot;</span><span class=s2> in tags. Skipping&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre_name</span><span class=p>))</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=s2>&quot;passing&quot;</span> <span class=ow>in</span> <span class=n>tags</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
                    <span class=s2>&quot;Repre: </span><span class=si>{}</span><span class=s2> - Found </span><span class=se>\&quot;</span><span class=s2>passing</span><span class=se>\&quot;</span><span class=s2> in tags. Skipping&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre_name</span><span class=p>))</span>
                <span class=k>continue</span>

            <span class=n>input_ext</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;ext&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>input_ext</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>):</span>
                <span class=n>input_ext</span> <span class=o>=</span> <span class=n>input_ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>

            <span class=k>if</span> <span class=n>input_ext</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>supported_exts</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
                    <span class=s2>&quot;Representation has unsupported extension </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                        <span class=n>input_ext</span>
                    <span class=p>)</span>
                <span class=p>)</span>
                <span class=k>continue</span>

            <span class=c1># Filter output definition by representation&#39;s</span>
            <span class=c1># custom tags (optional)</span>
            <span class=n>outputs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>filter_outputs_by_custom_tags</span><span class=p>(</span>
                <span class=n>profile_outputs</span><span class=p>,</span> <span class=n>custom_tags</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>outputs</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                    <span class=s2>&quot;Skipped representation. All output definitions from&quot;</span>
                    <span class=s2>&quot; selected profile does not match to representation&#39;s&quot;</span>
                    <span class=s2>&quot; custom tags. </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>custom_tags</span><span class=p>)))</span>
                <span class=k>continue</span>

            <span class=n>outputs_per_representations</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>repre</span><span class=p>,</span> <span class=n>outputs</span><span class=p>))</span>
        <span class=k>return</span> <span class=n>outputs_per_representations</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_single_frame_filter</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_filepaths</span><span class=p>,</span> <span class=n>output_defs</span><span class=p>):</span>
        <span class=n>single_frame_image</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>input_filepaths</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>input_filepaths</span><span class=p>[</span><span class=mi>0</span><span class=p>])[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
            <span class=n>single_frame_image</span> <span class=o>=</span> <span class=n>ext</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>IMAGE_EXTENSIONS</span>

        <span class=n>filtered_defs</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>output_def</span> <span class=ow>in</span> <span class=n>output_defs</span><span class=p>:</span>
            <span class=n>output_filters</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;filter&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>
            <span class=n>frame_filter</span> <span class=o>=</span> <span class=n>output_filters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;single_frame_filter&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=p>(</span><span class=ow>not</span> <span class=n>single_frame_image</span> <span class=ow>and</span> <span class=n>frame_filter</span> <span class=o>==</span> <span class=s2>&quot;single_frame&quot;</span><span class=p>)</span>
                <span class=ow>or</span> <span class=p>(</span><span class=n>single_frame_image</span> <span class=ow>and</span> <span class=n>frame_filter</span> <span class=o>==</span> <span class=s2>&quot;multi_frame&quot;</span><span class=p>)</span>
            <span class=p>):</span>
                <span class=k>continue</span>

            <span class=n>filtered_defs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output_def</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>filtered_defs</span>

    <span class=k>def</span><span class=w> </span><span class=nf>main_process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
        <span class=n>instance_label</span> <span class=o>=</span> <span class=n>get_publish_instance_label</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Processing instance </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>instance_label</span><span class=p>))</span>
        <span class=n>profile_outputs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_outputs_for_instance</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>profile_outputs</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=c1># Loop through representations</span>
        <span class=n>outputs_per_repres</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_outputs_per_representations</span><span class=p>(</span>
            <span class=n>instance</span><span class=p>,</span> <span class=n>profile_outputs</span>
        <span class=p>)</span>

        <span class=k>for</span> <span class=n>repre</span><span class=p>,</span> <span class=n>output_defs</span> <span class=ow>in</span> <span class=n>outputs_per_repres</span><span class=p>:</span>
            <span class=c1># Check if input should be preconverted before processing</span>
            <span class=c1># Store original staging dir (it&#39;s value may change)</span>
            <span class=n>src_repre_staging_dir</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span>
            <span class=c1># Receive filepath to first file in representation</span>
            <span class=n>first_input_path</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>input_filepaths</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_is_sequence</span><span class=p>(</span><span class=n>repre</span><span class=p>):</span>
                <span class=n>first_input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                    <span class=n>src_repre_staging_dir</span><span class=p>,</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=n>input_filepaths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>first_input_path</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>filename</span> <span class=ow>in</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
                    <span class=n>filepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                        <span class=n>src_repre_staging_dir</span><span class=p>,</span> <span class=n>filename</span>
                    <span class=p>)</span>
                    <span class=n>input_filepaths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>first_input_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                        <span class=n>first_input_path</span> <span class=o>=</span> <span class=n>filepath</span>

            <span class=n>filtered_output_defs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_single_frame_filter</span><span class=p>(</span>
                <span class=n>input_filepaths</span><span class=p>,</span> <span class=n>output_defs</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>filtered_output_defs</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
                    <span class=s2>&quot;Repre: </span><span class=si>{}</span><span class=s2> - All output definitions were filtered&quot;</span>
                    <span class=s2>&quot; out by single frame filter. Skipping&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]))</span>
                <span class=k>continue</span>

            <span class=c1># Skip if file is not set</span>
            <span class=k>if</span> <span class=n>first_input_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
                    <span class=s2>&quot;Representation </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2> have empty files. Skipped.&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]))</span>
                <span class=k>continue</span>

            <span class=c1># Determine if representation requires pre conversion for ffmpeg</span>
            <span class=n>do_convert</span> <span class=o>=</span> <span class=n>should_convert_for_ffmpeg</span><span class=p>(</span><span class=n>first_input_path</span><span class=p>)</span>
            <span class=c1># If result is None the requirement of conversion can&#39;t be</span>
            <span class=c1>#   determined</span>
            <span class=k>if</span> <span class=n>do_convert</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                    <span class=s2>&quot;Can&#39;t determine if representation requires conversion.&quot;</span>
                    <span class=s2>&quot; Skipped.&quot;</span>
                <span class=p>))</span>
                <span class=k>continue</span>

            <span class=n>layer_name</span> <span class=o>=</span> <span class=n>get_review_layer_name</span><span class=p>(</span><span class=n>first_input_path</span><span class=p>)</span>

            <span class=c1># Do conversion if needed</span>
            <span class=c1>#   - change staging dir of source representation</span>
            <span class=c1>#   - must be set back after output definitions processing</span>
            <span class=k>if</span> <span class=n>do_convert</span><span class=p>:</span>
                <span class=n>new_staging_dir</span> <span class=o>=</span> <span class=n>get_temp_dir</span><span class=p>(</span>
                    <span class=n>project_name</span><span class=o>=</span><span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;projectName&quot;</span><span class=p>],</span>
                    <span class=n>use_local_temp</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_staging_dir</span>

                <span class=n>convert_input_paths_for_ffmpeg</span><span class=p>(</span>
                    <span class=n>input_filepaths</span><span class=p>,</span>
                    <span class=n>new_staging_dir</span><span class=p>,</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
                <span class=p>)</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_render_output_definitions</span><span class=p>(</span>
                    <span class=n>instance</span><span class=p>,</span>
                    <span class=n>repre</span><span class=p>,</span>
                    <span class=n>src_repre_staging_dir</span><span class=p>,</span>
                    <span class=n>filtered_output_defs</span><span class=p>,</span>
                    <span class=n>layer_name</span>
                <span class=p>)</span>

            <span class=k>finally</span><span class=p>:</span>
                <span class=c1># Make sure temporary staging is cleaned up and representation</span>
                <span class=c1>#   has set origin stagingDir</span>
                <span class=k>if</span> <span class=n>do_convert</span><span class=p>:</span>
                    <span class=c1># Set staging dir of source representation back to previous</span>
                    <span class=c1>#   value</span>
                    <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>src_repre_staging_dir</span>
                    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>new_staging_dir</span><span class=p>):</span>
                        <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>new_staging_dir</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_render_output_definitions</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>instance</span><span class=p>,</span>
        <span class=n>repre</span><span class=p>,</span>
        <span class=n>src_repre_staging_dir</span><span class=p>,</span>
        <span class=n>output_definitions</span><span class=p>,</span>
        <span class=n>layer_name</span>
    <span class=p>):</span>
        <span class=n>fill_data</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;anatomyData&quot;</span><span class=p>])</span>
        <span class=k>for</span> <span class=n>_output_def</span> <span class=ow>in</span> <span class=n>output_definitions</span><span class=p>:</span>
            <span class=n>output_def</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>_output_def</span><span class=p>)</span>
            <span class=c1># Make sure output definition has &quot;tags&quot; key</span>
            <span class=k>if</span> <span class=s2>&quot;tags&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>:</span>
                <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>

            <span class=k>if</span> <span class=s2>&quot;burnins&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>:</span>
                <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;burnins&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>

            <span class=c1># Create copy of representation</span>
            <span class=n>new_repre</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span>
            <span class=n>new_tags</span> <span class=o>=</span> <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
            <span class=c1># Make sure new representation has origin staging dir</span>
            <span class=c1>#   - this is because source representation may change</span>
            <span class=c1>#       it&#39;s staging dir because of ffmpeg conversion</span>
            <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>src_repre_staging_dir</span>

            <span class=c1># Remove &quot;delete&quot; tag from new repre if there is</span>
            <span class=k>if</span> <span class=s2>&quot;delete&quot;</span> <span class=ow>in</span> <span class=n>new_tags</span><span class=p>:</span>
                <span class=n>new_tags</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;delete&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=s2>&quot;need_thumbnail&quot;</span> <span class=ow>in</span> <span class=n>new_tags</span><span class=p>:</span>
                <span class=n>new_tags</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;need_thumbnail&quot;</span><span class=p>)</span>

            <span class=c1># Add additional tags from output definition to representation</span>
            <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]:</span>
                <span class=k>if</span> <span class=n>tag</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>new_tags</span><span class=p>:</span>
                    <span class=n>new_tags</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span>

            <span class=c1># Return tags to new representation</span>
            <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_tags</span>

            <span class=c1># Add burnin link from output definition to representation</span>
            <span class=k>for</span> <span class=n>burnin</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;burnins&quot;</span><span class=p>]:</span>
                <span class=k>if</span> <span class=n>burnin</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;burnins&quot;</span><span class=p>,</span> <span class=p>[]):</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;burnins&quot;</span><span class=p>):</span>
                        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;burnins&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
                    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;burnins&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>burnin</span><span class=p>))</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Linked burnins: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;burnins&quot;</span><span class=p>))</span>
            <span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;New representation tags: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>))</span>
            <span class=p>)</span>

            <span class=n>temp_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>prepare_temp_data</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>)</span>
            <span class=n>files_to_clean</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Checking sequence to fill gaps in sequence..&quot;</span><span class=p>)</span>
                <span class=n>files_to_clean</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fill_sequence_gaps</span><span class=p>(</span>
                    <span class=n>files</span><span class=o>=</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;origin_repre&quot;</span><span class=p>][</span><span class=s2>&quot;files&quot;</span><span class=p>],</span>
                    <span class=n>staging_dir</span><span class=o>=</span><span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>],</span>
                    <span class=n>start_frame</span><span class=o>=</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;frame_start&quot;</span><span class=p>],</span>
                    <span class=n>end_frame</span><span class=o>=</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;frame_end&quot;</span><span class=p>]</span>
                <span class=p>)</span>

            <span class=c1># create or update outputName</span>
            <span class=n>output_name</span> <span class=o>=</span> <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;outputName&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=n>output_ext</span> <span class=o>=</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;ext&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>output_name</span><span class=p>:</span>
                <span class=n>output_name</span> <span class=o>+=</span> <span class=s2>&quot;_&quot;</span>
            <span class=n>output_name</span> <span class=o>+=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;without_handles&quot;</span><span class=p>]:</span>
                <span class=n>output_name</span> <span class=o>+=</span> <span class=s2>&quot;_noHandles&quot;</span>

            <span class=c1># add outputName to anatomy format fill_data</span>
            <span class=n>fill_data</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
                <span class=s2>&quot;output&quot;</span><span class=p>:</span> <span class=n>output_name</span><span class=p>,</span>
                <span class=s2>&quot;ext&quot;</span><span class=p>:</span> <span class=n>output_ext</span><span class=p>,</span>

                <span class=c1># By adding `timecode` as data we can use it</span>
                <span class=c1># in the ffmpeg arguments for `--timecode` so that editorial</span>
                <span class=c1># like Resolve or Premiere can detect the start frame for e.g.</span>
                <span class=c1># review output files</span>
                <span class=s2>&quot;timecode&quot;</span><span class=p>:</span> <span class=n>frame_to_timecode</span><span class=p>(</span>
                    <span class=n>frame</span><span class=o>=</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;frame_start_handle&quot;</span><span class=p>],</span>
                    <span class=n>fps</span><span class=o>=</span><span class=nb>float</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>])</span>
                <span class=p>)</span>
            <span class=p>})</span>

            <span class=k>try</span><span class=p>:</span>  <span class=c1># temporary until oiiotool is supported cross platform</span>
                <span class=n>ffmpeg_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_ffmpeg_arguments</span><span class=p>(</span>
                    <span class=n>output_def</span><span class=p>,</span>
                    <span class=n>instance</span><span class=p>,</span>
                    <span class=n>new_repre</span><span class=p>,</span>
                    <span class=n>temp_data</span><span class=p>,</span>
                    <span class=n>fill_data</span><span class=p>,</span>
                    <span class=n>layer_name</span><span class=p>,</span>
                <span class=p>)</span>
            <span class=k>except</span> <span class=ne>ZeroDivisionError</span><span class=p>:</span>
                <span class=c1># TODO recalculate width and height using OIIO before</span>
                <span class=c1>#   conversion</span>
                <span class=k>if</span> <span class=s1>&#39;exr&#39;</span> <span class=ow>in</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;origin_repre&quot;</span><span class=p>][</span><span class=s2>&quot;ext&quot;</span><span class=p>]:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                        <span class=p>(</span>
                            <span class=s2>&quot;Unsupported compression on input files.&quot;</span>
                            <span class=s2>&quot; Skipping!!!&quot;</span>
                        <span class=p>),</span>
                        <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                    <span class=p>)</span>
                    <span class=k>return</span>
                <span class=k>raise</span> <span class=ne>NotImplementedError</span>

            <span class=n>subprcs_cmd</span> <span class=o>=</span> <span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>ffmpeg_args</span><span class=p>)</span>

            <span class=c1># run subprocess</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Executing: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>subprcs_cmd</span><span class=p>))</span>

            <span class=n>run_subprocess</span><span class=p>(</span><span class=n>subprcs_cmd</span><span class=p>,</span> <span class=n>shell</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>

            <span class=c1># delete files added to fill gaps</span>
            <span class=k>if</span> <span class=n>files_to_clean</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>files_to_clean</span><span class=p>:</span>
                    <span class=n>os</span><span class=o>.</span><span class=n>unlink</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

            <span class=n>new_repre</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
                <span class=s2>&quot;fps&quot;</span><span class=p>:</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>],</span>
                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>_</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_name</span><span class=p>,</span> <span class=n>output_ext</span><span class=p>),</span>
                <span class=s2>&quot;outputName&quot;</span><span class=p>:</span> <span class=n>output_name</span><span class=p>,</span>
                <span class=s2>&quot;outputDef&quot;</span><span class=p>:</span> <span class=n>output_def</span><span class=p>,</span>
                <span class=s2>&quot;frameStartFtrack&quot;</span><span class=p>:</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>],</span>
                <span class=s2>&quot;frameEndFtrack&quot;</span><span class=p>:</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_end&quot;</span><span class=p>],</span>
                <span class=s2>&quot;ffmpeg_cmd&quot;</span><span class=p>:</span> <span class=n>subprcs_cmd</span>
            <span class=p>})</span>

            <span class=c1># Force to pop these key if are in new repre</span>
            <span class=n>new_repre</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;thumbnail&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
            <span class=k>if</span> <span class=s2>&quot;clean_name&quot;</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>,</span> <span class=p>[]):</span>
                <span class=n>new_repre</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;outputName&quot;</span><span class=p>)</span>

            <span class=c1># adding representation</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Adding new representation: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>new_repre</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_repre</span><span class=p>)</span>

            <span class=n>add_repre_files_for_cleanup</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>input_is_sequence</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repre</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Deduce from representation data if input is sequence.&quot;&quot;&quot;</span>
        <span class=c1># TODO GLOBAL ISSUE - Find better way how to find out if input</span>
        <span class=c1>#  is sequence. Issues (in theory):</span>
        <span class=c1>#   - there may be multiple files ant not be sequence</span>
        <span class=c1>#   - remainders are not checked at all</span>
        <span class=c1>#   - there can be more than one collection</span>
        <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>],</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>prepare_temp_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Prepare dictionary with values used across extractor&#39;s process.</span>

<span class=sd>        All data are collected from instance, context, origin representation</span>
<span class=sd>        and output definition.</span>

<span class=sd>        There are few required keys in Instance data: &quot;frameStart&quot;, &quot;frameEnd&quot;</span>
<span class=sd>        and &quot;fps&quot;.</span>

<span class=sd>        Args:</span>
<span class=sd>            instance (Instance): Currently processed instance.</span>
<span class=sd>            repre (dict): Representation from which new representation was</span>
<span class=sd>                copied.</span>
<span class=sd>            output_def (dict): Definition of output of this plugin.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict: All data which are used across methods during process.</span>
<span class=sd>                Their values should not change during process but new keys</span>
<span class=sd>                with values may be added.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>frame_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;frameStart&quot;</span><span class=p>]</span>
        <span class=n>frame_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;frameEnd&quot;</span><span class=p>]</span>

        <span class=c1># Try to get handles from instance</span>
        <span class=n>handle_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;handleStart&quot;</span><span class=p>)</span>
        <span class=n>handle_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;handleEnd&quot;</span><span class=p>)</span>
        <span class=c1># If even one of handle values is not set on instance use</span>
        <span class=c1># handles from context</span>
        <span class=k>if</span> <span class=n>handle_start</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>handle_end</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>handle_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleStart&quot;</span><span class=p>]</span>
            <span class=n>handle_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleEnd&quot;</span><span class=p>]</span>

        <span class=n>frame_start_handle</span> <span class=o>=</span> <span class=n>frame_start</span> <span class=o>-</span> <span class=n>handle_start</span>
        <span class=n>frame_end_handle</span> <span class=o>=</span> <span class=n>frame_end</span> <span class=o>+</span> <span class=n>handle_end</span>

        <span class=c1># Change output frames when output should be without handles</span>
        <span class=n>without_handles</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=s2>&quot;no-handles&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>])</span>
        <span class=k>if</span> <span class=n>without_handles</span><span class=p>:</span>
            <span class=n>output_frame_start</span> <span class=o>=</span> <span class=n>frame_start</span>
            <span class=n>output_frame_end</span> <span class=o>=</span> <span class=n>frame_end</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>output_frame_start</span> <span class=o>=</span> <span class=n>frame_start_handle</span>
            <span class=n>output_frame_end</span> <span class=o>=</span> <span class=n>frame_end_handle</span>

        <span class=n>handles_are_set</span> <span class=o>=</span> <span class=n>handle_start</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>handle_end</span> <span class=o>&gt;</span> <span class=mi>0</span>

        <span class=n>with_audio</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=c1># Check if has `no-audio` tag</span>
            <span class=s2>&quot;no-audio&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
            <span class=c1># Check if instance has ny audio in data</span>
            <span class=ow>or</span> <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio&quot;</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=n>with_audio</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=n>input_is_sequence</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_is_sequence</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span>
        <span class=n>input_allow_bg</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>first_sequence_frame</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>input_is_sequence</span> <span class=ow>and</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
            <span class=c1># Calculate first frame that should be used</span>
            <span class=n>cols</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])</span>
            <span class=n>input_frames</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>cols</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>
            <span class=n>first_sequence_frame</span> <span class=o>=</span> <span class=n>input_frames</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=c1># WARNING: This is an issue as we don&#39;t know if first frame</span>
            <span class=c1>#   is with or without handles!</span>
            <span class=c1># - handle start is added but how do not know if we should</span>
            <span class=n>output_duration</span> <span class=o>=</span> <span class=p>(</span><span class=n>output_frame_end</span> <span class=o>-</span> <span class=n>output_frame_start</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=n>without_handles</span>
                <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>input_frames</span><span class=p>)</span> <span class=o>-</span> <span class=n>handle_start</span> <span class=o>&gt;=</span> <span class=n>output_duration</span>
            <span class=p>):</span>
                <span class=n>first_sequence_frame</span> <span class=o>+=</span> <span class=n>handle_start</span>

            <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>])[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>ext</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>alpha_exts</span><span class=p>:</span>
                <span class=n>input_allow_bg</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=k>return</span> <span class=p>{</span>
            <span class=s2>&quot;fps&quot;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]),</span>
            <span class=s2>&quot;frame_start&quot;</span><span class=p>:</span> <span class=n>frame_start</span><span class=p>,</span>
            <span class=s2>&quot;frame_end&quot;</span><span class=p>:</span> <span class=n>frame_end</span><span class=p>,</span>
            <span class=s2>&quot;handle_start&quot;</span><span class=p>:</span> <span class=n>handle_start</span><span class=p>,</span>
            <span class=s2>&quot;handle_end&quot;</span><span class=p>:</span> <span class=n>handle_end</span><span class=p>,</span>
            <span class=s2>&quot;frame_start_handle&quot;</span><span class=p>:</span> <span class=n>frame_start_handle</span><span class=p>,</span>
            <span class=s2>&quot;frame_end_handle&quot;</span><span class=p>:</span> <span class=n>frame_end_handle</span><span class=p>,</span>
            <span class=s2>&quot;output_frame_start&quot;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_frame_start</span><span class=p>),</span>
            <span class=s2>&quot;output_frame_end&quot;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_frame_end</span><span class=p>),</span>
            <span class=s2>&quot;pixel_aspect&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;pixelAspect&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>
            <span class=s2>&quot;resolution_width&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>),</span>
            <span class=s2>&quot;resolution_height&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>),</span>
            <span class=s2>&quot;origin_repre&quot;</span><span class=p>:</span> <span class=n>repre</span><span class=p>,</span>
            <span class=s2>&quot;input_is_sequence&quot;</span><span class=p>:</span> <span class=n>input_is_sequence</span><span class=p>,</span>
            <span class=s2>&quot;first_sequence_frame&quot;</span><span class=p>:</span> <span class=n>first_sequence_frame</span><span class=p>,</span>
            <span class=s2>&quot;input_allow_bg&quot;</span><span class=p>:</span> <span class=n>input_allow_bg</span><span class=p>,</span>
            <span class=s2>&quot;with_audio&quot;</span><span class=p>:</span> <span class=n>with_audio</span><span class=p>,</span>
            <span class=s2>&quot;without_handles&quot;</span><span class=p>:</span> <span class=n>without_handles</span><span class=p>,</span>
            <span class=s2>&quot;handles_are_set&quot;</span><span class=p>:</span> <span class=n>handles_are_set</span>
        <span class=p>}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_ffmpeg_arguments</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>output_def</span><span class=p>,</span>
        <span class=n>instance</span><span class=p>,</span>
        <span class=n>new_repre</span><span class=p>,</span>
        <span class=n>temp_data</span><span class=p>,</span>
        <span class=n>fill_data</span><span class=p>,</span>
        <span class=n>layer_name</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Prepares ffmpeg arguments for expected extraction.</span>

<span class=sd>        Prepares input and output arguments based on output definition and</span>
<span class=sd>        input files.</span>

<span class=sd>        Args:</span>
<span class=sd>            output_def (dict): Currently processed output definition.</span>
<span class=sd>            instance (Instance): Currently processed instance.</span>
<span class=sd>            new_repre (dict): Representation representing output of this</span>
<span class=sd>                process.</span>
<span class=sd>            temp_data (dict): Base data for successful process.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># Get FFmpeg arguments from profile presets</span>
        <span class=n>out_def_ffmpeg_args</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;ffmpeg_args&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>

        <span class=n>_ffmpeg_input_args</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;input&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=n>_ffmpeg_output_args</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;output&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=n>_ffmpeg_video_filters</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;video_filters&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=n>_ffmpeg_audio_filters</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio_filters&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>

        <span class=c1># Cleanup empty strings</span>
        <span class=n>ffmpeg_input_args</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_input_args</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=p>]</span>
        <span class=n>ffmpeg_video_filters</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_video_filters</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=p>]</span>
        <span class=n>ffmpeg_audio_filters</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_audio_filters</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=p>]</span>

        <span class=n>ffmpeg_output_args</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_output_args</span><span class=p>:</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>value</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>fill_data</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                    <span class=s2>&quot;Failed to format ffmpeg argument: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>value</span><span class=p>),</span>
                    <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                <span class=p>)</span>
                <span class=k>pass</span>
            <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>

        <span class=c1># Prepare input and output filepaths</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>input_output_paths</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>)</span>

        <span class=c1># Set output frames len to 1 when output is single image</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span>
            <span class=ow>and</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]</span>
        <span class=p>):</span>
            <span class=n>output_frames_len</span> <span class=o>=</span> <span class=mi>1</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>output_frames_len</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_end&quot;</span><span class=p>]</span>
                <span class=o>-</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>]</span>
                <span class=o>+</span> <span class=mi>1</span>
            <span class=p>)</span>

        <span class=n>duration_seconds</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>output_frames_len</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>])</span>

        <span class=c1># Define which layer should be used</span>
        <span class=k>if</span> <span class=n>layer_name</span><span class=p>:</span>
            <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s2>&quot;-layer&quot;</span><span class=p>,</span> <span class=n>layer_name</span><span class=p>])</span>

        <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
            <span class=c1># Set start frame of input sequence (just frame in filename)</span>
            <span class=c1># - definition of input filepath</span>
            <span class=c1># - add handle start if output should be without handles</span>
            <span class=n>start_number</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;first_sequence_frame&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;without_handles&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handles_are_set&quot;</span><span class=p>]:</span>
                <span class=n>start_number</span> <span class=o>+=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handle_start&quot;</span><span class=p>]</span>
            <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>start_number</span><span class=p>)</span>
            <span class=p>])</span>

            <span class=c1># TODO add fps mapping `{fps: fraction}` ?</span>
            <span class=c1># - e.g.: {</span>
            <span class=c1>#     &quot;25&quot;: &quot;25/1&quot;,</span>
            <span class=c1>#     &quot;24&quot;: &quot;24/1&quot;,</span>
            <span class=c1>#     &quot;23.976&quot;: &quot;24000/1001&quot;</span>
            <span class=c1># }</span>
            <span class=c1># Add framerate to input when input is sequence</span>
            <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-framerate&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>])</span>
            <span class=p>])</span>
            <span class=c1># Add duration of an input sequence if output is video</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
                <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                    <span class=s2>&quot;-to&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>duration_seconds</span><span class=p>)</span>
                <span class=p>])</span>

        <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
            <span class=c1># Set start frame of output sequence (just frame in filename)</span>
            <span class=c1># - this is definition of an output</span>
            <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>])</span>
            <span class=p>])</span>

        <span class=c1># Change output&#39;s duration and start point if should not contain</span>
        <span class=c1># handles</span>
        <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;without_handles&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handles_are_set&quot;</span><span class=p>]:</span>
            <span class=c1># Set output duration in seconds</span>
            <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>duration_seconds</span><span class=p>)</span>
            <span class=p>])</span>

            <span class=c1># Add -ss (start offset in seconds) if input is not sequence</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
                <span class=n>start_sec</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handle_start&quot;</span><span class=p>])</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]</span>
                <span class=c1># Set start time without handles</span>
                <span class=c1># - Skip if start sec is 0.0</span>
                <span class=k>if</span> <span class=n>start_sec</span> <span class=o>&gt;</span> <span class=mf>0.0</span><span class=p>:</span>
                    <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                        <span class=s2>&quot;-ss&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>start_sec</span><span class=p>)</span>
                    <span class=p>])</span>

        <span class=c1># Set frame range of output when input or output is sequence</span>
        <span class=k>elif</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
            <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-frames:v&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>output_frames_len</span><span class=p>)</span>
            <span class=p>])</span>

        <span class=c1># Add video/image input path</span>
        <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path&quot;</span><span class=p>])</span>
        <span class=p>])</span>

        <span class=c1># Add audio arguments if there are any. Skipped when output are images.</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;with_audio&quot;</span><span class=p>]:</span>
            <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>audio_args</span><span class=p>(</span>
                <span class=n>instance</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>duration_seconds</span>
            <span class=p>)</span>
            <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_in_args</span><span class=p>)</span>
            <span class=n>ffmpeg_audio_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_filters</span><span class=p>)</span>
            <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_out_args</span><span class=p>)</span>

        <span class=n>res_filters</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>rescaling_filters</span><span class=p>(</span><span class=n>temp_data</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>)</span>
        <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>res_filters</span><span class=p>)</span>

        <span class=n>ffmpeg_input_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>split_ffmpeg_args</span><span class=p>(</span><span class=n>ffmpeg_input_args</span><span class=p>)</span>

        <span class=n>lut_filters</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lut_filters</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>ffmpeg_input_args</span><span class=p>)</span>
        <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>lut_filters</span><span class=p>)</span>

        <span class=n>bg_alpha</span> <span class=o>=</span> <span class=mf>0.0</span>
        <span class=n>bg_color</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;bg_color&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>bg_color</span><span class=p>:</span>
            <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span><span class=p>,</span> <span class=n>bg_alpha</span> <span class=o>=</span> <span class=n>bg_color</span>

        <span class=k>if</span> <span class=n>bg_alpha</span> <span class=o>&gt;</span> <span class=mf>0.0</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_allow_bg&quot;</span><span class=p>]:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                    <span class=s2>&quot;Output definition has defined BG color input was&quot;</span>
                    <span class=s2>&quot; resolved as does not support adding BG.&quot;</span>
                <span class=p>))</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>bg_color_hex</span> <span class=o>=</span> <span class=s2>&quot;#</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span>
                <span class=p>)</span>
                <span class=n>bg_color_str</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>@</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bg_color_hex</span><span class=p>,</span> <span class=n>bg_alpha</span><span class=p>)</span>

                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Applying BG color </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bg_color_str</span><span class=p>))</span>
                <span class=n>color_args</span> <span class=o>=</span> <span class=p>[</span>
                    <span class=s2>&quot;split=2[bg][fg]&quot;</span><span class=p>,</span>
                    <span class=s2>&quot;[bg]drawbox=c=</span><span class=si>{}</span><span class=s2>:replace=1:t=fill[bg]&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                        <span class=n>bg_color_str</span>
                    <span class=p>),</span>
                    <span class=s2>&quot;[bg][fg]overlay=format=auto&quot;</span>
                <span class=p>]</span>
                <span class=c1># Prepend bg color change before all video filters</span>
                <span class=c1># NOTE at the time of creation it is required as video filters</span>
                <span class=c1>#   from settings may affect color of BG</span>
                <span class=c1>#   e.g. `eq` can remove alpha from input</span>
                <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>color_args</span><span class=p>):</span>
                    <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>arg</span><span class=p>)</span>

        <span class=c1># Add argument to override output file</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-y&quot;</span><span class=p>)</span>

        <span class=c1># NOTE This must be latest added item to output arguments.</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_output_path&quot;</span><span class=p>])</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>ffmpeg_full_args</span><span class=p>(</span>
            <span class=n>ffmpeg_input_args</span><span class=p>,</span>
            <span class=n>ffmpeg_video_filters</span><span class=p>,</span>
            <span class=n>ffmpeg_audio_filters</span><span class=p>,</span>
            <span class=n>ffmpeg_output_args</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>split_ffmpeg_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_args</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Makes sure all entered arguments are separated in individual items.</span>

<span class=sd>        Split each argument string with &quot; -&quot; to identify if string contains</span>
<span class=sd>        one or more arguments.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>splitted_args</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=n>in_args</span><span class=p>:</span>
            <span class=n>sub_args</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; -&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sub_args</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>arg</span> <span class=ow>and</span> <span class=n>arg</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>splitted_args</span><span class=p>:</span>
                    <span class=n>splitted_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>sub_args</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>idx</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=n>arg</span> <span class=o>=</span> <span class=s2>&quot;-&quot;</span> <span class=o>+</span> <span class=n>arg</span>

                <span class=k>if</span> <span class=n>arg</span> <span class=ow>and</span> <span class=n>arg</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>splitted_args</span><span class=p>:</span>
                    <span class=n>splitted_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>splitted_args</span>

    <span class=k>def</span><span class=w> </span><span class=nf>ffmpeg_full_args</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>input_args</span><span class=p>,</span> <span class=n>video_filters</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>output_args</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Post processing of collected FFmpeg arguments.</span>

<span class=sd>        Just verify that output arguments does not contain video or audio</span>
<span class=sd>        filters which may cause issues because of duplicated argument entry.</span>
<span class=sd>        Filters found in output arguments are moved to list they belong to.</span>

<span class=sd>        Args:</span>
<span class=sd>            input_args (list): All collected ffmpeg arguments with inputs.</span>
<span class=sd>            video_filters (list): All collected video filters.</span>
<span class=sd>            audio_filters (list): All collected audio filters.</span>
<span class=sd>            output_args (list): All collected ffmpeg output arguments with</span>
<span class=sd>                output filepath.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list: Containing all arguments ready to run in subprocess.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>output_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>split_ffmpeg_args</span><span class=p>(</span><span class=n>output_args</span><span class=p>)</span>

        <span class=n>video_args_dentifiers</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;-vf&quot;</span><span class=p>,</span> <span class=s2>&quot;-filter:v&quot;</span><span class=p>]</span>
        <span class=n>audio_args_dentifiers</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;-af&quot;</span><span class=p>,</span> <span class=s2>&quot;-filter:a&quot;</span><span class=p>]</span>
        <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>output_args</span><span class=p>):</span>
            <span class=k>for</span> <span class=n>identifier</span> <span class=ow>in</span> <span class=n>video_args_dentifiers</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>arg</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>identifier</span><span class=p>)):</span>
                    <span class=n>output_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
                    <span class=n>arg</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
                    <span class=n>video_filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>

            <span class=k>for</span> <span class=n>identifier</span> <span class=ow>in</span> <span class=n>audio_args_dentifiers</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>arg</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>identifier</span><span class=p>)):</span>
                    <span class=n>output_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
                    <span class=n>arg</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
                    <span class=n>audio_filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>

        <span class=n>all_args</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>subprocess</span><span class=o>.</span><span class=n>list2cmdline</span><span class=p>(</span><span class=n>get_ffmpeg_tool_args</span><span class=p>(</span><span class=s2>&quot;ffmpeg&quot;</span><span class=p>))</span>
        <span class=p>]</span>
        <span class=n>all_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>input_args</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>video_filters</span><span class=p>:</span>
            <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter:v&quot;</span><span class=p>)</span>
            <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>video_filters</span><span class=p>)))</span>

        <span class=k>if</span> <span class=n>audio_filters</span><span class=p>:</span>
            <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter:a&quot;</span><span class=p>)</span>
            <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>audio_filters</span><span class=p>)))</span>

        <span class=n>all_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>output_args</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>all_args</span>

    <span class=k>def</span><span class=w> </span><span class=nf>fill_sequence_gaps</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>files</span><span class=p>,</span> <span class=n>staging_dir</span><span class=p>,</span> <span class=n>start_frame</span><span class=p>,</span> <span class=n>end_frame</span><span class=p>):</span>
        <span class=c1># type: (list, str, int, int) -&gt; list</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Fill missing files in sequence by duplicating existing ones.</span>

<span class=sd>        This will take nearest frame file and copy it with so as to fill</span>
<span class=sd>        gaps in sequence. Last existing file there is is used to for the</span>
<span class=sd>        hole ahead.</span>

<span class=sd>        Args:</span>
<span class=sd>            files (list): List of representation files.</span>
<span class=sd>            staging_dir (str): Path to staging directory.</span>
<span class=sd>            start_frame (int): Sequence start (no matter what files are there)</span>
<span class=sd>            end_frame (int): Sequence end (no matter what files are there)</span>

<span class=sd>        Returns:</span>
<span class=sd>            list of added files. Those should be cleaned after work</span>
<span class=sd>                is done.</span>

<span class=sd>        Raises:</span>
<span class=sd>            KnownPublishError: if more than one collection is obtained.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>collections</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>files</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>collections</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>KnownPublishError</span><span class=p>(</span>
                <span class=s2>&quot;Multiple collections </span><span class=si>{}</span><span class=s2> found.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>collections</span><span class=p>))</span>

        <span class=n>col</span> <span class=o>=</span> <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

        <span class=c1># Prepare which hole is filled with what frame</span>
        <span class=c1>#   - the frame is filled only with already existing frames</span>
        <span class=n>prev_frame</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>col</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>
        <span class=n>hole_frame_to_nearest</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>start_frame</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>end_frame</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>frame</span> <span class=ow>in</span> <span class=n>col</span><span class=o>.</span><span class=n>indexes</span><span class=p>:</span>
                <span class=n>prev_frame</span> <span class=o>=</span> <span class=n>frame</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># Use previous frame as source for hole</span>
                <span class=n>hole_frame_to_nearest</span><span class=p>[</span><span class=n>frame</span><span class=p>]</span> <span class=o>=</span> <span class=n>prev_frame</span>

        <span class=c1># Calculate paths</span>
        <span class=n>added_files</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>col_format</span> <span class=o>=</span> <span class=n>col</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>hole_frame</span><span class=p>,</span> <span class=n>src_frame</span> <span class=ow>in</span> <span class=n>hole_frame_to_nearest</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>hole_fpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>col_format</span> <span class=o>%</span> <span class=n>hole_frame</span><span class=p>)</span>
            <span class=n>src_fpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>col_format</span> <span class=o>%</span> <span class=n>src_frame</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>):</span>
                <span class=k>raise</span> <span class=n>KnownPublishError</span><span class=p>(</span>
                    <span class=s2>&quot;Missing previously detected file: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>))</span>

            <span class=n>speedcopy</span><span class=o>.</span><span class=n>copyfile</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>,</span> <span class=n>hole_fpath</span><span class=p>)</span>
            <span class=n>added_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>hole_fpath</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>added_files</span>

    <span class=k>def</span><span class=w> </span><span class=nf>input_output_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Deduce input nad output file paths based on entered data.</span>

<span class=sd>        Input may be sequence of images, video file or single image file and</span>
<span class=sd>        same can be said about output, this method helps to find out what</span>
<span class=sd>        their paths are.</span>

<span class=sd>        It is validated that output directory exist and creates if not.</span>

<span class=sd>        During process are set &quot;files&quot;, &quot;stagingDir&quot;, &quot;ext&quot; and</span>
<span class=sd>        &quot;sequence_file&quot; (if output is sequence) keys to new representation.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>repre</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;origin_repre&quot;</span><span class=p>]</span>
        <span class=n>src_staging_dir</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span>
        <span class=n>dst_staging_dir</span> <span class=o>=</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
            <span class=n>collections</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
            <span class=n>full_input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>src_staging_dir</span><span class=p>,</span>
                <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=p>)</span>

            <span class=n>filename</span> <span class=o>=</span> <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>):</span>
                <span class=n>filename</span> <span class=o>=</span> <span class=n>filename</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

            <span class=c1># Make sure to have full path to one input file</span>
            <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>src_staging_dir</span><span class=p>,</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
            <span class=p>)</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>full_input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>src_staging_dir</span><span class=p>,</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>

            <span class=c1># Make sure to have full path to one input file</span>
            <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>full_input_path</span>

        <span class=n>filename_suffix</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span>

        <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;ext&quot;</span><span class=p>)</span>
        <span class=c1># Use input extension if output definition do not specify it</span>
        <span class=k>if</span> <span class=n>output_ext</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>output_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>full_input_path</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>

        <span class=c1># TODO Define if extension should have dot or not</span>
        <span class=k>if</span> <span class=n>output_ext</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>):</span>
            <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>

        <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_ext</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>

        <span class=c1># Store extension to representation</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;ext&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_ext</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;New representation ext: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_ext</span><span class=p>))</span>

        <span class=c1># Output is image file sequence with frames</span>
        <span class=n>output_ext_is_image</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>output_ext</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>image_exts</span><span class=p>)</span>
        <span class=n>output_is_sequence</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span>
            <span class=n>output_ext_is_image</span>
            <span class=ow>and</span> <span class=s2>&quot;sequence&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>output_is_sequence</span><span class=p>:</span>
            <span class=n>new_repre_files</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=n>frame_start</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>]</span>
            <span class=n>frame_end</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_end&quot;</span><span class=p>]</span>

            <span class=n>filename_base</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>_</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>filename_suffix</span><span class=p>)</span>
            <span class=c1># Temporary template for frame filling. Example output:</span>
            <span class=c1># &quot;basename.%04d.exr&quot; when `frame_end` == 1001</span>
            <span class=n>repr_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.%</span><span class=si>{:0&gt;2}</span><span class=s2>d.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>filename_base</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>frame_end</span><span class=p>)),</span> <span class=n>output_ext</span>
            <span class=p>)</span>

            <span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>frame_start</span><span class=p>,</span> <span class=n>frame_end</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
                <span class=n>new_repre_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repr_file</span> <span class=o>%</span> <span class=n>frame</span><span class=p>)</span>

            <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;sequence_file&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>repr_file</span>
            <span class=n>full_output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>dst_staging_dir</span><span class=p>,</span> <span class=n>filename_base</span><span class=p>,</span> <span class=n>repr_file</span>
            <span class=p>)</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>repr_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>_</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>filename</span><span class=p>,</span> <span class=n>filename_suffix</span><span class=p>,</span> <span class=n>output_ext</span>
            <span class=p>)</span>
            <span class=n>full_output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>,</span> <span class=n>repr_file</span><span class=p>)</span>
            <span class=n>new_repre_files</span> <span class=o>=</span> <span class=n>repr_file</span>

        <span class=c1># Store files to representation</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_repre_files</span>

        <span class=c1># Make sure stagingDire exists</span>
        <span class=n>dst_staging_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>full_output_path</span><span class=p>))</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Creating dir: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>))</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>)</span>

        <span class=c1># Store stagingDir to representation</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dst_staging_dir</span>

        <span class=c1># Store paths to temp data</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_input_path</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path_single_file&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_input_path_single_file</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_output_path&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_output_path</span>

        <span class=c1># Store information about output</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_ext_is_image</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_is_sequence</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Input path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Output path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_output_path</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>audio_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>duration_seconds</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Prepares FFMpeg arguments for audio inputs.&quot;&quot;&quot;</span>
        <span class=n>audio_in_args</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>audio_filters</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>audio_out_args</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>audio_inputs</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>audio_inputs</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span>

        <span class=k>for</span> <span class=n>audio</span> <span class=ow>in</span> <span class=n>audio_inputs</span><span class=p>:</span>
            <span class=c1># NOTE modified, always was expected &quot;frameStartFtrack&quot; which is</span>
            <span class=c1># STRANGE?!!! There should be different key, right?</span>
            <span class=c1># TODO use different frame start!</span>
            <span class=n>offset_seconds</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=n>frame_start_ftrack</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;frameStartFtrack&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>frame_start_ftrack</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>offset_frames</span> <span class=o>=</span> <span class=n>frame_start_ftrack</span> <span class=o>-</span> <span class=n>audio</span><span class=p>[</span><span class=s2>&quot;offset&quot;</span><span class=p>]</span>
                <span class=n>offset_seconds</span> <span class=o>=</span> <span class=n>offset_frames</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]</span>

            <span class=k>if</span> <span class=n>offset_seconds</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                    <span class=s2>&quot;-ss </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>offset_seconds</span><span class=p>)</span>
                <span class=p>)</span>

            <span class=k>elif</span> <span class=n>offset_seconds</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                    <span class=s2>&quot;-itsoffset </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>offset_seconds</span><span class=p>))</span>
                <span class=p>)</span>

            <span class=c1># Audio duration is offset from `-ss`</span>
            <span class=n>audio_duration</span> <span class=o>=</span> <span class=n>duration_seconds</span> <span class=o>+</span> <span class=n>offset_seconds</span>

            <span class=c1># Set audio duration</span>
            <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-to </span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>audio_duration</span><span class=p>))</span>

            <span class=c1># Ignore video data from audio input</span>
            <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-vn&quot;</span><span class=p>)</span>

            <span class=c1># Add audio input path</span>
            <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-i </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>audio</span><span class=p>[</span><span class=s2>&quot;filename&quot;</span><span class=p>])</span>
            <span class=p>))</span>

        <span class=c1># NOTE: These were changed from input to output arguments.</span>
        <span class=c1># NOTE: value in &quot;-ac&quot; was hardcoded to 2, changed to audio inputs len.</span>
        <span class=c1># Need to merge audio if there are more than 1 input.</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>audio_inputs</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>audio_out_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter_complex amerge&quot;</span><span class=p>)</span>
            <span class=n>audio_out_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-ac </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>audio_inputs</span><span class=p>)))</span>

        <span class=k>return</span> <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_letterbox_filters</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>letter_box_def</span><span class=p>,</span>
        <span class=n>output_width</span><span class=p>,</span>
        <span class=n>output_height</span>
    <span class=p>):</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=n>ratio</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;ratio&quot;</span><span class=p>]</span>
        <span class=n>fill_color</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;fill_color&quot;</span><span class=p>]</span>
        <span class=n>f_red</span><span class=p>,</span> <span class=n>f_green</span><span class=p>,</span> <span class=n>f_blue</span><span class=p>,</span> <span class=n>f_alpha</span> <span class=o>=</span> <span class=n>fill_color</span>
        <span class=n>fill_color_hex</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>f_red</span><span class=p>,</span> <span class=n>f_green</span><span class=p>,</span> <span class=n>f_blue</span>
        <span class=p>)</span>
        <span class=n>fill_color_alpha</span> <span class=o>=</span> <span class=n>f_alpha</span>

        <span class=n>line_thickness</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;line_thickness&quot;</span><span class=p>]</span>
        <span class=n>line_color</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;line_color&quot;</span><span class=p>]</span>
        <span class=n>l_red</span><span class=p>,</span> <span class=n>l_green</span><span class=p>,</span> <span class=n>l_blue</span><span class=p>,</span> <span class=n>l_alpha</span> <span class=o>=</span> <span class=n>line_color</span>
        <span class=n>line_color_hex</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>l_red</span><span class=p>,</span> <span class=n>l_green</span><span class=p>,</span> <span class=n>l_blue</span>
        <span class=p>)</span>
        <span class=n>line_color_alpha</span> <span class=o>=</span> <span class=n>l_alpha</span>

        <span class=c1># test ratios and define if pillar or letter boxes</span>
        <span class=n>output_ratio</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>output_width</span><span class=p>)</span> <span class=o>/</span> <span class=nb>float</span><span class=p>(</span><span class=n>output_height</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Output ratio: </span><span class=si>{}</span><span class=s2> LetterBox ratio: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>output_ratio</span><span class=p>,</span> <span class=n>ratio</span>
        <span class=p>))</span>
        <span class=n>pillar</span> <span class=o>=</span> <span class=n>output_ratio</span> <span class=o>&gt;</span> <span class=n>ratio</span>
        <span class=n>need_mask</span> <span class=o>=</span> <span class=nb>format</span><span class=p>(</span><span class=n>output_ratio</span><span class=p>,</span> <span class=s2>&quot;.3f&quot;</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>format</span><span class=p>(</span><span class=n>ratio</span><span class=p>,</span> <span class=s2>&quot;.3f&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>need_mask</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>[]</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>pillar</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>fill_color_alpha</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>top_box</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=0:0:</span><span class=si>{width}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:round((</span><span class=si>{height}</span><span class=s2>-(</span><span class=si>{width}</span><span class=s2>/</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:t=fill:c=</span><span class=si>{color}</span><span class=s2>@</span><span class=si>{alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>color</span><span class=o>=</span><span class=n>fill_color_hex</span><span class=p>,</span>
                    <span class=n>alpha</span><span class=o>=</span><span class=n>fill_color_alpha</span>
                <span class=p>)</span>

                <span class=n>bottom_box</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=0&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{height}</span><span class=s2>-round((</span><span class=si>{height}</span><span class=s2>-(</span><span class=si>{width}</span><span class=s2>/</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{width}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:round((</span><span class=si>{height}</span><span class=s2>-(</span><span class=si>{width}</span><span class=s2>/</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:t=fill:c=</span><span class=si>{color}</span><span class=s2>@</span><span class=si>{alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>color</span><span class=o>=</span><span class=n>fill_color_hex</span><span class=p>,</span>
                    <span class=n>alpha</span><span class=o>=</span><span class=n>fill_color_alpha</span>
                <span class=p>)</span>
                <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>top_box</span><span class=p>,</span> <span class=n>bottom_box</span><span class=p>])</span>

            <span class=k>if</span> <span class=n>line_color_alpha</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>line_thickness</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>top_line</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=0&quot;</span>
                    <span class=s2>&quot;:round((</span><span class=si>{height}</span><span class=s2>-(</span><span class=si>{width}</span><span class=s2>/</span><span class=si>{ratio}</span><span class=s2>))/2)-</span><span class=si>{l_thick}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{width}</span><span class=s2>:</span><span class=si>{l_thick}</span><span class=s2>:t=fill:c=</span><span class=si>{l_color}</span><span class=s2>@</span><span class=si>{l_alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>l_thick</span><span class=o>=</span><span class=n>line_thickness</span><span class=p>,</span>
                    <span class=n>l_color</span><span class=o>=</span><span class=n>line_color_hex</span><span class=p>,</span>
                    <span class=n>l_alpha</span><span class=o>=</span><span class=n>line_color_alpha</span>
                <span class=p>)</span>
                <span class=n>bottom_line</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=0&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{height}</span><span class=s2>-round((</span><span class=si>{height}</span><span class=s2>-(</span><span class=si>{width}</span><span class=s2>/</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{width}</span><span class=s2>:</span><span class=si>{l_thick}</span><span class=s2>:t=fill:c=</span><span class=si>{l_color}</span><span class=s2>@</span><span class=si>{l_alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>l_thick</span><span class=o>=</span><span class=n>line_thickness</span><span class=p>,</span>
                    <span class=n>l_color</span><span class=o>=</span><span class=n>line_color_hex</span><span class=p>,</span>
                    <span class=n>l_alpha</span><span class=o>=</span><span class=n>line_color_alpha</span>
                <span class=p>)</span>
                <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>top_line</span><span class=p>,</span> <span class=n>bottom_line</span><span class=p>])</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>fill_color_alpha</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>left_box</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=0:0&quot;</span>
                    <span class=s2>&quot;:round((</span><span class=si>{width}</span><span class=s2>-(</span><span class=si>{height}</span><span class=s2>*</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{height}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:t=fill:c=</span><span class=si>{color}</span><span class=s2>@</span><span class=si>{alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>color</span><span class=o>=</span><span class=n>fill_color_hex</span><span class=p>,</span>
                    <span class=n>alpha</span><span class=o>=</span><span class=n>fill_color_alpha</span>
                <span class=p>)</span>

                <span class=n>right_box</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=&quot;</span>
                    <span class=s2>&quot;</span><span class=si>{width}</span><span class=s2>-round((</span><span class=si>{width}</span><span class=s2>-(</span><span class=si>{height}</span><span class=s2>*</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:0&quot;</span>
                    <span class=s2>&quot;:round((</span><span class=si>{width}</span><span class=s2>-(</span><span class=si>{height}</span><span class=s2>*</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:</span><span class=si>{height}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:t=fill:c=</span><span class=si>{color}</span><span class=s2>@</span><span class=si>{alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>color</span><span class=o>=</span><span class=n>fill_color_hex</span><span class=p>,</span>
                    <span class=n>alpha</span><span class=o>=</span><span class=n>fill_color_alpha</span>
                <span class=p>)</span>
                <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>left_box</span><span class=p>,</span> <span class=n>right_box</span><span class=p>])</span>

            <span class=k>if</span> <span class=n>line_color_alpha</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>line_thickness</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>left_line</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=round((</span><span class=si>{width}</span><span class=s2>-(</span><span class=si>{height}</span><span class=s2>*</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:0:</span><span class=si>{l_thick}</span><span class=s2>:</span><span class=si>{height}</span><span class=s2>:t=fill:c=</span><span class=si>{l_color}</span><span class=s2>@</span><span class=si>{l_alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>l_thick</span><span class=o>=</span><span class=n>line_thickness</span><span class=p>,</span>
                    <span class=n>l_color</span><span class=o>=</span><span class=n>line_color_hex</span><span class=p>,</span>
                    <span class=n>l_alpha</span><span class=o>=</span><span class=n>line_color_alpha</span>
                <span class=p>)</span>

                <span class=n>right_line</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;drawbox=</span><span class=si>{width}</span><span class=s2>-round((</span><span class=si>{width}</span><span class=s2>-(</span><span class=si>{height}</span><span class=s2>*</span><span class=si>{ratio}</span><span class=s2>))/2)&quot;</span>
                    <span class=s2>&quot;:0:</span><span class=si>{l_thick}</span><span class=s2>:</span><span class=si>{height}</span><span class=s2>:t=fill:c=</span><span class=si>{l_color}</span><span class=s2>@</span><span class=si>{l_alpha}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=o>=</span><span class=n>output_width</span><span class=p>,</span>
                    <span class=n>height</span><span class=o>=</span><span class=n>output_height</span><span class=p>,</span>
                    <span class=n>ratio</span><span class=o>=</span><span class=n>ratio</span><span class=p>,</span>
                    <span class=n>l_thick</span><span class=o>=</span><span class=n>line_thickness</span><span class=p>,</span>
                    <span class=n>l_color</span><span class=o>=</span><span class=n>line_color_hex</span><span class=p>,</span>
                    <span class=n>l_alpha</span><span class=o>=</span><span class=n>line_color_alpha</span>
                <span class=p>)</span>
                <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>left_line</span><span class=p>,</span> <span class=n>right_line</span><span class=p>])</span>

        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>rescaling_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Prepare vieo filters based on tags in new representation.</span>

<span class=sd>        It is possible to add letterboxes to output video or rescale to</span>
<span class=sd>        different resolution.</span>

<span class=sd>        During this preparation &quot;resolutionWidth&quot; and &quot;resolutionHeight&quot; are</span>
<span class=sd>        set to new representation.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>filters</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=c1># if reformat input video file is already reforamted from upstream</span>
        <span class=n>reformat_in_baking</span> <span class=o>=</span> <span class=p>(</span>
            <span class=s2>&quot;reformatted&quot;</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
            <span class=c1># Backwards compatibility</span>
            <span class=ow>or</span> <span class=s2>&quot;reformated&quot;</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;reformat_in_baking: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>reformat_in_baking</span><span class=p>))</span>

        <span class=c1># NOTE Skipped using instance&#39;s resolution</span>
        <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path_single_file&quot;</span><span class=p>]</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>streams</span> <span class=o>=</span> <span class=n>get_ffprobe_streams</span><span class=p>(</span>
                <span class=n>full_input_path_single_file</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
            <span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>AssertionError</span><span class=p>((</span>
                <span class=s2>&quot;FFprobe couldn&#39;t read information about input file: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>.&quot;</span>
                <span class=s2>&quot; Error message: </span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path_single_file</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)))</span>

        <span class=c1># Try to find first stream with defined &#39;width&#39; and &#39;height&#39;</span>
        <span class=c1># - this is to avoid order of streams where audio can be as first</span>
        <span class=c1># - there may be a better way (checking `codec_type`?)</span>
        <span class=n>input_width</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>input_height</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>output_width</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>for</span> <span class=n>stream</span> <span class=ow>in</span> <span class=n>streams</span><span class=p>:</span>
            <span class=k>if</span> <span class=s2>&quot;width&quot;</span> <span class=ow>in</span> <span class=n>stream</span> <span class=ow>and</span> <span class=s2>&quot;height&quot;</span> <span class=ow>in</span> <span class=n>stream</span><span class=p>:</span>
                <span class=n>input_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>stream</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>])</span>
                <span class=n>input_height</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>stream</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>])</span>
                <span class=k>break</span>

        <span class=c1># Get instance data</span>
        <span class=n>pixel_aspect</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;pixel_aspect&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>reformat_in_baking</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
                <span class=s2>&quot;Using resolution from input. It is already &quot;</span>
                <span class=s2>&quot;reformatted from upstream process&quot;</span>
            <span class=p>))</span>
            <span class=n>pixel_aspect</span> <span class=o>=</span> <span class=mi>1</span>
            <span class=n>output_width</span> <span class=o>=</span> <span class=n>input_width</span>
            <span class=n>output_height</span> <span class=o>=</span> <span class=n>input_height</span>

        <span class=c1># Raise exception of any stream didn&#39;t define input resolution</span>
        <span class=k>if</span> <span class=n>input_width</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>AssertionError</span><span class=p>((</span>
                <span class=s2>&quot;FFprobe couldn&#39;t read resolution from input file: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path_single_file</span><span class=p>))</span>

        <span class=c1># NOTE Setting only one of `width` or `height` is not allowed</span>
        <span class=c1># - settings value can&#39;t have None but has value of 0</span>
        <span class=n>output_width</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>]</span> <span class=ow>or</span> <span class=n>output_width</span> <span class=ow>or</span> <span class=kc>None</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>]</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>or</span> <span class=kc>None</span>

        <span class=c1># Force to use input resolution if output resolution was not defined</span>
        <span class=c1>#   in settings. Resolution from instance is not used when</span>
        <span class=c1>#   &#39;use_input_res&#39; is set to &#39;True&#39;.</span>
        <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=c1># Overscan color</span>
        <span class=n>overscan_color_value</span> <span class=o>=</span> <span class=s2>&quot;black&quot;</span>
        <span class=n>overscan_color</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;overscan_color&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>overscan_color</span><span class=p>:</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>overscan_color</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
                <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span> <span class=o>=</span> <span class=n>overscan_color</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># Backwards compatibility</span>
                <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span><span class=p>,</span> <span class=n>_</span>  <span class=o>=</span> <span class=n>overscan_color</span>

            <span class=n>overscan_color_value</span> <span class=o>=</span> <span class=s2>&quot;#</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span>
            <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Overscan color: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>overscan_color_value</span><span class=p>))</span>

        <span class=c1># Scale input to have proper pixel aspect ratio</span>
        <span class=c1># - scale width by the pixel aspect ratio</span>
        <span class=n>scale_pixel_aspect</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;scale_pixel_aspect&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>scale_pixel_aspect</span> <span class=ow>and</span> <span class=n>pixel_aspect</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
            <span class=c1># Change input width after pixel aspect</span>
            <span class=n>input_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>input_width</span> <span class=o>*</span> <span class=n>pixel_aspect</span><span class=p>)</span>
            <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>((</span>
                <span class=s2>&quot;scale=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>:flags=lanczos&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>,</span> <span class=n>input_height</span><span class=p>)</span>
            <span class=p>))</span>

        <span class=c1># Convert overscan value video filters</span>
        <span class=n>overscan_crop</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;overscan_crop&quot;</span><span class=p>)</span>
        <span class=n>overscan</span> <span class=o>=</span> <span class=n>OverscanCrop</span><span class=p>(</span>
            <span class=n>input_width</span><span class=p>,</span> <span class=n>input_height</span><span class=p>,</span> <span class=n>overscan_crop</span><span class=p>,</span> <span class=n>overscan_color_value</span>
        <span class=p>)</span>
        <span class=n>overscan_crop_filters</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>video_filters</span><span class=p>()</span>
        <span class=c1># Add overscan filters to filters if are any and modify input</span>
        <span class=c1>#   resolution by it&#39;s values</span>
        <span class=k>if</span> <span class=n>overscan_crop_filters</span><span class=p>:</span>
            <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>overscan_crop_filters</span><span class=p>)</span>
            <span class=c1># Change input resolution after overscan crop</span>
            <span class=n>input_width</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>width</span><span class=p>()</span>
            <span class=n>input_height</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>height</span><span class=p>()</span>
            <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=c1># Make sure input width and height is not an odd number</span>
        <span class=n>input_width_is_odd</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>input_width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
        <span class=n>input_height_is_odd</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>input_height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>input_width_is_odd</span> <span class=ow>or</span> <span class=n>input_height_is_odd</span><span class=p>:</span>
            <span class=c1># Add padding to input and make sure this filter is at first place</span>
            <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=width=ceil(iw/2)*2:height=ceil(ih/2)*2&quot;</span><span class=p>)</span>

            <span class=c1># Change input width or height as first filter will change them</span>
            <span class=k>if</span> <span class=n>input_width_is_odd</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                    <span class=s2>&quot;Converting input width from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>,</span> <span class=n>input_width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
                <span class=n>input_width</span> <span class=o>+=</span> <span class=mi>1</span>

            <span class=k>if</span> <span class=n>input_height_is_odd</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                    <span class=s2>&quot;Converting input height from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_height</span><span class=p>,</span> <span class=n>input_height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
                <span class=n>input_height</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;pixel_aspect: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>pixel_aspect</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;input_width: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;input_height: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_height</span><span class=p>))</span>

        <span class=c1># Use instance resolution if output definition has not set it</span>
        <span class=c1>#   - use instance resolution only if there were not scale changes</span>
        <span class=c1>#       that may massivelly affect output &#39;use_input_res&#39;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>use_input_res</span> <span class=ow>and</span> <span class=n>output_width</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>output_width</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;resolution_width&quot;</span><span class=p>]</span>
            <span class=n>output_height</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;resolution_height&quot;</span><span class=p>]</span>

        <span class=c1># Use source&#39;s input resolution instance does not have set it.</span>
        <span class=k>if</span> <span class=n>output_width</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Using resolution from input.&quot;</span><span class=p>)</span>
            <span class=n>output_width</span> <span class=o>=</span> <span class=n>input_width</span>
            <span class=n>output_height</span> <span class=o>=</span> <span class=n>input_height</span>

        <span class=n>output_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_width</span><span class=p>)</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_height</span><span class=p>)</span>

        <span class=c1># Make sure output width and height is not an odd number</span>
        <span class=c1># When this can happen:</span>
        <span class=c1># - if output definition has set width and height with odd number</span>
        <span class=c1># - `instance.data` contain width and height with odd number</span>
        <span class=k>if</span> <span class=n>output_width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
                <span class=s2>&quot;Converting output width from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
            <span class=n>output_width</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=n>output_height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
                <span class=s2>&quot;Converting output height from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_height</span><span class=p>,</span> <span class=n>output_height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
            <span class=n>output_height</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
            <span class=s2>&quot;Output resolution is </span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>letter_box_def</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;letter_box&quot;</span><span class=p>]</span>
        <span class=n>letter_box_enabled</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>

        <span class=c1># Skip processing if resolution is same as input&#39;s and letterbox is</span>
        <span class=c1># not set</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>output_width</span> <span class=o>==</span> <span class=n>input_width</span>
            <span class=ow>and</span> <span class=n>output_height</span> <span class=o>==</span> <span class=n>input_height</span>
            <span class=ow>and</span> <span class=ow>not</span> <span class=n>letter_box_enabled</span>
        <span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Output resolution is same as input&#39;s&quot;</span>
                <span class=s2>&quot; and </span><span class=se>\&quot;</span><span class=s2>letter_box</span><span class=se>\&quot;</span><span class=s2> key is not set. Skipping reformat part.&quot;</span>
            <span class=p>)</span>
            <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>input_width</span>
            <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>input_height</span>
            <span class=k>return</span> <span class=n>filters</span>

        <span class=c1># scaling none square pixels and 1920 width</span>
        <span class=k>if</span> <span class=n>input_height</span> <span class=o>!=</span> <span class=n>output_height</span> <span class=ow>or</span> <span class=n>input_width</span> <span class=o>!=</span> <span class=n>output_width</span><span class=p>:</span>
            <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=p>(</span>
                    <span class=s2>&quot;scale=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span>
                    <span class=s2>&quot;:flags=lanczos&quot;</span>
                    <span class=s2>&quot;:force_original_aspect_ratio=decrease&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>),</span>
                <span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>:(ow-iw)/2:(oh-ih)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>,</span>
                    <span class=n>overscan_color_value</span>
                <span class=p>),</span>
                <span class=s2>&quot;setsar=1&quot;</span>
            <span class=p>])</span>

        <span class=c1># letter_box</span>
        <span class=k>if</span> <span class=n>letter_box_enabled</span><span class=p>:</span>
            <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>get_letterbox_filters</span><span class=p>(</span>
                    <span class=n>letter_box_def</span><span class=p>,</span>
                    <span class=n>output_width</span><span class=p>,</span>
                    <span class=n>output_height</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_width</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_height</span>

        <span class=k>return</span> <span class=n>filters</span>

    <span class=k>def</span><span class=w> </span><span class=nf>lut_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>input_args</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Add lut file to output ffmpeg filters.&quot;&quot;&quot;</span>
        <span class=n>filters</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=c1># baking lut file application</span>
        <span class=n>lut_path</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;lutPath&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>lut_path</span> <span class=ow>or</span> <span class=s2>&quot;bake-lut&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]:</span>
            <span class=k>return</span> <span class=n>filters</span>

        <span class=c1># Prepare path for ffmpeg argument</span>
        <span class=n>lut_path</span> <span class=o>=</span> <span class=n>lut_path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;/&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\\</span><span class=s2>:&quot;</span><span class=p>)</span>

        <span class=c1># Remove gamma from input arguments</span>
        <span class=k>if</span> <span class=s2>&quot;-gamma&quot;</span> <span class=ow>in</span> <span class=n>input_args</span><span class=p>:</span>
            <span class=n>input_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;-gamme&quot;</span><span class=p>)</span>

        <span class=c1># Prepare filters</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;lut3d=file=&#39;</span><span class=si>{}</span><span class=s2>&#39;&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>lut_path</span><span class=p>))</span>
        <span class=c1># QUESTION hardcoded colormatrix?</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;colormatrix=bt601:bt709&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Added Lut to ffmpeg command.&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>filters</span>

    <span class=k>def</span><span class=w> </span><span class=nf>families_from_instance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns all families of entered instance.&quot;&quot;&quot;</span>
        <span class=n>families</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>family</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>family</span><span class=p>:</span>
            <span class=n>families</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span> <span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>tuple</span><span class=p>()):</span>
            <span class=k>if</span> <span class=n>family</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>families</span><span class=p>:</span>
                <span class=n>families</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>families</span>

    <span class=k>def</span><span class=w> </span><span class=nf>families_filter_validation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>families</span><span class=p>,</span> <span class=n>output_families_filter</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Determines if entered families intersect with families filters.</span>

<span class=sd>        All family values are lowered to avoid unexpected results.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>families_filter_lower</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>family</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span>
                                    <span class=n>output_families_filter</span>
                                    <span class=c1># Exclude empty filter values</span>
                                    <span class=k>if</span> <span class=n>family</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>families_filter_lower</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=nb>any</span><span class=p>(</span><span class=n>family</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>families_filter_lower</span>
                   <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span> <span class=n>families</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>filter_output_defs</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>profile</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>families</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Return outputs matching input instance families.</span>

<span class=sd>        Output definitions without families filter are marked as valid.</span>

<span class=sd>        Args:</span>
<span class=sd>            profile (dict): Profile from presets matching current context.</span>
<span class=sd>            families (list): All families of current instance.</span>
<span class=sd>            product_name (str): Product name.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, Any]: Containing all output definitions matching entered</span>
<span class=sd>                families.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>filtered_outputs</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>outputs</span> <span class=o>=</span> <span class=n>profile</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;outputs&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>outputs</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>filtered_outputs</span>

        <span class=k>for</span> <span class=n>output_def</span> <span class=ow>in</span> <span class=n>outputs</span><span class=p>:</span>
            <span class=n>filename_suffix</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
            <span class=n>output_filters</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;filter&quot;</span><span class=p>)</span>
            <span class=c1># If no filter on output preset, skip filtering and add output</span>
            <span class=c1># profile for farther processing</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>output_filters</span><span class=p>:</span>
                <span class=n>filtered_outputs</span><span class=p>[</span><span class=n>filename_suffix</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_def</span>
                <span class=k>continue</span>

            <span class=n>families_filters</span> <span class=o>=</span> <span class=n>output_filters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>families_filter_validation</span><span class=p>(</span><span class=n>families</span><span class=p>,</span> <span class=n>families_filters</span><span class=p>):</span>
                <span class=k>continue</span>

            <span class=c1># Subsets name filters</span>
            <span class=n>product_name_filters</span> <span class=o>=</span> <span class=p>[</span>
                <span class=n>name_filter</span>
                <span class=k>for</span> <span class=n>name_filter</span> <span class=ow>in</span> <span class=n>output_filters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;product_names&quot;</span><span class=p>,</span> <span class=p>[])</span>
                <span class=c1># Skip empty strings</span>
                <span class=k>if</span> <span class=n>name_filter</span>
            <span class=p>]</span>
            <span class=k>if</span> <span class=n>product_name</span> <span class=ow>and</span> <span class=n>product_name_filters</span><span class=p>:</span>
                <span class=n>match</span> <span class=o>=</span> <span class=kc>False</span>
                <span class=k>for</span> <span class=n>product_name_filter</span> <span class=ow>in</span> <span class=n>product_name_filters</span><span class=p>:</span>
                    <span class=n>compiled</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>product_name_filter</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>compiled</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>product_name</span><span class=p>):</span>
                        <span class=n>match</span> <span class=o>=</span> <span class=kc>True</span>
                        <span class=k>break</span>

                <span class=k>if</span> <span class=ow>not</span> <span class=n>match</span><span class=p>:</span>
                    <span class=k>continue</span>

            <span class=n>filtered_outputs</span><span class=p>[</span><span class=n>filename_suffix</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_def</span>

        <span class=k>return</span> <span class=n>filtered_outputs</span>

    <span class=k>def</span><span class=w> </span><span class=nf>filter_outputs_by_custom_tags</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>outputs</span><span class=p>,</span> <span class=n>custom_tags</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Filter output definitions by entered representation custom_tags.</span>

<span class=sd>        Output definitions without custom_tags filter are marked as invalid,</span>
<span class=sd>        only in case representation is having any custom_tags defined.</span>

<span class=sd>        Args:</span>
<span class=sd>            outputs (list): Contain list of output definitions from presets.</span>
<span class=sd>            custom_tags (list): Custom Tags of processed representation.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list: Containing all output definitions matching entered tags.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>filtered_outputs</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>repre_c_tags_low</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=p>(</span><span class=n>custom_tags</span> <span class=ow>or</span> <span class=p>[])]</span>
        <span class=k>for</span> <span class=n>output_def</span> <span class=ow>in</span> <span class=n>outputs</span><span class=p>:</span>
            <span class=n>tag_filters</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;filter&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;custom_tags&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>custom_tags</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>tag_filters</span><span class=p>:</span>
                <span class=c1># Definition is valid if both tags are empty</span>
                <span class=n>valid</span> <span class=o>=</span> <span class=kc>True</span>

            <span class=k>elif</span> <span class=ow>not</span> <span class=n>custom_tags</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>tag_filters</span><span class=p>:</span>
                <span class=c1># Invalid if one is empty</span>
                <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>

            <span class=k>else</span><span class=p>:</span>
                <span class=c1># Check if output definition tags are in representation tags</span>
                <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>
                <span class=c1># lower all filter tags</span>
                <span class=n>tag_filters_low</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>tag_filters</span><span class=p>]</span>
                <span class=c1># check if any repre tag is not in filter tags</span>
                <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>repre_c_tags_low</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>tag_filters_low</span><span class=p>:</span>
                        <span class=n>valid</span> <span class=o>=</span> <span class=kc>True</span>
                        <span class=k>break</span>

            <span class=k>if</span> <span class=n>valid</span><span class=p>:</span>
                <span class=n>filtered_outputs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output_def</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;__ filtered_outputs: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=p>[</span><span class=n>_o</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>_o</span> <span class=ow>in</span> <span class=n>filtered_outputs</span><span class=p>]</span>
        <span class=p>))</span>

        <span class=k>return</span> <span class=n>filtered_outputs</span>

    <span class=k>def</span><span class=w> </span><span class=nf>add_video_filter_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>inserting_arg</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Fixing video filter arguments to be one long string</span>

<span class=sd>        Args:</span>
<span class=sd>            args (list): list of string arguments</span>
<span class=sd>            inserting_arg (str): string argument we want to add</span>
<span class=sd>                                 (without flag `-vf`)</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: long joined argument to be added back to list of arguments</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># find all video format settings</span>
        <span class=n>vf_settings</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>args</span>
                       <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;-filter:v&quot;</span><span class=p>,</span> <span class=s2>&quot;-vf&quot;</span><span class=p>]</span>
                       <span class=k>if</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>p</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_settings: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_settings</span><span class=p>))</span>

        <span class=c1># remove them from output args list</span>
        <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>vf_settings</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ remove p: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>p</span><span class=p>))</span>
            <span class=n>args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ args: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>))</span>

        <span class=c1># strip them from all flags</span>
        <span class=n>vf_fixed</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-vf &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-filter:v &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>vf_settings</span><span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_fixed: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>))</span>
        <span class=n>vf_fixed</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>inserting_arg</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_fixed: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>))</span>
        <span class=c1># create new video filter setting</span>
        <span class=n>vf_back</span> <span class=o>=</span> <span class=s2>&quot;-vf &quot;</span> <span class=o>+</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>vf_back</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview._ffmpeg_arguments class="doc doc-heading"> <code class="highlight language-python"><span class=n>_ffmpeg_arguments</span><span class=p>(</span><span class=n>output_def</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>fill_data</span><span class=p>,</span> <span class=n>layer_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Prepares ffmpeg arguments for expected extraction.</p> <p>Prepares input and output arguments based on output definition and input files.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>output_def</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Currently processed output definition.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>instance</code> </td> <td> <code><span title=Instance>Instance</span></code> </td> <td> <div class=doc-md-description> <p>Currently processed instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>new_repre</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Representation representing output of this process.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>temp_data</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Base data for successful process.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_ffmpeg_arguments</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>output_def</span><span class=p>,</span>
    <span class=n>instance</span><span class=p>,</span>
    <span class=n>new_repre</span><span class=p>,</span>
    <span class=n>temp_data</span><span class=p>,</span>
    <span class=n>fill_data</span><span class=p>,</span>
    <span class=n>layer_name</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prepares ffmpeg arguments for expected extraction.</span>

<span class=sd>    Prepares input and output arguments based on output definition and</span>
<span class=sd>    input files.</span>

<span class=sd>    Args:</span>
<span class=sd>        output_def (dict): Currently processed output definition.</span>
<span class=sd>        instance (Instance): Currently processed instance.</span>
<span class=sd>        new_repre (dict): Representation representing output of this</span>
<span class=sd>            process.</span>
<span class=sd>        temp_data (dict): Base data for successful process.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Get FFmpeg arguments from profile presets</span>
    <span class=n>out_def_ffmpeg_args</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;ffmpeg_args&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>

    <span class=n>_ffmpeg_input_args</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;input&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
    <span class=n>_ffmpeg_output_args</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;output&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
    <span class=n>_ffmpeg_video_filters</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;video_filters&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
    <span class=n>_ffmpeg_audio_filters</span> <span class=o>=</span> <span class=n>out_def_ffmpeg_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio_filters&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>

    <span class=c1># Cleanup empty strings</span>
    <span class=n>ffmpeg_input_args</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_input_args</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
    <span class=p>]</span>
    <span class=n>ffmpeg_video_filters</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_video_filters</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
    <span class=p>]</span>
    <span class=n>ffmpeg_audio_filters</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>value</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_audio_filters</span> <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=n>ffmpeg_output_args</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>_ffmpeg_output_args</span><span class=p>:</span>
        <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>value</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>fill_data</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Failed to format ffmpeg argument: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>value</span><span class=p>),</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=k>pass</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>

    <span class=c1># Prepare input and output filepaths</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>input_output_paths</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>)</span>

    <span class=c1># Set output frames len to 1 when output is single image</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span>
        <span class=ow>and</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]</span>
    <span class=p>):</span>
        <span class=n>output_frames_len</span> <span class=o>=</span> <span class=mi>1</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>output_frames_len</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_end&quot;</span><span class=p>]</span>
            <span class=o>-</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>]</span>
            <span class=o>+</span> <span class=mi>1</span>
        <span class=p>)</span>

    <span class=n>duration_seconds</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>output_frames_len</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>])</span>

    <span class=c1># Define which layer should be used</span>
    <span class=k>if</span> <span class=n>layer_name</span><span class=p>:</span>
        <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s2>&quot;-layer&quot;</span><span class=p>,</span> <span class=n>layer_name</span><span class=p>])</span>

    <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
        <span class=c1># Set start frame of input sequence (just frame in filename)</span>
        <span class=c1># - definition of input filepath</span>
        <span class=c1># - add handle start if output should be without handles</span>
        <span class=n>start_number</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;first_sequence_frame&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;without_handles&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handles_are_set&quot;</span><span class=p>]:</span>
            <span class=n>start_number</span> <span class=o>+=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handle_start&quot;</span><span class=p>]</span>
        <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>start_number</span><span class=p>)</span>
        <span class=p>])</span>

        <span class=c1># TODO add fps mapping `{fps: fraction}` ?</span>
        <span class=c1># - e.g.: {</span>
        <span class=c1>#     &quot;25&quot;: &quot;25/1&quot;,</span>
        <span class=c1>#     &quot;24&quot;: &quot;24/1&quot;,</span>
        <span class=c1>#     &quot;23.976&quot;: &quot;24000/1001&quot;</span>
        <span class=c1># }</span>
        <span class=c1># Add framerate to input when input is sequence</span>
        <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-framerate&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>])</span>
        <span class=p>])</span>
        <span class=c1># Add duration of an input sequence if output is video</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
            <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                <span class=s2>&quot;-to&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>duration_seconds</span><span class=p>)</span>
            <span class=p>])</span>

    <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
        <span class=c1># Set start frame of output sequence (just frame in filename)</span>
        <span class=c1># - this is definition of an output</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-start_number&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>])</span>
        <span class=p>])</span>

    <span class=c1># Change output&#39;s duration and start point if should not contain</span>
    <span class=c1># handles</span>
    <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;without_handles&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handles_are_set&quot;</span><span class=p>]:</span>
        <span class=c1># Set output duration in seconds</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-t&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>duration_seconds</span><span class=p>)</span>
        <span class=p>])</span>

        <span class=c1># Add -ss (start offset in seconds) if input is not sequence</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
            <span class=n>start_sec</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;handle_start&quot;</span><span class=p>])</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]</span>
            <span class=c1># Set start time without handles</span>
            <span class=c1># - Skip if start sec is 0.0</span>
            <span class=k>if</span> <span class=n>start_sec</span> <span class=o>&gt;</span> <span class=mf>0.0</span><span class=p>:</span>
                <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
                    <span class=s2>&quot;-ss&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>start_sec</span><span class=p>)</span>
                <span class=p>])</span>

    <span class=c1># Set frame range of output when input or output is sequence</span>
    <span class=k>elif</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]:</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=s2>&quot;-frames:v&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>output_frames_len</span><span class=p>)</span>
        <span class=p>])</span>

    <span class=c1># Add video/image input path</span>
    <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
        <span class=s2>&quot;-i&quot;</span><span class=p>,</span> <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path&quot;</span><span class=p>])</span>
    <span class=p>])</span>

    <span class=c1># Add audio arguments if there are any. Skipped when output are images.</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;with_audio&quot;</span><span class=p>]:</span>
        <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>audio_args</span><span class=p>(</span>
            <span class=n>instance</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>duration_seconds</span>
        <span class=p>)</span>
        <span class=n>ffmpeg_input_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_in_args</span><span class=p>)</span>
        <span class=n>ffmpeg_audio_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_filters</span><span class=p>)</span>
        <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>audio_out_args</span><span class=p>)</span>

    <span class=n>res_filters</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>rescaling_filters</span><span class=p>(</span><span class=n>temp_data</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>)</span>
    <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>res_filters</span><span class=p>)</span>

    <span class=n>ffmpeg_input_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>split_ffmpeg_args</span><span class=p>(</span><span class=n>ffmpeg_input_args</span><span class=p>)</span>

    <span class=n>lut_filters</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lut_filters</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>ffmpeg_input_args</span><span class=p>)</span>
    <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>lut_filters</span><span class=p>)</span>

    <span class=n>bg_alpha</span> <span class=o>=</span> <span class=mf>0.0</span>
    <span class=n>bg_color</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;bg_color&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>bg_color</span><span class=p>:</span>
        <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span><span class=p>,</span> <span class=n>bg_alpha</span> <span class=o>=</span> <span class=n>bg_color</span>

    <span class=k>if</span> <span class=n>bg_alpha</span> <span class=o>&gt;</span> <span class=mf>0.0</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_allow_bg&quot;</span><span class=p>]:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Output definition has defined BG color input was&quot;</span>
                <span class=s2>&quot; resolved as does not support adding BG.&quot;</span>
            <span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>bg_color_hex</span> <span class=o>=</span> <span class=s2>&quot;#</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span>
            <span class=p>)</span>
            <span class=n>bg_color_str</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>@</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bg_color_hex</span><span class=p>,</span> <span class=n>bg_alpha</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Applying BG color </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bg_color_str</span><span class=p>))</span>
            <span class=n>color_args</span> <span class=o>=</span> <span class=p>[</span>
                <span class=s2>&quot;split=2[bg][fg]&quot;</span><span class=p>,</span>
                <span class=s2>&quot;[bg]drawbox=c=</span><span class=si>{}</span><span class=s2>:replace=1:t=fill[bg]&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>bg_color_str</span>
                <span class=p>),</span>
                <span class=s2>&quot;[bg][fg]overlay=format=auto&quot;</span>
            <span class=p>]</span>
            <span class=c1># Prepend bg color change before all video filters</span>
            <span class=c1># NOTE at the time of creation it is required as video filters</span>
            <span class=c1>#   from settings may affect color of BG</span>
            <span class=c1>#   e.g. `eq` can remove alpha from input</span>
            <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>color_args</span><span class=p>):</span>
                <span class=n>ffmpeg_video_filters</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>arg</span><span class=p>)</span>

    <span class=c1># Add argument to override output file</span>
    <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-y&quot;</span><span class=p>)</span>

    <span class=c1># NOTE This must be latest added item to output arguments.</span>
    <span class=n>ffmpeg_output_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
        <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_output_path&quot;</span><span class=p>])</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>ffmpeg_full_args</span><span class=p>(</span>
        <span class=n>ffmpeg_input_args</span><span class=p>,</span>
        <span class=n>ffmpeg_video_filters</span><span class=p>,</span>
        <span class=n>ffmpeg_audio_filters</span><span class=p>,</span>
        <span class=n>ffmpeg_output_args</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.add_video_filter_args class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_video_filter_args</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>inserting_arg</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Fixing video filter arguments to be one long string</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>args</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>list of string arguments</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>inserting_arg</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>string argument we want to add (without flag <code>-vf</code>)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>long joined argument to be added back to list of arguments</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>add_video_filter_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>inserting_arg</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Fixing video filter arguments to be one long string</span>

<span class=sd>    Args:</span>
<span class=sd>        args (list): list of string arguments</span>
<span class=sd>        inserting_arg (str): string argument we want to add</span>
<span class=sd>                             (without flag `-vf`)</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: long joined argument to be added back to list of arguments</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># find all video format settings</span>
    <span class=n>vf_settings</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>args</span>
                   <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;-filter:v&quot;</span><span class=p>,</span> <span class=s2>&quot;-vf&quot;</span><span class=p>]</span>
                   <span class=k>if</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>p</span><span class=p>]</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_settings: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_settings</span><span class=p>))</span>

    <span class=c1># remove them from output args list</span>
    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>vf_settings</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ remove p: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>p</span><span class=p>))</span>
        <span class=n>args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ args: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>))</span>

    <span class=c1># strip them from all flags</span>
    <span class=n>vf_fixed</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-vf &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-filter:v &quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>vf_settings</span><span class=p>]</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_fixed: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>))</span>
    <span class=n>vf_fixed</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>inserting_arg</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;_ vf_fixed: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>))</span>
    <span class=c1># create new video filter setting</span>
    <span class=n>vf_back</span> <span class=o>=</span> <span class=s2>&quot;-vf &quot;</span> <span class=o>+</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>vf_fixed</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>vf_back</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.audio_args class="doc doc-heading"> <code class="highlight language-python"><span class=n>audio_args</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>duration_seconds</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Prepares FFMpeg arguments for audio inputs.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>audio_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>duration_seconds</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prepares FFMpeg arguments for audio inputs.&quot;&quot;&quot;</span>
    <span class=n>audio_in_args</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>audio_filters</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>audio_out_args</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>audio_inputs</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>audio_inputs</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span>

    <span class=k>for</span> <span class=n>audio</span> <span class=ow>in</span> <span class=n>audio_inputs</span><span class=p>:</span>
        <span class=c1># NOTE modified, always was expected &quot;frameStartFtrack&quot; which is</span>
        <span class=c1># STRANGE?!!! There should be different key, right?</span>
        <span class=c1># TODO use different frame start!</span>
        <span class=n>offset_seconds</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>frame_start_ftrack</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;frameStartFtrack&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>frame_start_ftrack</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>offset_frames</span> <span class=o>=</span> <span class=n>frame_start_ftrack</span> <span class=o>-</span> <span class=n>audio</span><span class=p>[</span><span class=s2>&quot;offset&quot;</span><span class=p>]</span>
            <span class=n>offset_seconds</span> <span class=o>=</span> <span class=n>offset_frames</span> <span class=o>/</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>offset_seconds</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=s2>&quot;-ss </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>offset_seconds</span><span class=p>)</span>
            <span class=p>)</span>

        <span class=k>elif</span> <span class=n>offset_seconds</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=s2>&quot;-itsoffset </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>offset_seconds</span><span class=p>))</span>
            <span class=p>)</span>

        <span class=c1># Audio duration is offset from `-ss`</span>
        <span class=n>audio_duration</span> <span class=o>=</span> <span class=n>duration_seconds</span> <span class=o>+</span> <span class=n>offset_seconds</span>

        <span class=c1># Set audio duration</span>
        <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-to </span><span class=si>{:0.10f}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>audio_duration</span><span class=p>))</span>

        <span class=c1># Ignore video data from audio input</span>
        <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-vn&quot;</span><span class=p>)</span>

        <span class=c1># Add audio input path</span>
        <span class=n>audio_in_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-i </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>path_to_subprocess_arg</span><span class=p>(</span><span class=n>audio</span><span class=p>[</span><span class=s2>&quot;filename&quot;</span><span class=p>])</span>
        <span class=p>))</span>

    <span class=c1># NOTE: These were changed from input to output arguments.</span>
    <span class=c1># NOTE: value in &quot;-ac&quot; was hardcoded to 2, changed to audio inputs len.</span>
    <span class=c1># Need to merge audio if there are more than 1 input.</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>audio_inputs</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>audio_out_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter_complex amerge&quot;</span><span class=p>)</span>
        <span class=n>audio_out_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-ac </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>audio_inputs</span><span class=p>)))</span>

    <span class=k>return</span> <span class=n>audio_in_args</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>audio_out_args</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.families_filter_validation class="doc doc-heading"> <code class="highlight language-python"><span class=n>families_filter_validation</span><span class=p>(</span><span class=n>families</span><span class=p>,</span> <span class=n>output_families_filter</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Determines if entered families intersect with families filters.</p> <p>All family values are lowered to avoid unexpected results.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>families_filter_validation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>families</span><span class=p>,</span> <span class=n>output_families_filter</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Determines if entered families intersect with families filters.</span>

<span class=sd>    All family values are lowered to avoid unexpected results.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>families_filter_lower</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>family</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span>
                                <span class=n>output_families_filter</span>
                                <span class=c1># Exclude empty filter values</span>
                                <span class=k>if</span> <span class=n>family</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>families_filter_lower</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=k>return</span> <span class=nb>any</span><span class=p>(</span><span class=n>family</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>families_filter_lower</span>
               <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span> <span class=n>families</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.families_from_instance class="doc doc-heading"> <code class="highlight language-python"><span class=n>families_from_instance</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Returns all families of entered instance.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>families_from_instance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns all families of entered instance.&quot;&quot;&quot;</span>
    <span class=n>families</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>family</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>family</span><span class=p>:</span>
        <span class=n>families</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>family</span> <span class=ow>in</span> <span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>tuple</span><span class=p>()):</span>
        <span class=k>if</span> <span class=n>family</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>families</span><span class=p>:</span>
            <span class=n>families</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>family</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>families</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.ffmpeg_full_args class="doc doc-heading"> <code class="highlight language-python"><span class=n>ffmpeg_full_args</span><span class=p>(</span><span class=n>input_args</span><span class=p>,</span> <span class=n>video_filters</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>output_args</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Post processing of collected FFmpeg arguments.</p> <p>Just verify that output arguments does not contain video or audio filters which may cause issues because of duplicated argument entry. Filters found in output arguments are moved to list they belong to.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>input_args</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>All collected ffmpeg arguments with inputs.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>video_filters</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>All collected video filters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>audio_filters</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>All collected audio filters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>output_args</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>All collected ffmpeg output arguments with output filepath.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>list</code></td> <td> </td> <td> <div class=doc-md-description> <p>Containing all arguments ready to run in subprocess.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span>
<span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>ffmpeg_full_args</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>input_args</span><span class=p>,</span> <span class=n>video_filters</span><span class=p>,</span> <span class=n>audio_filters</span><span class=p>,</span> <span class=n>output_args</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Post processing of collected FFmpeg arguments.</span>

<span class=sd>    Just verify that output arguments does not contain video or audio</span>
<span class=sd>    filters which may cause issues because of duplicated argument entry.</span>
<span class=sd>    Filters found in output arguments are moved to list they belong to.</span>

<span class=sd>    Args:</span>
<span class=sd>        input_args (list): All collected ffmpeg arguments with inputs.</span>
<span class=sd>        video_filters (list): All collected video filters.</span>
<span class=sd>        audio_filters (list): All collected audio filters.</span>
<span class=sd>        output_args (list): All collected ffmpeg output arguments with</span>
<span class=sd>            output filepath.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list: Containing all arguments ready to run in subprocess.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output_args</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>split_ffmpeg_args</span><span class=p>(</span><span class=n>output_args</span><span class=p>)</span>

    <span class=n>video_args_dentifiers</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;-vf&quot;</span><span class=p>,</span> <span class=s2>&quot;-filter:v&quot;</span><span class=p>]</span>
    <span class=n>audio_args_dentifiers</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;-af&quot;</span><span class=p>,</span> <span class=s2>&quot;-filter:a&quot;</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>output_args</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>identifier</span> <span class=ow>in</span> <span class=n>video_args_dentifiers</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>arg</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>identifier</span><span class=p>)):</span>
                <span class=n>output_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
                <span class=n>arg</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
                <span class=n>video_filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>identifier</span> <span class=ow>in</span> <span class=n>audio_args_dentifiers</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>arg</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>identifier</span><span class=p>)):</span>
                <span class=n>output_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
                <span class=n>arg</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
                <span class=n>audio_filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>

    <span class=n>all_args</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>subprocess</span><span class=o>.</span><span class=n>list2cmdline</span><span class=p>(</span><span class=n>get_ffmpeg_tool_args</span><span class=p>(</span><span class=s2>&quot;ffmpeg&quot;</span><span class=p>))</span>
    <span class=p>]</span>
    <span class=n>all_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>input_args</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>video_filters</span><span class=p>:</span>
        <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter:v&quot;</span><span class=p>)</span>
        <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>video_filters</span><span class=p>)))</span>

    <span class=k>if</span> <span class=n>audio_filters</span><span class=p>:</span>
        <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;-filter:a&quot;</span><span class=p>)</span>
        <span class=n>all_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>audio_filters</span><span class=p>)))</span>

    <span class=n>all_args</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>output_args</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>all_args</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.fill_sequence_gaps class="doc doc-heading"> <code class="highlight language-python"><span class=n>fill_sequence_gaps</span><span class=p>(</span><span class=n>files</span><span class=p>,</span> <span class=n>staging_dir</span><span class=p>,</span> <span class=n>start_frame</span><span class=p>,</span> <span class=n>end_frame</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Fill missing files in sequence by duplicating existing ones.</p> <p>This will take nearest frame file and copy it with so as to fill gaps in sequence. Last existing file there is is used to for the hole ahead.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>files</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>List of representation files.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>staging_dir</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to staging directory.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>start_frame</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Sequence start (no matter what files are there)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>end_frame</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Sequence end (no matter what files are there)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>list of added files. Those should be cleaned after work is done.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=ayon_core.pipeline.publish.KnownPublishError>KnownPublishError</span></code> </td> <td> <div class=doc-md-description> <p>if more than one collection is obtained.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span>
<span class=normal>912</span>
<span class=normal>913</span>
<span class=normal>914</span>
<span class=normal>915</span>
<span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span>
<span class=normal>929</span>
<span class=normal>930</span>
<span class=normal>931</span>
<span class=normal>932</span>
<span class=normal>933</span>
<span class=normal>934</span>
<span class=normal>935</span>
<span class=normal>936</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>fill_sequence_gaps</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>files</span><span class=p>,</span> <span class=n>staging_dir</span><span class=p>,</span> <span class=n>start_frame</span><span class=p>,</span> <span class=n>end_frame</span><span class=p>):</span>
    <span class=c1># type: (list, str, int, int) -&gt; list</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Fill missing files in sequence by duplicating existing ones.</span>

<span class=sd>    This will take nearest frame file and copy it with so as to fill</span>
<span class=sd>    gaps in sequence. Last existing file there is is used to for the</span>
<span class=sd>    hole ahead.</span>

<span class=sd>    Args:</span>
<span class=sd>        files (list): List of representation files.</span>
<span class=sd>        staging_dir (str): Path to staging directory.</span>
<span class=sd>        start_frame (int): Sequence start (no matter what files are there)</span>
<span class=sd>        end_frame (int): Sequence end (no matter what files are there)</span>

<span class=sd>    Returns:</span>
<span class=sd>        list of added files. Those should be cleaned after work</span>
<span class=sd>            is done.</span>

<span class=sd>    Raises:</span>
<span class=sd>        KnownPublishError: if more than one collection is obtained.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>collections</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>files</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>collections</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=n>KnownPublishError</span><span class=p>(</span>
            <span class=s2>&quot;Multiple collections </span><span class=si>{}</span><span class=s2> found.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>collections</span><span class=p>))</span>

    <span class=n>col</span> <span class=o>=</span> <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=c1># Prepare which hole is filled with what frame</span>
    <span class=c1>#   - the frame is filled only with already existing frames</span>
    <span class=n>prev_frame</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>col</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>
    <span class=n>hole_frame_to_nearest</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>start_frame</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>end_frame</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>frame</span> <span class=ow>in</span> <span class=n>col</span><span class=o>.</span><span class=n>indexes</span><span class=p>:</span>
            <span class=n>prev_frame</span> <span class=o>=</span> <span class=n>frame</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Use previous frame as source for hole</span>
            <span class=n>hole_frame_to_nearest</span><span class=p>[</span><span class=n>frame</span><span class=p>]</span> <span class=o>=</span> <span class=n>prev_frame</span>

    <span class=c1># Calculate paths</span>
    <span class=n>added_files</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>col_format</span> <span class=o>=</span> <span class=n>col</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>hole_frame</span><span class=p>,</span> <span class=n>src_frame</span> <span class=ow>in</span> <span class=n>hole_frame_to_nearest</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>hole_fpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>col_format</span> <span class=o>%</span> <span class=n>hole_frame</span><span class=p>)</span>
        <span class=n>src_fpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>staging_dir</span><span class=p>,</span> <span class=n>col_format</span> <span class=o>%</span> <span class=n>src_frame</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>KnownPublishError</span><span class=p>(</span>
                <span class=s2>&quot;Missing previously detected file: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>))</span>

        <span class=n>speedcopy</span><span class=o>.</span><span class=n>copyfile</span><span class=p>(</span><span class=n>src_fpath</span><span class=p>,</span> <span class=n>hole_fpath</span><span class=p>)</span>
        <span class=n>added_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>hole_fpath</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>added_files</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_output_defs class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_output_defs</span><span class=p>(</span><span class=n>profile</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>families</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Return outputs matching input instance families.</p> <p>Output definitions without families filter are marked as valid.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>profile</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Profile from presets matching current context.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>families</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>All families of current instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>product_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Product name.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>dict[str, Any]: Containing all output definitions matching entered families.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>filter_output_defs</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>profile</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>families</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return outputs matching input instance families.</span>

<span class=sd>    Output definitions without families filter are marked as valid.</span>

<span class=sd>    Args:</span>
<span class=sd>        profile (dict): Profile from presets matching current context.</span>
<span class=sd>        families (list): All families of current instance.</span>
<span class=sd>        product_name (str): Product name.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict[str, Any]: Containing all output definitions matching entered</span>
<span class=sd>            families.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>filtered_outputs</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>outputs</span> <span class=o>=</span> <span class=n>profile</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;outputs&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>outputs</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>filtered_outputs</span>

    <span class=k>for</span> <span class=n>output_def</span> <span class=ow>in</span> <span class=n>outputs</span><span class=p>:</span>
        <span class=n>filename_suffix</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
        <span class=n>output_filters</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;filter&quot;</span><span class=p>)</span>
        <span class=c1># If no filter on output preset, skip filtering and add output</span>
        <span class=c1># profile for farther processing</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>output_filters</span><span class=p>:</span>
            <span class=n>filtered_outputs</span><span class=p>[</span><span class=n>filename_suffix</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_def</span>
            <span class=k>continue</span>

        <span class=n>families_filters</span> <span class=o>=</span> <span class=n>output_filters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>families_filter_validation</span><span class=p>(</span><span class=n>families</span><span class=p>,</span> <span class=n>families_filters</span><span class=p>):</span>
            <span class=k>continue</span>

        <span class=c1># Subsets name filters</span>
        <span class=n>product_name_filters</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>name_filter</span>
            <span class=k>for</span> <span class=n>name_filter</span> <span class=ow>in</span> <span class=n>output_filters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;product_names&quot;</span><span class=p>,</span> <span class=p>[])</span>
            <span class=c1># Skip empty strings</span>
            <span class=k>if</span> <span class=n>name_filter</span>
        <span class=p>]</span>
        <span class=k>if</span> <span class=n>product_name</span> <span class=ow>and</span> <span class=n>product_name_filters</span><span class=p>:</span>
            <span class=n>match</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>for</span> <span class=n>product_name_filter</span> <span class=ow>in</span> <span class=n>product_name_filters</span><span class=p>:</span>
                <span class=n>compiled</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>product_name_filter</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>compiled</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>product_name</span><span class=p>):</span>
                    <span class=n>match</span> <span class=o>=</span> <span class=kc>True</span>
                    <span class=k>break</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>match</span><span class=p>:</span>
                <span class=k>continue</span>

        <span class=n>filtered_outputs</span><span class=p>[</span><span class=n>filename_suffix</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_def</span>

    <span class=k>return</span> <span class=n>filtered_outputs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.filter_outputs_by_custom_tags class="doc doc-heading"> <code class="highlight language-python"><span class=n>filter_outputs_by_custom_tags</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>custom_tags</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Filter output definitions by entered representation custom_tags.</p> <p>Output definitions without custom_tags filter are marked as invalid, only in case representation is having any custom_tags defined.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>outputs</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>Contain list of output definitions from presets.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>custom_tags</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>Custom Tags of processed representation.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>list</code></td> <td> </td> <td> <div class=doc-md-description> <p>Containing all output definitions matching entered tags.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>filter_outputs_by_custom_tags</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>outputs</span><span class=p>,</span> <span class=n>custom_tags</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Filter output definitions by entered representation custom_tags.</span>

<span class=sd>    Output definitions without custom_tags filter are marked as invalid,</span>
<span class=sd>    only in case representation is having any custom_tags defined.</span>

<span class=sd>    Args:</span>
<span class=sd>        outputs (list): Contain list of output definitions from presets.</span>
<span class=sd>        custom_tags (list): Custom Tags of processed representation.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list: Containing all output definitions matching entered tags.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>filtered_outputs</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>repre_c_tags_low</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=p>(</span><span class=n>custom_tags</span> <span class=ow>or</span> <span class=p>[])]</span>
    <span class=k>for</span> <span class=n>output_def</span> <span class=ow>in</span> <span class=n>outputs</span><span class=p>:</span>
        <span class=n>tag_filters</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;filter&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;custom_tags&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>custom_tags</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>tag_filters</span><span class=p>:</span>
            <span class=c1># Definition is valid if both tags are empty</span>
            <span class=n>valid</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=k>elif</span> <span class=ow>not</span> <span class=n>custom_tags</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>tag_filters</span><span class=p>:</span>
            <span class=c1># Invalid if one is empty</span>
            <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Check if output definition tags are in representation tags</span>
            <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=c1># lower all filter tags</span>
            <span class=n>tag_filters_low</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>tag_filters</span><span class=p>]</span>
            <span class=c1># check if any repre tag is not in filter tags</span>
            <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>repre_c_tags_low</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>tag_filters_low</span><span class=p>:</span>
                    <span class=n>valid</span> <span class=o>=</span> <span class=kc>True</span>
                    <span class=k>break</span>

        <span class=k>if</span> <span class=n>valid</span><span class=p>:</span>
            <span class=n>filtered_outputs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output_def</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;__ filtered_outputs: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=p>[</span><span class=n>_o</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>_o</span> <span class=ow>in</span> <span class=n>filtered_outputs</span><span class=p>]</span>
    <span class=p>))</span>

    <span class=k>return</span> <span class=n>filtered_outputs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.input_is_sequence class="doc doc-heading"> <code class="highlight language-python"><span class=n>input_is_sequence</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Deduce from representation data if input is sequence.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>input_is_sequence</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repre</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Deduce from representation data if input is sequence.&quot;&quot;&quot;</span>
    <span class=c1># TODO GLOBAL ISSUE - Find better way how to find out if input</span>
    <span class=c1>#  is sequence. Issues (in theory):</span>
    <span class=c1>#   - there may be multiple files ant not be sequence</span>
    <span class=c1>#   - remainders are not checked at all</span>
    <span class=c1>#   - there can be more than one collection</span>
    <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>],</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.input_output_paths class="doc doc-heading"> <code class="highlight language-python"><span class=n>input_output_paths</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Deduce input nad output file paths based on entered data.</p> <p>Input may be sequence of images, video file or single image file and same can be said about output, this method helps to find out what their paths are.</p> <p>It is validated that output directory exist and creates if not.</p> <p>During process are set "files", "stagingDir", "ext" and "sequence_file" (if output is sequence) keys to new representation.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>input_output_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Deduce input nad output file paths based on entered data.</span>

<span class=sd>    Input may be sequence of images, video file or single image file and</span>
<span class=sd>    same can be said about output, this method helps to find out what</span>
<span class=sd>    their paths are.</span>

<span class=sd>    It is validated that output directory exist and creates if not.</span>

<span class=sd>    During process are set &quot;files&quot;, &quot;stagingDir&quot;, &quot;ext&quot; and</span>
<span class=sd>    &quot;sequence_file&quot; (if output is sequence) keys to new representation.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>repre</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;origin_repre&quot;</span><span class=p>]</span>
    <span class=n>src_staging_dir</span> <span class=o>=</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span>
    <span class=n>dst_staging_dir</span> <span class=o>=</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;input_is_sequence&quot;</span><span class=p>]:</span>
        <span class=n>collections</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>full_input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>src_staging_dir</span><span class=p>,</span>
            <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}{padding}{tail}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>filename</span> <span class=o>=</span> <span class=n>collections</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{head}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>):</span>
            <span class=n>filename</span> <span class=o>=</span> <span class=n>filename</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

        <span class=c1># Make sure to have full path to one input file</span>
        <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>src_staging_dir</span><span class=p>,</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
        <span class=p>)</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>full_input_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>src_staging_dir</span><span class=p>,</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>

        <span class=c1># Make sure to have full path to one input file</span>
        <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>full_input_path</span>

    <span class=n>filename_suffix</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;filename_suffix&quot;</span><span class=p>]</span>

    <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;ext&quot;</span><span class=p>)</span>
    <span class=c1># Use input extension if output definition do not specify it</span>
    <span class=k>if</span> <span class=n>output_ext</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>output_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>full_input_path</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>

    <span class=c1># TODO Define if extension should have dot or not</span>
    <span class=k>if</span> <span class=n>output_ext</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>):</span>
        <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_ext</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>

    <span class=n>output_ext</span> <span class=o>=</span> <span class=n>output_ext</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>

    <span class=c1># Store extension to representation</span>
    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;ext&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_ext</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;New representation ext: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_ext</span><span class=p>))</span>

    <span class=c1># Output is image file sequence with frames</span>
    <span class=n>output_ext_is_image</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>output_ext</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>image_exts</span><span class=p>)</span>
    <span class=n>output_is_sequence</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span>
        <span class=n>output_ext_is_image</span>
        <span class=ow>and</span> <span class=s2>&quot;sequence&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>output_is_sequence</span><span class=p>:</span>
        <span class=n>new_repre_files</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>frame_start</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_start&quot;</span><span class=p>]</span>
        <span class=n>frame_end</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_frame_end&quot;</span><span class=p>]</span>

        <span class=n>filename_base</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>_</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>filename_suffix</span><span class=p>)</span>
        <span class=c1># Temporary template for frame filling. Example output:</span>
        <span class=c1># &quot;basename.%04d.exr&quot; when `frame_end` == 1001</span>
        <span class=n>repr_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.%</span><span class=si>{:0&gt;2}</span><span class=s2>d.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>filename_base</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>frame_end</span><span class=p>)),</span> <span class=n>output_ext</span>
        <span class=p>)</span>

        <span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>frame_start</span><span class=p>,</span> <span class=n>frame_end</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
            <span class=n>new_repre_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repr_file</span> <span class=o>%</span> <span class=n>frame</span><span class=p>)</span>

        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;sequence_file&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>repr_file</span>
        <span class=n>full_output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>dst_staging_dir</span><span class=p>,</span> <span class=n>filename_base</span><span class=p>,</span> <span class=n>repr_file</span>
        <span class=p>)</span>

    <span class=k>else</span><span class=p>:</span>
        <span class=n>repr_file</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>_</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>filename</span><span class=p>,</span> <span class=n>filename_suffix</span><span class=p>,</span> <span class=n>output_ext</span>
        <span class=p>)</span>
        <span class=n>full_output_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>,</span> <span class=n>repr_file</span><span class=p>)</span>
        <span class=n>new_repre_files</span> <span class=o>=</span> <span class=n>repr_file</span>

    <span class=c1># Store files to representation</span>
    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_repre_files</span>

    <span class=c1># Make sure stagingDire exists</span>
    <span class=n>dst_staging_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>full_output_path</span><span class=p>))</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Creating dir: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>))</span>
        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>dst_staging_dir</span><span class=p>)</span>

    <span class=c1># Store stagingDir to representation</span>
    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;stagingDir&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dst_staging_dir</span>

    <span class=c1># Store paths to temp data</span>
    <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_input_path</span>
    <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path_single_file&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_input_path_single_file</span>
    <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_output_path&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>full_output_path</span>

    <span class=c1># Store information about output</span>
    <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_ext_is_image&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_ext_is_image</span>
    <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;output_is_sequence&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_is_sequence</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Input path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path</span><span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Output path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_output_path</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.lut_filters class="doc doc-heading"> <code class="highlight language-python"><span class=n>lut_filters</span><span class=p>(</span><span class=n>new_repre</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>input_args</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add lut file to output ffmpeg filters.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>lut_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>input_args</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Add lut file to output ffmpeg filters.&quot;&quot;&quot;</span>
    <span class=n>filters</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=c1># baking lut file application</span>
    <span class=n>lut_path</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;lutPath&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>lut_path</span> <span class=ow>or</span> <span class=s2>&quot;bake-lut&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]:</span>
        <span class=k>return</span> <span class=n>filters</span>

    <span class=c1># Prepare path for ffmpeg argument</span>
    <span class=n>lut_path</span> <span class=o>=</span> <span class=n>lut_path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;/&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\\</span><span class=s2>:&quot;</span><span class=p>)</span>

    <span class=c1># Remove gamma from input arguments</span>
    <span class=k>if</span> <span class=s2>&quot;-gamma&quot;</span> <span class=ow>in</span> <span class=n>input_args</span><span class=p>:</span>
        <span class=n>input_args</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;-gamme&quot;</span><span class=p>)</span>

    <span class=c1># Prepare filters</span>
    <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;lut3d=file=&#39;</span><span class=si>{}</span><span class=s2>&#39;&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>lut_path</span><span class=p>))</span>
    <span class=c1># QUESTION hardcoded colormatrix?</span>
    <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;colormatrix=bt601:bt709&quot;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Added Lut to ffmpeg command.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>filters</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.prepare_temp_data class="doc doc-heading"> <code class="highlight language-python"><span class=n>prepare_temp_data</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Prepare dictionary with values used across extractor's process.</p> <p>All data are collected from instance, context, origin representation and output definition.</p> <p>There are few required keys in Instance data: "frameStart", "frameEnd" and "fps".</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>instance</code> </td> <td> <code><span title=Instance>Instance</span></code> </td> <td> <div class=doc-md-description> <p>Currently processed instance.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>repre</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Representation from which new representation was copied.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>output_def</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Definition of output of this plugin.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dict</code></td> <td> </td> <td> <div class=doc-md-description> <p>All data which are used across methods during process. Their values should not change during process but new keys with values may be added.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>prepare_temp_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>output_def</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prepare dictionary with values used across extractor&#39;s process.</span>

<span class=sd>    All data are collected from instance, context, origin representation</span>
<span class=sd>    and output definition.</span>

<span class=sd>    There are few required keys in Instance data: &quot;frameStart&quot;, &quot;frameEnd&quot;</span>
<span class=sd>    and &quot;fps&quot;.</span>

<span class=sd>    Args:</span>
<span class=sd>        instance (Instance): Currently processed instance.</span>
<span class=sd>        repre (dict): Representation from which new representation was</span>
<span class=sd>            copied.</span>
<span class=sd>        output_def (dict): Definition of output of this plugin.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict: All data which are used across methods during process.</span>
<span class=sd>            Their values should not change during process but new keys</span>
<span class=sd>            with values may be added.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>frame_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;frameStart&quot;</span><span class=p>]</span>
    <span class=n>frame_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;frameEnd&quot;</span><span class=p>]</span>

    <span class=c1># Try to get handles from instance</span>
    <span class=n>handle_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;handleStart&quot;</span><span class=p>)</span>
    <span class=n>handle_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;handleEnd&quot;</span><span class=p>)</span>
    <span class=c1># If even one of handle values is not set on instance use</span>
    <span class=c1># handles from context</span>
    <span class=k>if</span> <span class=n>handle_start</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>handle_end</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>handle_start</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleStart&quot;</span><span class=p>]</span>
        <span class=n>handle_end</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;handleEnd&quot;</span><span class=p>]</span>

    <span class=n>frame_start_handle</span> <span class=o>=</span> <span class=n>frame_start</span> <span class=o>-</span> <span class=n>handle_start</span>
    <span class=n>frame_end_handle</span> <span class=o>=</span> <span class=n>frame_end</span> <span class=o>+</span> <span class=n>handle_end</span>

    <span class=c1># Change output frames when output should be without handles</span>
    <span class=n>without_handles</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=s2>&quot;no-handles&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>])</span>
    <span class=k>if</span> <span class=n>without_handles</span><span class=p>:</span>
        <span class=n>output_frame_start</span> <span class=o>=</span> <span class=n>frame_start</span>
        <span class=n>output_frame_end</span> <span class=o>=</span> <span class=n>frame_end</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>output_frame_start</span> <span class=o>=</span> <span class=n>frame_start_handle</span>
        <span class=n>output_frame_end</span> <span class=o>=</span> <span class=n>frame_end_handle</span>

    <span class=n>handles_are_set</span> <span class=o>=</span> <span class=n>handle_start</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>handle_end</span> <span class=o>&gt;</span> <span class=mi>0</span>

    <span class=n>with_audio</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=c1># Check if has `no-audio` tag</span>
        <span class=s2>&quot;no-audio&quot;</span> <span class=ow>in</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
        <span class=c1># Check if instance has ny audio in data</span>
        <span class=ow>or</span> <span class=ow>not</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;audio&quot;</span><span class=p>)</span>
    <span class=p>):</span>
        <span class=n>with_audio</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=n>input_is_sequence</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_is_sequence</span><span class=p>(</span><span class=n>repre</span><span class=p>)</span>
    <span class=n>input_allow_bg</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=n>first_sequence_frame</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>input_is_sequence</span> <span class=ow>and</span> <span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
        <span class=c1># Calculate first frame that should be used</span>
        <span class=n>cols</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>clique</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])</span>
        <span class=n>input_frames</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>cols</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>indexes</span><span class=p>))</span>
        <span class=n>first_sequence_frame</span> <span class=o>=</span> <span class=n>input_frames</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=c1># WARNING: This is an issue as we don&#39;t know if first frame</span>
        <span class=c1>#   is with or without handles!</span>
        <span class=c1># - handle start is added but how do not know if we should</span>
        <span class=n>output_duration</span> <span class=o>=</span> <span class=p>(</span><span class=n>output_frame_end</span> <span class=o>-</span> <span class=n>output_frame_start</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>without_handles</span>
            <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>input_frames</span><span class=p>)</span> <span class=o>-</span> <span class=n>handle_start</span> <span class=o>&gt;=</span> <span class=n>output_duration</span>
        <span class=p>):</span>
            <span class=n>first_sequence_frame</span> <span class=o>+=</span> <span class=n>handle_start</span>

        <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>])[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>ext</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>alpha_exts</span><span class=p>:</span>
            <span class=n>input_allow_bg</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>return</span> <span class=p>{</span>
        <span class=s2>&quot;fps&quot;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;fps&quot;</span><span class=p>]),</span>
        <span class=s2>&quot;frame_start&quot;</span><span class=p>:</span> <span class=n>frame_start</span><span class=p>,</span>
        <span class=s2>&quot;frame_end&quot;</span><span class=p>:</span> <span class=n>frame_end</span><span class=p>,</span>
        <span class=s2>&quot;handle_start&quot;</span><span class=p>:</span> <span class=n>handle_start</span><span class=p>,</span>
        <span class=s2>&quot;handle_end&quot;</span><span class=p>:</span> <span class=n>handle_end</span><span class=p>,</span>
        <span class=s2>&quot;frame_start_handle&quot;</span><span class=p>:</span> <span class=n>frame_start_handle</span><span class=p>,</span>
        <span class=s2>&quot;frame_end_handle&quot;</span><span class=p>:</span> <span class=n>frame_end_handle</span><span class=p>,</span>
        <span class=s2>&quot;output_frame_start&quot;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_frame_start</span><span class=p>),</span>
        <span class=s2>&quot;output_frame_end&quot;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_frame_end</span><span class=p>),</span>
        <span class=s2>&quot;pixel_aspect&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;pixelAspect&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>
        <span class=s2>&quot;resolution_width&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>),</span>
        <span class=s2>&quot;resolution_height&quot;</span><span class=p>:</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>),</span>
        <span class=s2>&quot;origin_repre&quot;</span><span class=p>:</span> <span class=n>repre</span><span class=p>,</span>
        <span class=s2>&quot;input_is_sequence&quot;</span><span class=p>:</span> <span class=n>input_is_sequence</span><span class=p>,</span>
        <span class=s2>&quot;first_sequence_frame&quot;</span><span class=p>:</span> <span class=n>first_sequence_frame</span><span class=p>,</span>
        <span class=s2>&quot;input_allow_bg&quot;</span><span class=p>:</span> <span class=n>input_allow_bg</span><span class=p>,</span>
        <span class=s2>&quot;with_audio&quot;</span><span class=p>:</span> <span class=n>with_audio</span><span class=p>,</span>
        <span class=s2>&quot;without_handles&quot;</span><span class=p>:</span> <span class=n>without_handles</span><span class=p>,</span>
        <span class=s2>&quot;handles_are_set&quot;</span><span class=p>:</span> <span class=n>handles_are_set</span>
    <span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.rescaling_filters class="doc doc-heading"> <code class="highlight language-python"><span class=n>rescaling_filters</span><span class=p>(</span><span class=n>temp_data</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Prepare vieo filters based on tags in new representation.</p> <p>It is possible to add letterboxes to output video or rescale to different resolution.</p> <p>During this preparation "resolutionWidth" and "resolutionHeight" are set to new representation.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>rescaling_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>temp_data</span><span class=p>,</span> <span class=n>output_def</span><span class=p>,</span> <span class=n>new_repre</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prepare vieo filters based on tags in new representation.</span>

<span class=sd>    It is possible to add letterboxes to output video or rescale to</span>
<span class=sd>    different resolution.</span>

<span class=sd>    During this preparation &quot;resolutionWidth&quot; and &quot;resolutionHeight&quot; are</span>
<span class=sd>    set to new representation.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>filters</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=c1># if reformat input video file is already reforamted from upstream</span>
    <span class=n>reformat_in_baking</span> <span class=o>=</span> <span class=p>(</span>
        <span class=s2>&quot;reformatted&quot;</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
        <span class=c1># Backwards compatibility</span>
        <span class=ow>or</span> <span class=s2>&quot;reformated&quot;</span> <span class=ow>in</span> <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;tags&quot;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;reformat_in_baking: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>reformat_in_baking</span><span class=p>))</span>

    <span class=c1># NOTE Skipped using instance&#39;s resolution</span>
    <span class=n>full_input_path_single_file</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;full_input_path_single_file&quot;</span><span class=p>]</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>streams</span> <span class=o>=</span> <span class=n>get_ffprobe_streams</span><span class=p>(</span>
            <span class=n>full_input_path_single_file</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
        <span class=p>)</span>
    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>AssertionError</span><span class=p>((</span>
            <span class=s2>&quot;FFprobe couldn&#39;t read information about input file: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>.&quot;</span>
            <span class=s2>&quot; Error message: </span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path_single_file</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)))</span>

    <span class=c1># Try to find first stream with defined &#39;width&#39; and &#39;height&#39;</span>
    <span class=c1># - this is to avoid order of streams where audio can be as first</span>
    <span class=c1># - there may be a better way (checking `codec_type`?)</span>
    <span class=n>input_width</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>input_height</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>output_width</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>output_height</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>for</span> <span class=n>stream</span> <span class=ow>in</span> <span class=n>streams</span><span class=p>:</span>
        <span class=k>if</span> <span class=s2>&quot;width&quot;</span> <span class=ow>in</span> <span class=n>stream</span> <span class=ow>and</span> <span class=s2>&quot;height&quot;</span> <span class=ow>in</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>input_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>stream</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>])</span>
            <span class=n>input_height</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>stream</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>])</span>
            <span class=k>break</span>

    <span class=c1># Get instance data</span>
    <span class=n>pixel_aspect</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;pixel_aspect&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>reformat_in_baking</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>((</span>
            <span class=s2>&quot;Using resolution from input. It is already &quot;</span>
            <span class=s2>&quot;reformatted from upstream process&quot;</span>
        <span class=p>))</span>
        <span class=n>pixel_aspect</span> <span class=o>=</span> <span class=mi>1</span>
        <span class=n>output_width</span> <span class=o>=</span> <span class=n>input_width</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=n>input_height</span>

    <span class=c1># Raise exception of any stream didn&#39;t define input resolution</span>
    <span class=k>if</span> <span class=n>input_width</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>AssertionError</span><span class=p>((</span>
            <span class=s2>&quot;FFprobe couldn&#39;t read resolution from input file: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>full_input_path_single_file</span><span class=p>))</span>

    <span class=c1># NOTE Setting only one of `width` or `height` is not allowed</span>
    <span class=c1># - settings value can&#39;t have None but has value of 0</span>
    <span class=n>output_width</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>]</span> <span class=ow>or</span> <span class=n>output_width</span> <span class=ow>or</span> <span class=kc>None</span>
    <span class=n>output_height</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>]</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>or</span> <span class=kc>None</span>

    <span class=c1># Force to use input resolution if output resolution was not defined</span>
    <span class=c1>#   in settings. Resolution from instance is not used when</span>
    <span class=c1>#   &#39;use_input_res&#39; is set to &#39;True&#39;.</span>
    <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=c1># Overscan color</span>
    <span class=n>overscan_color_value</span> <span class=o>=</span> <span class=s2>&quot;black&quot;</span>
    <span class=n>overscan_color</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;overscan_color&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>overscan_color</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>overscan_color</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
            <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span> <span class=o>=</span> <span class=n>overscan_color</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Backwards compatibility</span>
            <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span><span class=p>,</span> <span class=n>_</span>  <span class=o>=</span> <span class=n>overscan_color</span>

        <span class=n>overscan_color_value</span> <span class=o>=</span> <span class=s2>&quot;#</span><span class=si>{0:0&gt;2X}{1:0&gt;2X}{2:0&gt;2X}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>bg_red</span><span class=p>,</span> <span class=n>bg_green</span><span class=p>,</span> <span class=n>bg_blue</span>
        <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Overscan color: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>overscan_color_value</span><span class=p>))</span>

    <span class=c1># Scale input to have proper pixel aspect ratio</span>
    <span class=c1># - scale width by the pixel aspect ratio</span>
    <span class=n>scale_pixel_aspect</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;scale_pixel_aspect&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>scale_pixel_aspect</span> <span class=ow>and</span> <span class=n>pixel_aspect</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
        <span class=c1># Change input width after pixel aspect</span>
        <span class=n>input_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>input_width</span> <span class=o>*</span> <span class=n>pixel_aspect</span><span class=p>)</span>
        <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>((</span>
            <span class=s2>&quot;scale=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>:flags=lanczos&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>,</span> <span class=n>input_height</span><span class=p>)</span>
        <span class=p>))</span>

    <span class=c1># Convert overscan value video filters</span>
    <span class=n>overscan_crop</span> <span class=o>=</span> <span class=n>output_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;overscan_crop&quot;</span><span class=p>)</span>
    <span class=n>overscan</span> <span class=o>=</span> <span class=n>OverscanCrop</span><span class=p>(</span>
        <span class=n>input_width</span><span class=p>,</span> <span class=n>input_height</span><span class=p>,</span> <span class=n>overscan_crop</span><span class=p>,</span> <span class=n>overscan_color_value</span>
    <span class=p>)</span>
    <span class=n>overscan_crop_filters</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>video_filters</span><span class=p>()</span>
    <span class=c1># Add overscan filters to filters if are any and modify input</span>
    <span class=c1>#   resolution by it&#39;s values</span>
    <span class=k>if</span> <span class=n>overscan_crop_filters</span><span class=p>:</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>overscan_crop_filters</span><span class=p>)</span>
        <span class=c1># Change input resolution after overscan crop</span>
        <span class=n>input_width</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>width</span><span class=p>()</span>
        <span class=n>input_height</span> <span class=o>=</span> <span class=n>overscan</span><span class=o>.</span><span class=n>height</span><span class=p>()</span>
        <span class=n>use_input_res</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=c1># Make sure input width and height is not an odd number</span>
    <span class=n>input_width_is_odd</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>input_width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
    <span class=n>input_height_is_odd</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>input_height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>input_width_is_odd</span> <span class=ow>or</span> <span class=n>input_height_is_odd</span><span class=p>:</span>
        <span class=c1># Add padding to input and make sure this filter is at first place</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=width=ceil(iw/2)*2:height=ceil(ih/2)*2&quot;</span><span class=p>)</span>

        <span class=c1># Change input width or height as first filter will change them</span>
        <span class=k>if</span> <span class=n>input_width_is_odd</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Converting input width from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>,</span> <span class=n>input_width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
            <span class=n>input_width</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=n>input_height_is_odd</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Converting input height from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_height</span><span class=p>,</span> <span class=n>input_height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
            <span class=n>input_height</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;pixel_aspect: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>pixel_aspect</span><span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;input_width: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_width</span><span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;input_height: `</span><span class=si>{}</span><span class=s2>`&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>input_height</span><span class=p>))</span>

    <span class=c1># Use instance resolution if output definition has not set it</span>
    <span class=c1>#   - use instance resolution only if there were not scale changes</span>
    <span class=c1>#       that may massivelly affect output &#39;use_input_res&#39;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>use_input_res</span> <span class=ow>and</span> <span class=n>output_width</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>output_width</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;resolution_width&quot;</span><span class=p>]</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=n>temp_data</span><span class=p>[</span><span class=s2>&quot;resolution_height&quot;</span><span class=p>]</span>

    <span class=c1># Use source&#39;s input resolution instance does not have set it.</span>
    <span class=k>if</span> <span class=n>output_width</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>output_height</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Using resolution from input.&quot;</span><span class=p>)</span>
        <span class=n>output_width</span> <span class=o>=</span> <span class=n>input_width</span>
        <span class=n>output_height</span> <span class=o>=</span> <span class=n>input_height</span>

    <span class=n>output_width</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_width</span><span class=p>)</span>
    <span class=n>output_height</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>output_height</span><span class=p>)</span>

    <span class=c1># Make sure output width and height is not an odd number</span>
    <span class=c1># When this can happen:</span>
    <span class=c1># - if output definition has set width and height with odd number</span>
    <span class=c1># - `instance.data` contain width and height with odd number</span>
    <span class=k>if</span> <span class=n>output_width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
            <span class=s2>&quot;Converting output width from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_width</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
        <span class=n>output_width</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=k>if</span> <span class=n>output_height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
            <span class=s2>&quot;Converting output height from odd to even number. </span><span class=si>{}</span><span class=s2> -&gt; </span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_height</span><span class=p>,</span> <span class=n>output_height</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
        <span class=n>output_height</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s2>&quot;Output resolution is </span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>letter_box_def</span> <span class=o>=</span> <span class=n>output_def</span><span class=p>[</span><span class=s2>&quot;letter_box&quot;</span><span class=p>]</span>
    <span class=n>letter_box_enabled</span> <span class=o>=</span> <span class=n>letter_box_def</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>

    <span class=c1># Skip processing if resolution is same as input&#39;s and letterbox is</span>
    <span class=c1># not set</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>output_width</span> <span class=o>==</span> <span class=n>input_width</span>
        <span class=ow>and</span> <span class=n>output_height</span> <span class=o>==</span> <span class=n>input_height</span>
        <span class=ow>and</span> <span class=ow>not</span> <span class=n>letter_box_enabled</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
            <span class=s2>&quot;Output resolution is same as input&#39;s&quot;</span>
            <span class=s2>&quot; and </span><span class=se>\&quot;</span><span class=s2>letter_box</span><span class=se>\&quot;</span><span class=s2> key is not set. Skipping reformat part.&quot;</span>
        <span class=p>)</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>input_width</span>
        <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>input_height</span>
        <span class=k>return</span> <span class=n>filters</span>

    <span class=c1># scaling none square pixels and 1920 width</span>
    <span class=k>if</span> <span class=n>input_height</span> <span class=o>!=</span> <span class=n>output_height</span> <span class=ow>or</span> <span class=n>input_width</span> <span class=o>!=</span> <span class=n>output_width</span><span class=p>:</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
            <span class=p>(</span>
                <span class=s2>&quot;scale=</span><span class=si>{}</span><span class=s2>x</span><span class=si>{}</span><span class=s2>&quot;</span>
                <span class=s2>&quot;:flags=lanczos&quot;</span>
                <span class=s2>&quot;:force_original_aspect_ratio=decrease&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>),</span>
            <span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>:(ow-iw)/2:(oh-ih)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>output_width</span><span class=p>,</span> <span class=n>output_height</span><span class=p>,</span>
                <span class=n>overscan_color_value</span>
            <span class=p>),</span>
            <span class=s2>&quot;setsar=1&quot;</span>
        <span class=p>])</span>

    <span class=c1># letter_box</span>
    <span class=k>if</span> <span class=n>letter_box_enabled</span><span class=p>:</span>
        <span class=n>filters</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>get_letterbox_filters</span><span class=p>(</span>
                <span class=n>letter_box_def</span><span class=p>,</span>
                <span class=n>output_width</span><span class=p>,</span>
                <span class=n>output_height</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionWidth&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_width</span>
    <span class=n>new_repre</span><span class=p>[</span><span class=s2>&quot;resolutionHeight&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>output_height</span>

    <span class=k>return</span> <span class=n>filters</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.ExtractReview.split_ffmpeg_args class="doc doc-heading"> <code class="highlight language-python"><span class=n>split_ffmpeg_args</span><span class=p>(</span><span class=n>in_args</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Makes sure all entered arguments are separated in individual items.</p> <p>Split each argument string with " -" to identify if string contains one or more arguments.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>split_ffmpeg_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_args</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Makes sure all entered arguments are separated in individual items.</span>

<span class=sd>    Split each argument string with &quot; -&quot; to identify if string contains</span>
<span class=sd>    one or more arguments.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>splitted_args</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=n>in_args</span><span class=p>:</span>
        <span class=n>sub_args</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; -&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sub_args</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>arg</span> <span class=ow>and</span> <span class=n>arg</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>splitted_args</span><span class=p>:</span>
                <span class=n>splitted_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
            <span class=k>continue</span>

        <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>arg</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>sub_args</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>idx</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>arg</span> <span class=o>=</span> <span class=s2>&quot;-&quot;</span> <span class=o>+</span> <span class=n>arg</span>

            <span class=k>if</span> <span class=n>arg</span> <span class=ow>and</span> <span class=n>arg</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>splitted_args</span><span class=p>:</span>
                <span class=n>splitted_args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>splitted_args</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_core.plugins.publish.extract_review.OverscanCrop class="doc doc-heading"> <code>OverscanCrop</code> </h2> <div class="doc doc-contents "> <p>Helper class to read overscan string and calculate output resolution.</p> <p>It is possible to enter single value for both width and height, or two values for width and height. Overscan string may have a few variants. Each variant define output size for input size.</p> <h5 id=client.ayon_core.plugins.publish.extract_review.OverscanCrop--example>Example</h5> <p>For input size: 2200px</p> <table> <thead> <tr> <th>String</th> <th>Output</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>""</td> <td>2200px</td> <td>Empty string does nothing.</td> </tr> <tr> <td>"10%"</td> <td>220px</td> <td>Explicit percent size.</td> </tr> <tr> <td>"-10%"</td> <td>1980px</td> <td>Relative percent size (decrease).</td> </tr> <tr> <td>"+10%"</td> <td>2420px</td> <td>Relative percent size (increase).</td> </tr> <tr> <td>"-10%+"</td> <td>2000px</td> <td>Relative percent size to output size.</td> </tr> <tr> <td>"300px"</td> <td>300px</td> <td>Explicit output size cropped or expanded.</td> </tr> <tr> <td>"-300px"</td> <td>1900px</td> <td>Relative pixel size (decrease).</td> </tr> <tr> <td>"+300px"</td> <td>2500px</td> <td>Relative pixel size (increase).</td> </tr> <tr> <td>"300"</td> <td>300px</td> <td>Value without "%" and "px" is used as has "px".</td> </tr> </tbody> </table> <p>Value without sign (+/-) in is always explicit and value with sign is relative. Output size for "200px" and "+200px" are not the same. Values "0", "0px" or "0%" are ignored.</p> <p>All values that cause output resolution smaller than 1 pixel are invalid.</p> <p>Value "-10%+" is a special case which says that input's resolution is bigger by 10% than expected output.</p> <p>It is possible to combine these variants to define different output for width and height.</p> <p>Resolution: 2000px 1000px</p> <table> <thead> <tr> <th>String</th> <th>Output</th> </tr> </thead> <tbody> <tr> <td>"100px 120px"</td> <td>2100px 1120px</td> </tr> <tr> <td>"-10% -200px"</td> <td>1800px 800px</td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span>
<span class=normal>1896</span>
<span class=normal>1897</span>
<span class=normal>1898</span>
<span class=normal>1899</span>
<span class=normal>1900</span>
<span class=normal>1901</span>
<span class=normal>1902</span>
<span class=normal>1903</span>
<span class=normal>1904</span>
<span class=normal>1905</span>
<span class=normal>1906</span>
<span class=normal>1907</span>
<span class=normal>1908</span>
<span class=normal>1909</span>
<span class=normal>1910</span>
<span class=normal>1911</span>
<span class=normal>1912</span>
<span class=normal>1913</span>
<span class=normal>1914</span>
<span class=normal>1915</span>
<span class=normal>1916</span>
<span class=normal>1917</span>
<span class=normal>1918</span>
<span class=normal>1919</span>
<span class=normal>1920</span>
<span class=normal>1921</span>
<span class=normal>1922</span>
<span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span>
<span class=normal>1933</span>
<span class=normal>1934</span>
<span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>OverscanCrop</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Helper class to read overscan string and calculate output resolution.</span>

<span class=sd>    It is possible to enter single value for both width and height, or</span>
<span class=sd>    two values for width and height. Overscan string may have a few variants.</span>
<span class=sd>    Each variant define output size for input size.</span>

<span class=sd>    ### Example</span>
<span class=sd>    For input size: 2200px</span>

<span class=sd>    | String   | Output | Description                                     |</span>
<span class=sd>    |----------|--------|-------------------------------------------------|</span>
<span class=sd>    | &quot;&quot;       | 2200px | Empty string does nothing.                      |</span>
<span class=sd>    | &quot;10%&quot;    | 220px  | Explicit percent size.                          |</span>
<span class=sd>    | &quot;-10%&quot;   | 1980px | Relative percent size (decrease).               |</span>
<span class=sd>    | &quot;+10%&quot;   | 2420px | Relative percent size (increase).               |</span>
<span class=sd>    | &quot;-10%+&quot;  | 2000px | Relative percent size to output size.           |</span>
<span class=sd>    | &quot;300px&quot;  | 300px  | Explicit output size cropped or expanded.       |</span>
<span class=sd>    | &quot;-300px&quot; | 1900px | Relative pixel size (decrease).                 |</span>
<span class=sd>    | &quot;+300px&quot; | 2500px | Relative pixel size (increase).                 |</span>
<span class=sd>    | &quot;300&quot;    | 300px  | Value without &quot;%&quot; and &quot;px&quot; is used as has &quot;px&quot;. |</span>

<span class=sd>    Value without sign (+/-) in is always explicit and value with sign is</span>
<span class=sd>    relative. Output size for &quot;200px&quot; and &quot;+200px&quot; are not the same.</span>
<span class=sd>    Values &quot;0&quot;, &quot;0px&quot; or &quot;0%&quot; are ignored.</span>

<span class=sd>    All values that cause output resolution smaller than 1 pixel are invalid.</span>

<span class=sd>    Value &quot;-10%+&quot; is a special case which says that input&#39;s resolution is</span>
<span class=sd>    bigger by 10% than expected output.</span>

<span class=sd>    It is possible to combine these variants to define different output for</span>
<span class=sd>    width and height.</span>

<span class=sd>    Resolution: 2000px 1000px</span>

<span class=sd>    | String        | Output        |</span>
<span class=sd>    |---------------|---------------|</span>
<span class=sd>    | &quot;100px 120px&quot; | 2100px 1120px |</span>
<span class=sd>    | &quot;-10% -200px&quot; | 1800px 800px  |</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>item_regex</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;([\+\-])?([0-9]+)(.+)?&quot;</span><span class=p>)</span>
    <span class=n>relative_source_regex</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;%([\+\-])&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>input_width</span><span class=p>,</span> <span class=n>input_height</span><span class=p>,</span> <span class=n>string_value</span><span class=p>,</span> <span class=n>overscan_color</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
        <span class=c1># Make sure that is not None</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>string_value</span> <span class=ow>or</span> <span class=s2>&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=o>=</span> <span class=n>input_width</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span> <span class=o>=</span> <span class=n>input_height</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span> <span class=o>=</span> <span class=n>overscan_color</span>

        <span class=n>width</span><span class=p>,</span> <span class=n>height</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_convert_string_to_values</span><span class=p>(</span><span class=n>string_value</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_width_value</span> <span class=o>=</span> <span class=n>width</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_height_value</span> <span class=o>=</span> <span class=n>height</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_string_value</span> <span class=o>=</span> <span class=n>string_value</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_string_value</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;&lt;</span><span class=si>{}</span><span class=s2>&gt;&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>width</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculated width.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_width_value</span><span class=o>.</span><span class=n>size_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>input_width</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>height</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculated height.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_height_value</span><span class=o>.</span><span class=n>size_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>video_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;FFmpeg video filters to achieve expected result.</span>

<span class=sd>        Filter may be empty, use &quot;crop&quot; filter, &quot;pad&quot; filter or combination of</span>
<span class=sd>        &quot;crop&quot; and &quot;pad&quot;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list: FFmpeg video filters.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># crop=width:height:x:y - explicit start x, y position</span>
        <span class=c1># crop=width:height     - x, y are related to center by width/height</span>
        <span class=c1># pad=width:height:x:y  - explicit start x, y position</span>
        <span class=c1># pad=width:height      - x, y are set to 0 by default</span>

        <span class=n>width</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>width</span><span class=p>()</span>
        <span class=n>height</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>height</span><span class=p>()</span>

        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=o>==</span> <span class=n>width</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span> <span class=o>==</span> <span class=n>height</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>output</span>

        <span class=c1># Make sure resolution has odd numbers</span>
        <span class=k>if</span> <span class=n>width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>width</span> <span class=o>-=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=n>height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>height</span> <span class=o>-=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=n>width</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>))</span>

        <span class=k>elif</span> <span class=n>width</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=k>elif</span> <span class=n>width</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=iw:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>height</span><span class=p>))</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:ih:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
            <span class=p>))</span>

        <span class=k>elif</span> <span class=n>width</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=</span><span class=si>{}</span><span class=s2>:ih&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=iw:</span><span class=si>{}</span><span class=s2>:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>height</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
            <span class=p>))</span>

        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_convert_string_to_values</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>orig_string_value</span><span class=p>):</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>orig_string_value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>string_value</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>[</span><span class=n>PixValueRelative</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>PixValueRelative</span><span class=p>(</span><span class=mi>0</span><span class=p>)]</span>

        <span class=c1># Replace &quot;px&quot; (and spaces before) with single space</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;([ ]+)?px&quot;</span><span class=p>,</span> <span class=s2>&quot; &quot;</span><span class=p>,</span> <span class=n>string_value</span><span class=p>)</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;([ ]+)%&quot;</span><span class=p>,</span> <span class=s2>&quot;%&quot;</span><span class=p>,</span> <span class=n>string_value</span><span class=p>)</span>
        <span class=c1># Make sure +/- sign at the beginning of string is next to number</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^([\+\-])[ ]+&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\g&lt;1&gt;&quot;</span><span class=p>,</span> <span class=n>string_value</span><span class=p>)</span>
        <span class=c1># Make sure +/- sign in the middle has zero spaces before number under</span>
        <span class=c1>#   which belongs</span>
        <span class=n>string_value</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span>
            <span class=sa>r</span><span class=s2>&quot;[ ]([\+\-])[ ]+([0-9])&quot;</span><span class=p>,</span>
            <span class=sa>r</span><span class=s2>&quot; \g&lt;1&gt;\g&lt;2&gt;&quot;</span><span class=p>,</span>
            <span class=n>string_value</span>
        <span class=p>)</span>
        <span class=n>string_parts</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>part</span>
            <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>string_value</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>part</span>
        <span class=p>]</span>

        <span class=n>error_msg</span> <span class=o>=</span> <span class=s2>&quot;Invalid string for rescaling </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>orig_string_value</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=mi>1</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>string_parts</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=n>error_msg</span><span class=p>)</span>

        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>string_parts</span><span class=p>:</span>
            <span class=n>groups</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>item_regex</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>groups</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=n>error_msg</span><span class=p>)</span>

            <span class=n>relative_sign</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>ending</span> <span class=o>=</span> <span class=n>groups</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>relative_sign</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>ending</span><span class=p>:</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>PixValueExplicit</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>PercentValueExplicit</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>source_sign_group</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>relative_source_regex</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>ending</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>ending</span><span class=p>:</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>PixValueRelative</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>relative_sign</span> <span class=o>+</span> <span class=n>value</span><span class=p>)))</span>

                <span class=k>elif</span> <span class=n>source_sign_group</span><span class=p>:</span>
                    <span class=n>source_sign</span> <span class=o>=</span> <span class=n>source_sign_group</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>PercentValueRelativeSource</span><span class=p>(</span>
                        <span class=nb>float</span><span class=p>(</span><span class=n>relative_sign</span> <span class=o>+</span> <span class=n>value</span><span class=p>),</span> <span class=n>source_sign</span>
                    <span class=p>))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                        <span class=n>PercentValueRelative</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=n>relative_sign</span> <span class=o>+</span> <span class=n>value</span><span class=p>))</span>
                    <span class=p>)</span>

        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>width</span> <span class=o>=</span> <span class=n>output</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
            <span class=n>height</span> <span class=o>=</span> <span class=n>width</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>width</span><span class=p>,</span> <span class=n>height</span> <span class=o>=</span> <span class=n>output</span>

        <span class=k>return</span> <span class=n>width</span><span class=p>,</span> <span class=n>height</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.OverscanCrop.height class="doc doc-heading"> <code class="highlight language-python"><span class=n>height</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Calculated height.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>height</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculated height.&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_height_value</span><span class=o>.</span><span class=n>size_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.OverscanCrop.video_filters class="doc doc-heading"> <code class="highlight language-python"><span class=n>video_filters</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>FFmpeg video filters to achieve expected result.</p> <p>Filter may be empty, use "crop" filter, "pad" filter or combination of "crop" and "pad".</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>list</code></td> <td> </td> <td> <div class=doc-md-description> <p>FFmpeg video filters.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>video_filters</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;FFmpeg video filters to achieve expected result.</span>

<span class=sd>    Filter may be empty, use &quot;crop&quot; filter, &quot;pad&quot; filter or combination of</span>
<span class=sd>    &quot;crop&quot; and &quot;pad&quot;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list: FFmpeg video filters.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># crop=width:height:x:y - explicit start x, y position</span>
    <span class=c1># crop=width:height     - x, y are related to center by width/height</span>
    <span class=c1># pad=width:height:x:y  - explicit start x, y position</span>
    <span class=c1># pad=width:height      - x, y are set to 0 by default</span>

    <span class=n>width</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>width</span><span class=p>()</span>
    <span class=n>height</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>height</span><span class=p>()</span>

    <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=o>==</span> <span class=n>width</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span> <span class=o>==</span> <span class=n>height</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>output</span>

    <span class=c1># Make sure resolution has odd numbers</span>
    <span class=k>if</span> <span class=n>width</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>width</span> <span class=o>-=</span> <span class=mi>1</span>

    <span class=k>if</span> <span class=n>height</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>height</span> <span class=o>-=</span> <span class=mi>1</span>

    <span class=k>if</span> <span class=n>width</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>))</span>

    <span class=k>elif</span> <span class=n>width</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>elif</span> <span class=n>width</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=iw:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>height</span><span class=p>))</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=</span><span class=si>{}</span><span class=s2>:ih:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
        <span class=p>))</span>

    <span class=k>elif</span> <span class=n>width</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_width</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_height</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;crop=</span><span class=si>{}</span><span class=s2>:ih&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>width</span><span class=p>))</span>
        <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;pad=iw:</span><span class=si>{}</span><span class=s2>:(iw-ow)/2:(ih-oh)/2:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>height</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>overscan_color</span>
        <span class=p>))</span>

    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review.OverscanCrop.width class="doc doc-heading"> <code class="highlight language-python"><span class=n>width</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Calculated width.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>width</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculated width.&quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_width_value</span><span class=o>.</span><span class=n>size_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>input_width</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_core.plugins.publish.extract_review._OverscanValue class="doc doc-heading"> <code>_OverscanValue</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=abc.ABC>ABC</span></code></p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>_OverscanValue</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;&lt;</span><span class=si>{}</span><span class=s2>&gt; </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=p>))</span>

    <span class=nd>@abstractmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>copy</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a copy of object.&quot;&quot;&quot;</span>
        <span class=k>pass</span>

    <span class=nd>@abstractmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>size_for</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate new value for passed value.&quot;&quot;&quot;</span>
        <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review._OverscanValue.copy class="doc doc-heading"> <code class="highlight language-python"><span class=n>copy</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Create a copy of object.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abstractmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>copy</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a copy of object.&quot;&quot;&quot;</span>
    <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_core.plugins.publish.extract_review._OverscanValue.size_for class="doc doc-heading"> <code class="highlight language-python"><span class=n>size_for</span><span class=p>(</span><span class=n>value</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Calculate new value for passed value.</p> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@abstractmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>size_for</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate new value for passed value.&quot;&quot;&quot;</span>
    <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_core.plugins.publish.extract_review.frame_to_timecode class="doc doc-heading"> <code class="highlight language-python"><span class=n>frame_to_timecode</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span> <span class=n>fps</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Convert a frame number and FPS to editorial timecode (HH:MM:SS:FF).</p> <p>Unlike <code>ayon_core.pipeline.editorial.frames_to_timecode</code> this does not rely on the <code>opentimelineio</code> package, so it can be used across hosts that do not have it available.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>frame</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>The frame number to be converted.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fps</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The frames per second of the video.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>The timecode in HH:MM:SS:FF format.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_core/plugins/publish/extract_review.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>frame_to_timecode</span><span class=p>(</span><span class=n>frame</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>fps</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Convert a frame number and FPS to editorial timecode (HH:MM:SS:FF).</span>

<span class=sd>    Unlike `ayon_core.pipeline.editorial.frames_to_timecode` this does not</span>
<span class=sd>    rely on the `opentimelineio` package, so it can be used across hosts that</span>
<span class=sd>    do not have it available.</span>

<span class=sd>    Args:</span>
<span class=sd>        frame (int): The frame number to be converted.</span>
<span class=sd>        fps (float): The frames per second of the video.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: The timecode in HH:MM:SS:FF format.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Calculate total seconds</span>
    <span class=n>total_seconds</span> <span class=o>=</span> <span class=n>frame</span> <span class=o>/</span> <span class=n>fps</span>

    <span class=c1># Extract hours, minutes, and seconds</span>
    <span class=n>hours</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>total_seconds</span> <span class=o>//</span> <span class=mi>3600</span><span class=p>)</span>
    <span class=n>minutes</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>total_seconds</span> <span class=o>%</span> <span class=mi>3600</span><span class=p>)</span> <span class=o>//</span> <span class=mi>60</span><span class=p>)</span>
    <span class=n>seconds</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>total_seconds</span> <span class=o>%</span> <span class=mi>60</span><span class=p>)</span>

    <span class=c1># Adjust for non-integer FPS by rounding the remaining frames appropriately</span>
    <span class=n>remaining_frames</span> <span class=o>=</span> <span class=nb>round</span><span class=p>((</span><span class=n>total_seconds</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>total_seconds</span><span class=p>))</span> <span class=o>*</span> <span class=n>fps</span><span class=p>)</span>

    <span class=c1># Format and return the timecode</span>
    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>hours</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>minutes</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>seconds</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>remaining_frames</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>&quot;</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>